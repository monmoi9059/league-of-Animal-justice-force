<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self'; object-src 'none';">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="manifest" href="manifest.json">
    <title>League of Animal Justice Avenger Force: Operation Dumpster Fire</title>
    <style>
/* --- CSS --- */
@import url('https://fonts.googleapis.com/css2?family=Black+Ops+One&display=swap');

body {
    background-color: #0d0d1a;
    color: #00ff41;
    font-family: 'Black Ops One', 'Impact', sans-serif;
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    overflow: hidden; /* Prevent scrolling */
    height: 100vh;
}
h1 {
    font-size: 24px;
    margin-bottom: 5px;
    text-shadow: 0 0 10px #00ff41;
    display: none; /* Hide title to save space, maybe overlay it on menu */
}
#gameContainer {
    position: relative;
    width: 100%;
    height: 100%;
    /* Keep aspect ratio? Or fill? "Fit device screen" usually means fill. */
    /* Let's make it fill. */
    border: 0;
    box-shadow: none;
    background: #000;
}
canvas {
    display: block;
    width: 100%;
    height: 100%;
}
.controls {
    position: absolute;
    bottom: 10px;
    width: 100%;
    text-align: center;
    color: #fff;
    font-size: 12px;
    opacity: 0.5;
    pointer-events: none;
    z-index: 20;
}
/* ... existing styles for HUD/Overlays ... */
#gameUI {
    display: none;
    position: absolute;
    top: 15px; left: 20px; right: 20px;
    font-family: 'Black Ops One', 'Impact', sans-serif;
    font-size: 20px;
    font-weight: bold;
    pointer-events: none;
    justify-content: space-between;
    flex-wrap: wrap;
    z-index: 5;
    text-shadow: 2px 2px 0 #000;
}
.stat-box {
    background: linear-gradient(135deg, rgba(0,0,0,0.8), rgba(50,50,50,0.8));
    backdrop-filter: blur(4px);
    padding: 10px 20px;
    border: 2px solid #fff;
    border-radius: 0;
    transform: skewX(-15deg);
    margin-bottom: 5px;
    box-shadow: 5px 5px 0px rgba(0,0,0,0.5);
    color: #fff;
}
.stat-box > div {
    display: inline-block;
    transform: skewX(15deg);
}
#bossHealthContainer {
    display: none;
    position: absolute;
    bottom: 30px; left: 50%;
    transform: translateX(-50%);
    width: 600px; max-width: 90%; /* Responsive width */
    height: 20px;
    border: 2px solid #fff;
    background: #222;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 0 15px rgba(255, 0, 222, 0.5);
    z-index: 5;
}
#bossHealthBar {
    width: 100%; height: 100%;
    background: linear-gradient(90deg, #ff00de, #ff69b4);
    transition: width 0.2s;
}

.overlay-screen {
    display: none;
    position: absolute;
    top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.85);
    backdrop-filter: blur(5px);
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    z-index: 10;
}

#menuOverlay {
    background: rgba(10, 10, 20, 0.95);
    justify-content: center; /* Centered menu */
    padding-bottom: 30px;
    z-index: 15;
    display: none;
}

#rosterOverlay {
    background: rgba(0, 0, 0, 0);
    backdrop-filter: none;
    justify-content: center;
    padding-bottom: 30px;
    z-index: 15;
    display: flex;
}

#levelCompleteOverlay {
    background: rgba(20, 40, 20, 0.95);
    z-index: 20;
    display: none;
}

button {
    font-family: 'Black Ops One', 'Impact', sans-serif;
    background: linear-gradient(180deg, #ff00de, #800080);
    border: 3px solid #fff;
    color: white;
    padding: 15px 40px;
    font-size: 24px;
    text-shadow: 2px 2px 0 #000;
    cursor: pointer;
    text-transform: uppercase;
    box-shadow: 0 5px 0 #500050;
    border-radius: 0;
    transform: skewX(-10deg);
    transition: transform 0.1s, box-shadow 0.1s;
    margin-top: 20px;
    pointer-events: auto;
}
button:hover {
    transform: skewX(-10deg) translateY(-2px);
    box-shadow: 0 7px 0 #500050;
    background: linear-gradient(180deg, #ff33ea, #a020f0);
}
button:active {
    transform: skewX(-10deg) translateY(2px);
    box-shadow: 0 2px 0 #500050;
}

#errorOverlay {
    display: none;
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(50, 0, 0, 0.9);
    color: #ffcccc;
    font-family: monospace;
    padding: 20px;
    box-sizing: border-box;
    white-space: pre-wrap;
    overflow: auto;
    z-index: 9999;
}
#debugHUD {
    position: absolute;
    top: 5px; right: 5px;
    color: lime;
    font-size: 10px;
    background: rgba(0,0,0,0.5);
    padding: 2px;
    pointer-events: none;
    display: none; /* Hide unless needed */
}

/* --- TOUCH CONTROLS --- */
.touch-toggle {
    position: absolute;
    top: 10px;
    right: 10px;
    z-index: 100;
    background: rgba(0, 0, 0, 0.5);
    color: white;
    border: 1px solid white;
    border-radius: 5px;
    padding: 10px;
    font-size: 24px;
    cursor: pointer;
    opacity: 0.7;
    margin-top: 0; /* Override generic button */
    box-shadow: none;
}

.touch-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none; /* Let clicks pass through empty space */
    z-index: 90;
    display: flex;
    justify-content: space-between;
    align-items: flex-end;
    padding: 20px;
    box-sizing: border-box;
}

.touch-btn {
    pointer-events: auto; /* Enable clicks on buttons */
    background: rgba(255, 255, 255, 0.15);
    border: 2px solid rgba(255, 255, 255, 0.5);
    color: white;
    border-radius: 50%;
    width: 60px;
    height: 60px;
    font-size: 20px;
    font-weight: bold;
    user-select: none;
    touch-action: manipulation;
    display: flex;
    justify-content: center;
    align-items: center;
    margin: 5px;
    padding: 0; /* Reset */
    backdrop-filter: blur(2px);
    transition: transform 0.1s, background 0.1s;
    box-shadow: none; /* Reset */
    text-shadow: 1px 1px 0 #000;
}

.touch-btn:active, .touch-btn.active {
    background: rgba(255, 255, 255, 0.4);
    transform: scale(0.95);
}

.touch-btn.toggle-btn.active {
    background: rgba(0, 255, 65, 0.5);
    border-color: #00ff41;
}

/* JOYSTICK */
.joystick-area {
    width: 150px;
    height: 150px;
    display: flex;
    justify-content: center;
    align-items: center;
    pointer-events: auto; /* Allow touch on area */
    margin-left: 20px;
    margin-bottom: 20px;
}

.joystick-base {
    width: 120px;
    height: 120px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.1);
    border: 2px solid rgba(255, 255, 255, 0.3);
    position: relative;
    box-sizing: border-box;
}

.joystick-stick {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.5);
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    box-shadow: 0 0 10px rgba(0,0,0,0.5);
    pointer-events: none; /* Stick follows touch on base/area */
}

/* ACTIONS */
.action-area {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    margin-bottom: 20px;
    margin-right: 20px;
}

.action-group-main {
    display: flex;
    justify-content: flex-end;
    margin-bottom: 10px;
}
.action-group-sub {
    display: flex;
    justify-content: flex-end;
    flex-wrap: wrap;
    max-width: 280px; /* Force wrap if needed */
}

.action-btn.large {
    width: 80px;
    height: 80px;
    font-size: 24px;
    background: rgba(255, 0, 222, 0.2);
    border-color: rgba(255, 0, 222, 0.5);
}

/* Landscape adjustments for mobile */
@media (max-height: 500px) {
    .touch-btn {
        width: 50px;
        height: 50px;
        font-size: 16px;
    }
    .touch-btn.large {
        width: 70px;
        height: 70px;
    }
    .action-area {
        margin-right: 50px; /* Give thumb space */
    }
    .joystick-area {
        margin-left: 30px;
        margin-bottom: 30px;
    }
}

</style>
</head>
<body>

    <div id="gameContainer">
        <!-- Canvas size will be set by JS -->
        <canvas id="gameCanvas"></canvas>
        <div id="errorOverlay"></div>
        <div id="debugHUD">Initializing...</div>

        <!-- HUD -->
        <div id="gameUI">
            <div class="stat-box"><div>HERO: <span id="charName" style="color:#00ff41">IRON MUTT</span></div></div>
            <div class="stat-box"><div>HP: <span id="healthDisplay" style="color:#ff00de">‚ù§‚ù§‚ù§</span></div></div>
            <div class="stat-box"><div>LIVES: <span id="livesDisplay" style="color:yellow">3</span></div></div>
            <div class="stat-box"><div>RESCUES: <span id="rescueDisplay">0</span></div></div>
            <div class="stat-box"><div>SCORE: <span id="scoreDisplay">0</span></div></div>
            <div class="stat-box"><div>LEVEL: <span id="levelDisplay">1</span></div></div>
        </div>

        <div id="bossHealthContainer">
            <div id="bossHealthBar"></div>
        </div>

        <!-- MAIN MENU -->
        <div id="menuOverlay" class="overlay-screen">
             <!-- Title in Menu -->
             <h1 style="font-size: 32px; color: #00ff41; margin-bottom: 40px; text-align: center; max-width: 80%;">
                LEAGUE OF ANIMAL JUSTICE<br>AVENGER FORCE
            </h1>
            <button onclick="window.enterLobby()">DEPLOY SQUAD</button>
            <button onclick="window.viewRoster()">VIEW TEAM</button>
        </div>

        <!-- ROSTER MENU -->
        <div id="rosterOverlay" class="overlay-screen">
            <button onclick="window.returnToMenu()" style="position: absolute; bottom: 30px;">BACK</button>
        </div>

        <!-- LOBBY MENU -->
        <div id="lobbyOverlay" class="overlay-screen" style="display: none;">
            <h2 style="color: #00ff41; margin-bottom: 20px;">SQUAD SETUP</h2>
            <div style="display: flex; gap: 20px; margin-bottom: 20px;">
                <div class="stat-box" style="width: 150px; height: 100px; display: flex; flex-direction: column; justify-content: center;">
                    <div>PLAYER 1</div>
                    <div id="lobbyStatus1" style="color: #777; margin-top: 10px;">PRESS A / SPACE</div>
                </div>
                <div class="stat-box" style="width: 150px; height: 100px; display: flex; flex-direction: column; justify-content: center;">
                    <div>PLAYER 2</div>
                    <div id="lobbyStatus2" style="color: #777; margin-top: 10px;">PRESS A</div>
                </div>
                <div class="stat-box" style="width: 150px; height: 100px; display: flex; flex-direction: column; justify-content: center;">
                    <div>PLAYER 3</div>
                    <div id="lobbyStatus3" style="color: #777; margin-top: 10px;">PRESS A</div>
                </div>
                <div class="stat-box" style="width: 150px; height: 100px; display: flex; flex-direction: column; justify-content: center;">
                    <div>PLAYER 4</div>
                    <div id="lobbyStatus4" style="color: #777; margin-top: 10px;">PRESS A</div>
                </div>
            </div>
            <p id="lobbyMessage" style="color: #aaa; margin-bottom: 20px;">WAITING FOR PLAYERS...</p>
            <button id="lobbyStartBtn" onclick="window.startGame()" style="display: none;">START MISSION</button>
        </div>

        <!-- LEVEL COMPLETE -->
        <div id="levelCompleteOverlay" class="overlay-screen">
            <h2 style="color: gold; font-size: 40px; margin-bottom: 20px;">AREA SECURED</h2>
            <div style="font-size: 20px; color: #fff; line-height: 1.6;">
                <p>KILLS: <span id="lcKills" style="color: red">0</span></p>
                <p>RESCUES: <span id="lcRescues" style="color: #00ff41">0</span></p>
                <p>TIME BONUS: <span id="lcTime" style="color: yellow">0</span></p>
            </div>
            <button onclick="window.nextLevel()">NEXT MISSION</button>
        </div>

        <!-- GAME OVER / WIN -->
        <div id="gameOverOverlay" class="overlay-screen">
            <h2 id="ovTitle" style="font-size: 50px; color: #00ff41; margin-bottom: 10px;">MISSION FAILED</h2>
            <p id="ovMsg" style="margin-bottom: 30px; font-size: 20px;">The HOA has won.</p>
            <button onclick="window.returnToBase()">RETURN TO BASE</button>
        </div>

        <div class="controls">
            ARROWS/WASD: Move | SPACE: Jump | SHIFT: Sprint | Z: Shoot | X: Special | C: 2nd Attack | DOWN+Z: Down Attack | F: Flex
        </div>

        <!-- Touch Controls -->
        <button id="controlsToggle" class="touch-toggle">üéÆ</button>
        <button id="soundToggle" class="touch-toggle" style="right: 70px;">üîä</button>

        <div id="touchControls" class="touch-overlay" style="display: none;">
            <div id="joystick-area" class="joystick-area">
                <div id="joystick-base" class="joystick-base">
                    <div id="joystick-stick" class="joystick-stick"></div>
                </div>
            </div>

            <div class="action-area">
                <div class="action-group-main">
                    <button id="btnShoot" class="touch-btn action-btn large">Z</button>
                    <button id="btnJump" class="touch-btn action-btn large">SPACE</button>
                </div>
                <div class="action-group-sub">
                    <button id="btnSpecial" class="touch-btn action-btn">X</button>
                    <button id="btnSecondary" class="touch-btn action-btn">C</button>
                    <button id="btnFlex" class="touch-btn action-btn">F</button>
                    <button id="btnSprint" class="touch-btn action-btn toggle-btn">RUN</button>
                </div>
            </div>
        </div>
    </div>


<script>
!function(){"use strict";const e=document.getElementById("gameCanvas"),t=e.getContext("2d"),i=document.getElementById("debugHUD"),a=40,l=.6,s=-13,n=400,h=60,o=1e3/60,r="#5d4037",c="#8d6e63",d="#4caf50",f="#546e7a",p="#78909c",y="#d35400",u=[{id:"willywombat",body:"orb",name:"WILLY WOMBAT",type:"rodent",cSkin:"#deb887",cDark:"#800080",cSuit:"#800080",pType:"cane_candy",pColor:"#dda0dd",stance:"quadruped",w:36,h:24,mount:"back"},{id:"mandalmatian",body:"muscular",name:"FIREFIGHTER-DALMATIAN",type:"dog_pointy",cSkin:"#fff",cDark:"#000",cSuit:"#c0c0c0",pType:"flamethrower",pColor:"#ff4500",trait:"fly",stance:"quadruped",w:36,h:24,mount:"back"},{id:"earthbuffalo",name:"EARTH-BUFFALO",type:"cow",cSkin:"#7FFF00",cDark:"#4169E1",cSuit:"#FFFF00",pType:"fireball",pColor:"#00FFFF",stance:"quadruped",w:36,h:24,mount:"back"},{id:"kungfupanther",body:"muscular",name:"KUNG FU PANTHER",type:"cat",cSkin:"#000",cDark:"#333",cSuit:"#ffd700",pType:"chi_blast",pColor:"#ffd700",stance:"quadruped",w:36,h:24,mount:"back"},{id:"fighterhawk",body:"teardrop",name:"FIGHTER-HAWK",type:"bird",cSkin:"#F8F8FF",cDark:"#006400",cSuit:"#F0E68C",pType:"gun",pColor:"#F0FFFF",trait:"fly",stance:"biped",w:24,h:30,mount:"hand"},{id:"moon",name:"MOON-OWL",type:"bird",cSkin:"#FFF",cDark:"#EEE",cSuit:"#DDD",pType:"boomerang",pColor:"#FFF",trait:"fly",stance:"biped",w:24,h:30,mount:"hand"},{id:"widow",name:"BLACK WIDOW-PUG",type:"dog_flat",cSkin:"#000",cDark:"#111",cSuit:"#222",pType:"gun",pColor:"#00FFFF",trait:"climb",stance:"quadruped",w:36,h:24,mount:"back",melee:!0},{id:"minnowion",name:"MINNOW-ION",type:"fish",cSkin:"#ffd700",cDark:"#0000ff",cSuit:"#0000ff",pType:"banana_gun",pColor:"#ffd700",stance:"fish",w:36,h:18,mount:"mouth"},{id:"mooana",name:"MOO-ANA",type:"cow",cSkin:"#cd853f",cDark:"#8b4513",cSuit:"#ff4500",pType:"oar_smash",pColor:"#deb887",stance:"quadruped",w:36,h:24,mount:"back",melee:!0},{id:"batmanatee",body:"orb",name:"VIGILANTE-MANATEE",type:"fish",cSkin:"#000",cDark:"#333",cSuit:"#111",pType:"batarang",pColor:"#ffff00",stance:"fish",w:36,h:18,mount:"mouth"},{id:"moolan",name:"MOO-LAN",type:"cow",cSkin:"#ffe4c4",cDark:"#000",cSuit:"#ff69b4",pType:"sword_slash",pColor:"#c0c0c0",stance:"quadruped",w:36,h:24,mount:"back",melee:!0},{id:"yodog",name:"SPACE-SAGE-PUG",type:"dog_pointy",cSkin:"#9acd32",cDark:"#fff",cSuit:"#f5deb3",pType:"magic",pColor:"#00ff00",stance:"quadruped",w:36,h:24,mount:"back"},{id:"alihen",name:"ALI-HEN",type:"chicken",cSkin:"#000",cDark:"#111",cSuit:"#222",pType:"acid_spit",pColor:"#00ff00",trait:"climb",stance:"biped",w:24,h:30,mount:"hand"},{id:"resortstone",name:"RESORT-STONE",type:"stone",cSkin:"#808080",cDark:"#FAFAD2",cSuit:"#8FBC8F",pType:"boomerang",pColor:"#00FF7F",stance:"biped",w:24,h:30,mount:"hand",melee:!0},{id:"shang",name:"SHANG-CHI-PANDA",type:"bear",cSkin:"#000",cDark:"#FFF",cSuit:"#FF0000",pType:"melee_smash",pColor:"#FFD700",stance:"quadruped",w:36,h:24,mount:"back",melee:!0},{id:"detectivemonkey",name:"DETECTIVE-MONKEY",type:"monkey",cSkin:"#000080",cDark:"#F5F5F5",cSuit:"#F0FFFF",pType:"laser",pColor:"#FAEBD7",trait:"climb",stance:"biped",w:24,h:30,mount:"hand",melee:!0},{id:"defenderroof",name:"DEFENDER-ROOF",type:"stone",cSkin:"#A52A2A",cDark:"#0000FF",cSuit:"#000000",pType:"boomerang",pColor:"#D2691E",stance:"biped",w:24,h:30,mount:"hand"},{id:"drmanhatcat",name:"QUANTUM-CAT",type:"cat",cSkin:"#00bfff",cDark:"#000",cSuit:"#00bfff",pType:"atom_blast",pColor:"#fff",trait:"fly",stance:"quadruped",w:36,h:24,mount:"back"},{id:"ninjakangaroo",name:"NINJA-KANGAROO",type:"rabbit",cSkin:"#DCDCDC",cDark:"#F0FFF0",cSuit:"#8FBC8F",pType:"card_throw",pColor:"#808080",trait:"climb",stance:"biped",w:24,h:30,mount:"hand",melee:!0},{id:"mutantkoala",name:"MUTANT-KOALA",type:"bear",cSkin:"#4682B4",cDark:"#DCDCDC",cSuit:"#008000",pType:"laser",pColor:"#696969",trait:"climb",stance:"quadruped",w:36,h:24,mount:"back",melee:!0},{id:"policecroc",name:"POLICE-CROC",type:"croc",cSkin:"#228B22",cDark:"#006400",cSuit:"#A52A2A",pType:"shuriken",pColor:"#A0522D",stance:"quadruped",w:36,h:24,mount:"back",melee:!0},{id:"supermanta",body:"muscular",name:"SUPER-MANTA",type:"fish",cSkin:"#0000ff",cDark:"#ff0000",cSuit:"#0000ff",pType:"heat_vision",pColor:"#ff0000",trait:"fly",stance:"fish",w:36,h:18,mount:"mouth"},{id:"freddycougar",name:"NIGHTMARE-COUGAR",type:"cat",cSkin:"#cd5c5c",cDark:"#8b0000",cSuit:"#006400",pType:"claw_glove",pColor:"#c0c0c0",stance:"quadruped",w:36,h:24,mount:"back",melee:!0},{id:"groot",body:"brute",name:"TREE-BARK",type:"tree",cSkin:"#8B4513",cDark:"#A0522D",cSuit:"#654321",pType:"melee_smash",pColor:"#8B4513",stance:"biped",w:24,h:30,mount:"hand",melee:!0},{id:"chewbarka",body:"brute",name:"SPACE-WOOKIE",type:"dog_long",cSkin:"#8b4513",cDark:"#a0522d",cSuit:"#8b4513",pType:"melee_smash",pColor:"#8b4513",stance:"quadruped",w:36,h:24,mount:"back",melee:!0},{id:"eweve",name:"ROBOT-EWE",type:"goat",cSkin:"#fff",cDark:"#000",cSuit:"#fff",pType:"plasma_gun",pColor:"#0000ff",trait:"fly",stance:"quadruped",w:36,h:24,mount:"back"},{id:"ogreguinea",name:"OGRE-GUINEA",type:"rodent",cSkin:"#FFE4C4",cDark:"#708090",cSuit:"#2F4F4F",pType:"gun",pColor:"#00CED1",stance:"quadruped",w:36,h:24,mount:"back",melee:!0},{id:"farmpig",name:"FARM-PIG",type:"pig",cSkin:"#696969",cDark:"#696969",cSuit:"#FFF5EE",pType:"lightning",pColor:"#00FFFF",stance:"quadruped",w:36,h:24,mount:"back"},{id:"guardbrick",name:"GUARD-BRICK",type:"stone",cSkin:"#66CDAA",cDark:"#C0C0C0",cSuit:"#40E0D0",pType:"shuriken",pColor:"#008B8B",stance:"biped",w:24,h:30,mount:"hand",melee:!0},{id:"wickedfish",name:"WICKED FISH",type:"fish",cSkin:"#00ff00",cDark:"#000",cSuit:"#000",pType:"broom_splash",pColor:"#00ff00",stance:"fish",w:36,h:18,mount:"mouth"},{id:"beastbee",name:"BEE-ST",type:"bee",cSkin:"#8b4513",cDark:"#ffd700",cSuit:"#000080",pType:"rose_petal",pColor:"#ff0000",trait:"fly",stance:"biped",w:24,h:30,mount:"hand"},{id:"wonderwombat",body:"orb",name:"AMAZON-WOMBAT",type:"rodent",cSkin:"#deb887",cDark:"#000",cSuit:"#ff0000",pType:"lasso",pColor:"#ffd700",stance:"quadruped",w:36,h:24,mount:"back"},{id:"woodpecker",name:"WOOD-Y PECKER",type:"bird",cSkin:"#d2b48c",cDark:"#a52a2a",cSuit:"#ffff00",pType:"pull_string",pColor:"#a52a2a",trait:"fly",stance:"biped",w:24,h:30,mount:"hand"},{id:"madcatter",name:"MAD CAT-TER",type:"cat",cSkin:"#dda0dd",cDark:"#800080",cSuit:"#008000",pType:"tea_pot",pColor:"#da70d6",stance:"quadruped",w:36,h:24,mount:"back"},{id:"headsmanshark",name:"HEADSMAN-SHARK",type:"fish",cSkin:"#4682B4",cDark:"#00FF7F",cSuit:"#FFE4C4",pType:"melee_slash",pColor:"#D3D3D3",stance:"fish",w:36,h:18,mount:"mouth",melee:!0},{id:"knightsheep",name:"KNIGHT-SHEEP",type:"goat",cSkin:"#D2691E",cDark:"#B8860B",cSuit:"#F0FFF0",pType:"acid_spit",pColor:"#000080",stance:"quadruped",w:36,h:24,mount:"back",melee:!0},{id:"duckula",name:"VAMPIRE-DUCK",type:"duck",cSkin:"#fff",cDark:"#000",cSuit:"#000",pType:"fangs",pColor:"#ff0000",trait:"fly",stance:"biped",w:24,h:30,mount:"hand"},{id:"killerdonkey",name:"KILLER-DONKEY",type:"horse",cSkin:"#7FFF00",cDark:"#F0FFFF",cSuit:"#FFFACD",pType:"grenade",pColor:"#708090",stance:"quadruped",w:36,h:24,mount:"back",melee:!0},{id:"dead",name:"UNDEAD-POODLE",type:"poodle",cSkin:"#FF0000",cDark:"#000",cSuit:"#333",pType:"gun",pColor:"#FF0000",stance:"biped",w:24,h:30,mount:"hand"},{id:"stitchostrich",name:"ALIEN-OSTRICH",type:"bird",cSkin:"#0000ff",cDark:"#add8e6",cSuit:"#ff4500",pType:"plasma_blaster",pColor:"#00ff00",stance:"biped",w:24,h:30,mount:"hand"},{id:"monkeysifu",name:"MONK-EY",type:"monkey",cSkin:"#8b4513",cDark:"#000",cSuit:"#daa520",pType:"staff",pColor:"#8b4513",trait:"climb",stance:"biped",w:24,h:30,mount:"hand"},{id:"ghost",name:"GHOST-GOAT",type:"goat",cSkin:"#FFF",cDark:"#FF4500",cSuit:"#000",pType:"melee_slash",pColor:"#FF4500",stance:"quadruped",w:36,h:24,mount:"back"},{id:"oompallama",name:"CANDY-LLAMA",type:"goat",cSkin:"#ffa500",cDark:"#008000",cSuit:"#fff",pType:"cocoa_bean",pColor:"#8b4513",stance:"quadruped",w:36,h:24,mount:"back"},{id:"starlord",body:"muscular",name:"SPACE-FOX",type:"fox",cSkin:"#FF8C00",cDark:"#8B0000",cSuit:"#8B4513",pType:"laser",pColor:"#FFFF00",trait:"fly",stance:"quadruped",w:36,h:24,mount:"back"},{id:"hercowles",body:"brute",name:"HER-COW-LES",type:"cow",cSkin:"#deb887",cDark:"#ffd700",cSuit:"#b8860b",pType:"super_strength",pColor:"#ffd700",stance:"quadruped",w:36,h:24,mount:"back"},{id:"cheshirerat",name:"CHESHIRE RAT",type:"rodent",cSkin:"#da70d6",cDark:"#800080",cSuit:"#da70d6",pType:"grin_fade",pColor:"#da70d6",stance:"quadruped",w:36,h:24,mount:"back"},{id:"caferaven",name:"CAFE-RAVEN",type:"bird",cSkin:"#008B8B",cDark:"#90EE90",cSuit:"#90EE90",pType:"rocket",pColor:"#FFA500",trait:"fly",stance:"biped",w:24,h:30,mount:"hand"},{id:"grub",name:"VILLAIN-GRUB",type:"rodent",cSkin:"#ffe4e1",cDark:"#000",cSuit:"#696969",pType:"freeze_ray",pColor:"#add8e6",stance:"quadruped",w:36,h:24,mount:"back"},{id:"princemonster",name:"PRINCE-MONSTER",type:"alien",cSkin:"#000080",cDark:"#808000",cSuit:"#FFDEAD",pType:"gun",pColor:"#FFDEAD",stance:"biped",w:24,h:30,mount:"hand"},{id:"chefdeer",name:"CHEF-DEER",type:"goat",cSkin:"#800000",cDark:"#EEE8AA",cSuit:"#FFE4C4",pType:"rocket",pColor:"#000080",stance:"quadruped",w:36,h:24,mount:"back"},{id:"lightningmcqueen",name:"SPEED-BEE",type:"bee",cSkin:"#ff0000",cDark:"#ffd700",cSuit:"#ff0000",pType:"speed_sting",pColor:"#ffff00",trait:"fly",stance:"biped",w:24,h:30,mount:"hand"},{id:"devilcastle",name:"DEVIL-CASTLE",type:"stone",cSkin:"#48D1CC",cDark:"#008000",cSuit:"#0000FF",pType:"water_gun",pColor:"#7CFC00",stance:"biped",w:24,h:30,mount:"hand"},{id:"indianabones",name:"ARCHAEOLOGIST-DOG",type:"dog_pointy",cSkin:"#deb887",cDark:"#8b4513",cSuit:"#d2b48c",pType:"whip",pColor:"#8b4513",trait:"climb",stance:"quadruped",w:36,h:24,mount:"back",melee:!0},{id:"greensparrow",name:"GREEN SPAR-ROW",type:"bird",cSkin:"#006400",cDark:"#000",cSuit:"#228b22",pType:"bow",pColor:"#00ff00",trait:"fly",stance:"biped",w:24,h:30,mount:"hand"},{id:"johnlick",name:"ASSASSIN-DOG",type:"dog_pointy",cSkin:"#000",cDark:"#fff",cSuit:"#000",pType:"pencil",pColor:"#c0c0c0",stance:"quadruped",w:36,h:24,mount:"back"},{id:"fiony",name:"OGRE-PRINCESS",type:"horse",cSkin:"#32cd32",cDark:"#006400",cSuit:"#006400",pType:"karate_kick",pColor:"#32cd32",stance:"quadruped",w:36,h:24,mount:"back",melee:!0},{id:"neot",name:"THE-ONE-LIZARD",type:"lizard",cSkin:"#000",cDark:"#000",cSuit:"#000",pType:"bullet_time",pColor:"#fff",trait:"fly",stance:"quadruped",w:36,h:24,mount:"back"},{id:"tinkerbull",name:"FAIRY-BULL",type:"cow",cSkin:"#ffe4c4",cDark:"#ffd700",cSuit:"#00ff00",pType:"wand_sparkle",pColor:"#ffd700",trait:"fly",stance:"quadruped",w:36,h:24,mount:"back"},{id:"directorreindeer",name:"DIRECTOR-REINDEER",type:"goat",cSkin:"#8FBC8F",cDark:"#A52A2A",cSuit:"#00FA9A",pType:"gun",pColor:"#B0C4DE",trait:"fly",stance:"quadruped",w:36,h:24,mount:"back"},{id:"snowcrow",name:"CROW WHITE",type:"bird",cSkin:"#000",cDark:"#ff0000",cSuit:"#0000ff",pType:"apple_poison",pColor:"#ff0000",trait:"fly",stance:"biped",w:24,h:30,mount:"hand"},{id:"mooshu",name:"DRAGON-LIZARD",type:"lizard",cSkin:"#ff0000",cDark:"#ffd700",cSuit:"#ff0000",pType:"fire_spit",pColor:"#ff4500",stance:"quadruped",w:36,h:24,mount:"back"},{id:"murdererforest",name:"KILLER-TREE",type:"tree",cSkin:"#006400",cDark:"#F8F8FF",cSuit:"#4682B4",pType:"spread",pColor:"#008B8B",stance:"biped",w:24,h:30,mount:"hand",melee:!0},{id:"robbereagle",name:"ROBBER-EAGLE",type:"bird",cSkin:"#F8F8FF",cDark:"#4682B4",cSuit:"#3CB371",pType:"lightning",pColor:"#20B2AA",trait:"fly",stance:"biped",w:24,h:30,mount:"hand"},{id:"frodobaggins",name:"HOBBIT-CAT",type:"cat",cSkin:"#deb887",cDark:"#8b4513",cSuit:"#d2b48c",pType:"sting",pColor:"#00bfff",stance:"quadruped",w:36,h:24,mount:"back"},{id:"cap",body:"teardrop",name:"PATRIOT-EAGLE",type:"bird",cSkin:"#FFF",cDark:"#A52A2A",cSuit:"#0000FF",pType:"boomerang",pColor:"#FFF",trait:"fly",stance:"biped",w:24,h:30,mount:"hand"},{id:"docbrown",name:"TIME-DOC-DOG",type:"dog_long",cSkin:"#fff",cDark:"#ccc",cSuit:"#fff",pType:"flux_capacitor",pColor:"#00ffff",stance:"quadruped",w:36,h:24,mount:"back"},{id:"buzzlightbear",name:"SPACE-RANGER-BEAR",type:"bear",cSkin:"#fff",cDark:"#32cd32",cSuit:"#fff",pType:"laser_wrist",pColor:"#ff0000",trait:"fly",stance:"quadruped",w:36,h:24,mount:"back"},{id:"matear",name:"TOW-TRUCK-DOG",type:"dog_flat",cSkin:"#8b4513",cDark:"#2f4f4f",cSuit:"#8b4513",pType:"tow_hook",pColor:"#8b4513",stance:"quadruped",w:36,h:24,mount:"back"},{id:"musicianturkey",name:"MUSICIAN-TURKEY",type:"duck",cSkin:"#228B22",cDark:"#DEB887",cSuit:"#FFFAF0",pType:"spread",pColor:"#FF0000",trait:"fly",stance:"biped",w:24,h:30,mount:"hand"},{id:"doray",name:"DO-RAY",type:"fish",cSkin:"#4169e1",cDark:"#ffd700",cSuit:"#000",pType:"memory_loss",pColor:"#4169e1",stance:"fish",w:36,h:18,mount:"mouth"},{id:"composerfrog",name:"COMPOSER-FROG",type:"frog",cSkin:"#32CD32",cDark:"#006400",cSuit:"#9ACD32",pType:"boomerang",pColor:"#FFDEAD",stance:"biped",w:24,h:30,mount:"hand"},{id:"totoad",name:"TO-TOAD",type:"frog",cSkin:"#000",cDark:"#333",cSuit:"#000",pType:"lick",pColor:"#ff69b4",stance:"biped",w:24,h:30,mount:"hand"},{id:"journalistceiling",name:"JOURNALIST-CEILING",type:"stone",cSkin:"#FFDAB9",cDark:"#A0522D",cSuit:"#228B22",pType:"melee_slash",pColor:"#800000",stance:"biped",w:24,h:30,mount:"hand"},{id:"invisibull",name:"INVISI-BULL",type:"cow",cSkin:"rgba(255,255,255,0.5)",cDark:"rgba(0,0,0,0.5)",cSuit:"rgba(255,255,255,0.2)",pType:"mystery",pColor:"#fff",stance:"quadruped",w:36,h:24,mount:"back"},{id:"trollpeacock",name:"TROLL-PEACOCK",type:"bird",cSkin:"#8FBC8F",cDark:"#40E0D0",cSuit:"#00FF7F",pType:"gun",pColor:"#FFF5EE",trait:"fly",stance:"biped",w:24,h:30,mount:"hand"},{id:"professorkangaroo",name:"PROFESSOR-KANGAROO",type:"rabbit",cSkin:"#FFE4C4",cDark:"#C0C0C0",cSuit:"#000000",pType:"spread",pColor:"#40E0D0",stance:"biped",w:24,h:30,mount:"hand"},{id:"storestump",name:"STORE-STUMP",type:"tree",cSkin:"#006400",cDark:"#6495ED",cSuit:"#000000",pType:"boomerang",pColor:"#FFDEAD",stance:"biped",w:24,h:30,mount:"hand"},{id:"meowpheus",name:"MEOW-PHEUS",type:"cat",cSkin:"#222",cDark:"#000",cSuit:"#111",pType:"katana",pColor:"#800080",stance:"quadruped",w:36,h:24,mount:"back"},{id:"greenlantern",name:"COSMIC-CROW",type:"bird",cSkin:"#000",cDark:"#00ff00",cSuit:"#006400",pType:"construct",pColor:"#00ff00",trait:"fly",stance:"biped",w:24,h:30,mount:"hand"},{id:"lukeskydog",name:"JEDI-DOG",type:"dog_pointy",cSkin:"#fff",cDark:"#d4a76a",cSuit:"#fff",pType:"laser",pColor:"#00ff00",stance:"quadruped",w:36,h:24,mount:"back"},{id:"gollum",name:"OBSESSED-GOAT",type:"goat",cSkin:"#ffe4e1",cDark:"#d2b48c",cSuit:"#ffe4e1",pType:"rock_smash",pColor:"#808080",trait:"climb",stance:"quadruped",w:36,h:24,mount:"back"},{id:"leatherfish",name:"LEATHER-FISH",type:"fish",cSkin:"#f4a460",cDark:"#8b4513",cSuit:"#deb887",pType:"chainsaw",pColor:"#ffff00",stance:"fish",w:36,h:18,mount:"mouth",melee:!0},{id:"wolvie",name:"BERSERKER-WOLF",type:"dog_long",cSkin:"#8B4513",cDark:"#000",cSuit:"#FFFF00",pType:"melee_slash",pColor:"#C0C0C0",stance:"quadruped",w:36,h:24,mount:"back",melee:!0},{id:"jasonboarhees",name:"SLASHER-BOAR",type:"pig",cSkin:"#deb887",cDark:"#000",cSuit:"#000080",pType:"machete",pColor:"#c0c0c0",stance:"quadruped",w:36,h:24,mount:"back",melee:!0},{id:"aquamander",name:"AQUA-MANDER",type:"lizard",cSkin:"#ffd700",cDark:"#008000",cSuit:"#daa520",pType:"trident",pColor:"#00bfff",stance:"quadruped",w:36,h:24,mount:"back"},{id:"owladdin",name:"DESERT-OWL",type:"bird",cSkin:"#deb887",cDark:"#000",cSuit:"#fff",pType:"lamp_rub",pColor:"#ffd700",trait:"fly",stance:"biped",w:24,h:30,mount:"hand"},{id:"winter",name:"WINTER-WOLF",type:"dog_pointy",cSkin:"#FFF",cDark:"#808080",cSuit:"#000",pType:"gun",pColor:"#C0C0C0",stance:"quadruped",w:36,h:24,mount:"back"},{id:"zombiefish",name:"ZOMBIE-FISH",type:"fish",cSkin:"#F0F8FF",cDark:"#D2691E",cSuit:"#008000",pType:"ice_beam",pColor:"#F0FFFF",stance:"fish",w:36,h:18,mount:"mouth",melee:!0},{id:"scarecrow",name:"SCARE-CROW",type:"bird",cSkin:"#f5deb3",cDark:"#8b4513",cSuit:"#a0522d",pType:"straw_burst",pColor:"#f5deb3",trait:"fly",stance:"biped",w:24,h:30,mount:"hand"},{id:"makeupgate",name:"MAKEUP-GATE",type:"stone",cSkin:"#FFDEAD",cDark:"#F0F8FF",cSuit:"#D2B48C",pType:"fireball",pColor:"#008000",stance:"biped",w:24,h:30,mount:"hand"},{id:"dogzilla",name:"DOG-ZILLA",type:"dog_flat",cSkin:"#2f4f4f",cDark:"#000",cSuit:"#2f4f4f",pType:"atomic_breath",pColor:"#00bfff",stance:"quadruped",w:36,h:24,mount:"back"},{id:"catatouille",name:"CHEF-CAT",type:"cat",cSkin:"#808080",cDark:"#ffc0cb",cSuit:"#fff",pType:"spoon_whack",pColor:"#c0c0c0",stance:"quadruped",w:36,h:24,mount:"back",melee:!0},{id:"predatoad",name:"HUNTER-TOAD",type:"frog",cSkin:"#556b2f",cDark:"#8b4513",cSuit:"#a9a9a9",pType:"plasma_caster",pColor:"#00ffff",stance:"biped",w:24,h:30,mount:"hand"},{id:"nightllama",name:"NIGHT-LLAMA",type:"horse",cSkin:"#808000",cDark:"#008000",cSuit:"#FFFF00",pType:"melee_smash",pColor:"#FFFF00",stance:"quadruped",w:36,h:24,mount:"back"},{id:"peterprawn",name:"PETER PRAWN",type:"lizard",cSkin:"#ff7f50",cDark:"#008000",cSuit:"#006400",pType:"pixie_dust",pColor:"#ffd700",trait:"fly",stance:"quadruped",w:36,h:24,mount:"back"},{id:"lyin",name:"COWARDLY-LION",type:"lion",cSkin:"#deb887",cDark:"#8b4513",cSuit:"#deb887",pType:"courage_roar",pColor:"#ffd700",stance:"quadruped",w:36,h:24,mount:"back"},{id:"sunpegasus",name:"SUN-PEGASUS",type:"horse",cSkin:"#BDB76B",cDark:"#FFFAFA",cSuit:"#008000",pType:"lightning",pColor:"#0000CD",trait:"fly",stance:"quadruped",w:36,h:24,mount:"back"},{id:"hawkeye",name:"ARCHER-HEDGEHOG",type:"hedgehog",cSkin:"#D2B48C",cDark:"#8B4513",cSuit:"#800080",pType:"grenade",pColor:"#DDD",stance:"quadruped",w:36,h:24,mount:"back"},{id:"arielbird",name:"MERMAID-BIRD",type:"bird",cSkin:"#ffe4e1",cDark:"#ff0000",cSuit:"#00ced1",pType:"fork_comb",pColor:"#c0c0c0",trait:"fly",stance:"biped",w:24,h:30,mount:"hand"},{id:"galaxygod",name:"GALAXY-GOD",type:"human",cSkin:"#F0F8FF",cDark:"#BDB76B",cSuit:"#DAA520",pType:"shuriken",pColor:"#FAF0E6",trait:"fly",stance:"biped",w:24,h:30,mount:"hand"},{id:"homepumpkin",body:"orb",name:"HOME-PUMPKIN",type:"pumpkin",cSkin:"#FFA500",cDark:"#006400",cSuit:"#D3D3D3",pType:"ice_beam",pColor:"#ADFF2F",stance:"biped",w:24,h:30,mount:"hand"},{id:"falcon",body:"teardrop",name:"FALCON-PIGEON",type:"bird",cSkin:"#808080",cDark:"#696969",cSuit:"#FF0000",pType:"gun",pColor:"#CCC",trait:"fly",stance:"biped",w:24,h:30,mount:"hand"},{id:"edwardscissorclaws",name:"SCISSOR-CLAW",type:"lizard",cSkin:"#fff",cDark:"#000",cSuit:"#000",pType:"scissor_snip",pColor:"#c0c0c0",stance:"quadruped",w:36,h:24,mount:"back",melee:!0},{id:"ursulabear",body:"brute",name:"SEA-WITCH-BEAR",type:"bear",cSkin:"#dda0dd",cDark:"#fff",cSuit:"#000",pType:"ink_tentacle",pColor:"#800080",stance:"quadruped",w:36,h:24,mount:"back"},{id:"captainhaddock",name:"CAPTAIN HADDOCK",type:"fish",cSkin:"#4682b4",cDark:"#000",cSuit:"#ff0000",pType:"hook_hand",pColor:"#c0c0c0",stance:"fish",w:36,h:18,mount:"mouth",melee:!0},{id:"tarantula",name:"TAR-ANTULA",type:"lizard",cSkin:"#deb887",cDark:"#8b4513",cSuit:"#deb887",pType:"vine_swing",pColor:"#006400",trait:"climb",stance:"quadruped",w:36,h:24,mount:"back"},{id:"agentsniff",name:"AGENT SNIFF",type:"dog_pointy",cSkin:"#fff",cDark:"#000",cSuit:"#000",pType:"pistol",pColor:"#fff",stance:"quadruped",w:36,h:24,mount:"back"},{id:"mumbee",name:"MUM-BEE",type:"bee",cSkin:"#f5f5dc",cDark:"#d2b48c",cSuit:"#f5f5dc",pType:"wrap",pColor:"#fff",trait:"fly",stance:"biped",w:24,h:30,mount:"hand"},{id:"hospitalchipmunk",name:"HOSPITAL-CHIPMUNK",type:"rodent",cSkin:"#FFEFD5",cDark:"#FFFACD",cSuit:"#008B8B",pType:"card_throw",pColor:"#5F9EA0",trait:"climb",stance:"quadruped",w:36,h:24,mount:"back",melee:!0},{id:"phoenixdemon",name:"PHOENIX-DEMON",type:"goat",cSkin:"#EEE8AA",cDark:"#7FFF00",cSuit:"#6B8E23",pType:"grenade",pColor:"#FFE4C4",trait:"fly",stance:"quadruped",w:36,h:24,mount:"back"},{id:"michaelmeowers",name:"KILLER-CAT",type:"cat",cSkin:"#fff",cDark:"#000",cSuit:"#000080",pType:"knife",pColor:"#c0c0c0",stance:"quadruped",w:36,h:24,mount:"back",melee:!0},{id:"pug",name:"CYBORG-PUG",type:"dog_flat",cSkin:"#f3cf98",cDark:"#3b302a",cSuit:"#b0c4de",pType:"laser",pColor:"#a020f0",stance:"quadruped",w:36,h:24,mount:"back"},{id:"dogothy",name:"DOG-OTHY",type:"dog_flat",cSkin:"#deb887",cDark:"#8b4513",cSuit:"#87ceeb",pType:"basket",pColor:"#deb887",stance:"quadruped",w:36,h:24,mount:"back"},{id:"spider",body:"orb",name:"SPIDER-PIG",type:"pig",cSkin:"#FFC0CB",cDark:"#FF69B4",cSuit:"#FF0000",pType:"gun",pColor:"#FFF",trait:"climb",stance:"quadruped",w:36,h:24,mount:"back"},{id:"innmud",name:"INN-MUD",type:"stone",cSkin:"#FAF0E6",cDark:"#008080",cSuit:"#C0C0C0",pType:"card_throw",pColor:"#9ACD32",stance:"biped",w:24,h:30,mount:"hand"},{id:"et",name:"E.T. BEE",type:"bee",cSkin:"#deb887",cDark:"#8b4513",cSuit:"#deb887",pType:"finger_glow",pColor:"#ffd700",trait:"fly",stance:"biped",w:24,h:30,mount:"hand"},{id:"paintervillain",name:"PAINTER-VILLAIN",type:"human",cSkin:"#F0E68C",cDark:"#3CB371",cSuit:"#66CDAA",pType:"laser",pColor:"#F0F8FF",stance:"biped",w:24,h:30,mount:"hand",melee:!0},{id:"hairyotter",name:"HAIRY OTTER",type:"rodent",cSkin:"#8b4513",cDark:"#000",cSuit:"#000",pType:"magic_wand",pColor:"#ff0000",stance:"quadruped",w:36,h:24,mount:"back"},{id:"pinhead",name:"PIN-HOG",type:"pig",cSkin:"#fff",cDark:"#000",cSuit:"#000",pType:"chain_hook",pColor:"#c0c0c0",stance:"quadruped",w:36,h:24,mount:"back"},{id:"scarlet",name:"SCARLET-SKUNK",type:"skunk",cSkin:"#000",cDark:"#FFF",cSuit:"#FF0000",pType:"magic",pColor:"#FF0000",stance:"quadruped",w:36,h:24,mount:"back"},{id:"raccoon",name:"CPT TRASH",type:"raccoon",cSkin:"#888",cDark:"#444",cSuit:"#555",pType:"boomerang",pColor:"#aaa",stance:"biped",w:24,h:30,mount:"hand"},{id:"glinduck",name:"GOOD-WITCH-DUCK",type:"duck",cSkin:"#ffe4e1",cDark:"#ff69b4",cSuit:"#ffc0cb",pType:"bubble_wand",pColor:"#ffc0cb",trait:"fly",stance:"biped",w:24,h:30,mount:"hand"},{id:"aquariumforest",name:"AQUARIUM-FOREST",type:"tree",cSkin:"#FFFAFA",cDark:"#1E90FF",cSuit:"#556B2F",pType:"laser",pColor:"#F5F5DC",stance:"biped",w:24,h:30,mount:"hand"},{id:"drax",body:"muscular",name:"BOULDER-DOG",type:"dog_flat",cSkin:"#008000",cDark:"#FF0000",cSuit:"#000080",pType:"melee_slash",pColor:"#CCC",stance:"quadruped",w:36,h:24,mount:"back",melee:!0},{id:"shadowpanda",name:"SHADOW-PANDA",type:"bear",cSkin:"#6495ED",cDark:"#008080",cSuit:"#808080",pType:"melee_smash",pColor:"#F0F8FF",stance:"quadruped",w:36,h:24,mount:"back",melee:!0},{id:"unicorncyborg",name:"UNICORN-CYBORG",type:"robot",cSkin:"#6495ED",cDark:"#FFEBCD",cSuit:"#2E8B57",pType:"lightning",pColor:"#FFE4C4",stance:"biped",w:24,h:30,mount:"hand"},{id:"rambo",body:"muscular",name:"WAR-RAM",type:"goat",cSkin:"#deb887",cDark:"#000",cSuit:"#2f4f4f",pType:"machine_gun",pColor:"#ffd700",stance:"quadruped",w:36,h:24,mount:"back"},{id:"beetlegoose",name:"BEETLE-GOOSE",type:"duck",cSkin:"#fff",cDark:"#000",cSuit:"#000",pType:"bug_spit",pColor:"#00ff00",trait:"fly",stance:"biped",w:24,h:30,mount:"hand"},{id:"princessleia",name:"SPACE-PRINCESS-HEN",type:"chicken",cSkin:"#fff",cDark:"#ccc",cSuit:"#fff",pType:"laser",pColor:"#0000ff",stance:"biped",w:24,h:30,mount:"hand"},{id:"spectrebison",name:"SPECTRE-BISON",type:"cow",cSkin:"#FFF0F5",cDark:"#FFFFF0",cSuit:"#9ACD32",pType:"card_throw",pColor:"#FFDEAD",stance:"quadruped",w:36,h:24,mount:"back"},{id:"ghostfish",name:"GHOST-FISH",type:"fish",cSkin:"#fff",cDark:"#000",cSuit:"#000",pType:"scream_mask",pColor:"#fff",stance:"fish",w:36,h:18,mount:"mouth"},{id:"darthvadehound",name:"DARK-SIDE-HOUND",type:"dog_pointy",cSkin:"#000",cDark:"#111",cSuit:"#000",pType:"laser",pColor:"#ff0000",stance:"quadruped",w:36,h:24,mount:"back"},{id:"eelsad",name:"ICE-QUEEN-EEL",type:"fish",cSkin:"#add8e6",cDark:"#fff",cSuit:"#00bfff",pType:"ice_palace",pColor:"#e0ffff",stance:"fish",w:36,h:18,mount:"mouth"},{id:"incrabible",name:"MR CRAB-TASTIC",type:"lizard",cSkin:"#ff0000",cDark:"#000",cSuit:"#ff0000",pType:"claw_smash",pColor:"#ff0000",stance:"quadruped",w:36,h:24,mount:"back",melee:!0},{id:"pennywise",name:"CLOWN-HEN",type:"chicken",cSkin:"#fff",cDark:"#ff0000",cSuit:"#c0c0c0",pType:"balloon",pColor:"#ff0000",stance:"biped",w:24,h:30,mount:"hand"},{id:"war",body:"brute",name:"WAR-RHINO",type:"rhino",cSkin:"#708090",cDark:"#2F4F4F",cSuit:"#000",pType:"grenade",pColor:"#999",stance:"quadruped",w:36,h:24,mount:"back"},{id:"grinchfinch",name:"GRINCH FINCH",type:"bird",cSkin:"#32cd32",cDark:"#006400",cSuit:"#ff0000",pType:"ornament_bomb",pColor:"#ff0000",trait:"fly",stance:"biped",w:24,h:30,mount:"hand"},{id:"pussinboats",name:"SWASHBUCKLER-CAT",type:"cat",cSkin:"#ffa500",cDark:"#000",cSuit:"#8b4513",pType:"rapier",pColor:"#c0c0c0",stance:"quadruped",w:36,h:24,mount:"back"},{id:"hantoad",name:"SMUGGLER-TOAD",type:"frog",cSkin:"#556b2f",cDark:"#000",cSuit:"#000",pType:"laser",pColor:"#ff0000",stance:"biped",w:24,h:30,mount:"hand"},{id:"tinram",name:"TIN RAM",type:"goat",cSkin:"#c0c0c0",cDark:"#808080",cSuit:"#c0c0c0",pType:"oil_can",pColor:"#000",stance:"quadruped",w:36,h:24,mount:"back"},{id:"rockybalboa",body:"muscular",name:"BOXER-SNAKE",type:"snake",cSkin:"#8b4513",cDark:"#000",cSuit:"#000080",pType:"boxing_glove",pColor:"#ff0000",stance:"snake",w:36,h:18,mount:"mouth"},{id:"professorskunk",name:"PROFESSOR-SKUNK",type:"skunk",cSkin:"#F4A460",cDark:"#800000",cSuit:"#2F4F4F",pType:"rocket",pColor:"#800000",stance:"quadruped",w:36,h:24,mount:"back"},{id:"sparock",name:"SPA-ROCK",type:"stone",cSkin:"#000000",cDark:"#DEB887",cSuit:"#000080",pType:"lightning",pColor:"#0000FF",stance:"biped",w:24,h:30,mount:"hand"},{id:"directordirt",name:"DIRECTOR-DIRT",type:"stone",cSkin:"#00FA9A",cDark:"#F5FFFA",cSuit:"#FFFAFA",pType:"spread",pColor:"#008080",stance:"biped",w:24,h:30,mount:"hand"},{id:"factoryskeleton",body:"stick",name:"FACTORY-SKELETON",type:"skeleton",cSkin:"#FDF5E6",cDark:"#FFFACD",cSuit:"#556B2F",pType:"acid_spit",pColor:"#F5F5F5",stance:"biped",w:24,h:30,mount:"hand"},{id:"shehulk",body:"muscular",name:"GAMMA-HAMSTER",type:"rodent",cSkin:"#32CD32",cDark:"#006400",cSuit:"#800080",pType:"melee_smash",pColor:"#00FF00",stance:"quadruped",w:36,h:24,mount:"back"},{id:"whalee",body:"block",name:"ROBOT-WHALE",type:"fish",cSkin:"#ffd700",cDark:"#808080",cSuit:"#ffd700",pType:"trash_cube",pColor:"#8b4513",stance:"fish",w:36,h:18,mount:"mouth"},{id:"hanniball",name:"CANNIBAL-PIG",type:"pig",cSkin:"#ffc0cb",cDark:"#a52a2a",cSuit:"#fff",pType:"mask_bite",pColor:"#a52a2a",stance:"quadruped",w:36,h:24,mount:"back"},{id:"aquaalpaca",name:"AQUA-ALPACA",type:"horse",cSkin:"#FFE4E1",cDark:"#FFDEAD",cSuit:"#F5DEB3",pType:"rocket",pColor:"#FAFAD2",stance:"quadruped",w:36,h:24,mount:"back"},{id:"ant",body:"stick",name:"ANT-EATER-MAN",type:"anteater",cSkin:"#808080",cDark:"#404040",cSuit:"#FF0000",pType:"melee_smash",pColor:"#FF0000",trait:"climb",stance:"quadruped",w:36,h:24,mount:"back",melee:!0},{id:"creaturehedgehog",name:"CREATURE-HEDGEHOG",type:"hedgehog",cSkin:"#00FF00",cDark:"#DAA520",cSuit:"#008B8B",pType:"melee_smash",pColor:"#40E0D0",stance:"quadruped",w:36,h:24,mount:"back"},{id:"alienboulder",name:"ALIEN-BOULDER",type:"stone",cSkin:"#808080",cDark:"#FAEBD7",cSuit:"#006400",pType:"ice_beam",pColor:"#00BFFF",stance:"biped",w:24,h:30,mount:"hand"},{id:"gandalfthegreyhound",name:"WIZARD-HOUND",type:"dog_long",cSkin:"#d3d3d3",cDark:"#a9a9a9",cSuit:"#808080",pType:"staff_magic",pColor:"#fff",stance:"quadruped",w:36,h:24,mount:"back"},{id:"jamespond",name:"SECRET-AGENT-FROG",type:"frog",cSkin:"#006400",cDark:"#000",cSuit:"#000",pType:"silencer",pColor:"#c0c0c0",stance:"biped",w:24,h:30,mount:"hand"},{id:"jafrog",name:"VIZIER-FROG",type:"frog",cSkin:"#deb887",cDark:"#000",cSuit:"#000",pType:"snake_staff",pColor:"#ffd700",stance:"biped",w:24,h:30,mount:"hand"},{id:"rocket",name:"ROCKET-RABBIT",type:"rabbit",cSkin:"#A9A9A9",cDark:"#696969",cSuit:"#FF4500",pType:"grenade",pColor:"#FF4500",trait:"fly",stance:"biped",w:24,h:30,mount:"hand"},{id:"simbasheep",name:"KING-SHEEP",type:"goat",cSkin:"#ffd700",cDark:"#8b4513",cSuit:"#ffd700",pType:"circle_life",pColor:"#ffd700",stance:"quadruped",w:36,h:24,mount:"back"},{id:"martymcfly",name:"TIME-FLY",type:"bee",cSkin:"#daa520",cDark:"#000",cSuit:"#ff4500",pType:"hoverboard",pColor:"#ff69b4",trait:"fly",stance:"biped",w:24,h:30,mount:"hand"},{id:"queenofharts",name:"QUEEN OF HARTS",type:"goat",cSkin:"#fff",cDark:"#ff0000",cSuit:"#000",pType:"card_soldier",pColor:"#ff0000",stance:"quadruped",w:36,h:24,mount:"back"},{id:"shrewk",body:"brute",name:"OGRE-SHREW",type:"rodent",cSkin:"#32cd32",cDark:"#556b2f",cSuit:"#f5f5dc",pType:"onion_gas",pColor:"#32cd32",stance:"quadruped",w:36,h:24,mount:"back"},{id:"quick",name:"QUICK-CHEETAH",type:"cat",cSkin:"#D3D3D3",cDark:"#A9A9A9",cSuit:"#87CEEB",pType:"melee_slash",pColor:"#87CEEB",stance:"quadruped",w:36,h:24,mount:"back",melee:!0},{id:"darklog",name:"DARK-LOG",type:"tree",cSkin:"#F0E68C",cDark:"#00FFFF",cSuit:"#00CED1",pType:"water_gun",pColor:"#FFFFFF",stance:"biped",w:24,h:30,mount:"hand"},{id:"mrtomatohead",body:"orb",name:"MR TOMATO HEAD",type:"pumpkin",cSkin:"#ff0000",cDark:"#000",cSuit:"#0000ff",pType:"parts_throw",pColor:"#fff",stance:"biped",w:24,h:30,mount:"hand"},{id:"alienlion",name:"ALIEN-LION",type:"cat",cSkin:"#87CEFA",cDark:"#008B8B",cSuit:"#708090",pType:"melee_slash",pColor:"#00FF00",stance:"quadruped",w:36,h:24,mount:"back"},{id:"vision",name:"ANDROID-ZEBRA",type:"horse",cSkin:"#FFC0CB",cDark:"#008000",cSuit:"#FFFF00",pType:"laser",pColor:"#FFFF00",trait:"fly",stance:"quadruped",w:36,h:24,mount:"back"},{id:"shopstone",name:"SHOP-STONE",type:"stone",cSkin:"#F0FFFF",cDark:"#A0522D",cSuit:"#FFEFD5",pType:"fireball",pColor:"#E6E6FA",stance:"biped",w:24,h:30,mount:"hand"},{id:"chucky",name:"DOLL-CHICKEN",type:"chicken",cSkin:"#ffe4c4",cDark:"#ff4500",cSuit:"#0000ff",pType:"knife_doll",pColor:"#c0c0c0",stance:"biped",w:24,h:30,mount:"hand"},{id:"strange",name:"SORCERER-CAT",type:"cat",cSkin:"#444",cDark:"#222",cSuit:"#0000FF",pType:"magic",pColor:"#FFA500",stance:"quadruped",w:36,h:24,mount:"back"},{id:"terminator",body:"brute",name:"TERMIN-GATOR",type:"croc",cSkin:"#2f4f4f",cDark:"#000",cSuit:"#000",pType:"shotgun",pColor:"#ff0000",stance:"quadruped",w:36,h:24,mount:"back"},{id:"cyboar",name:"CY-BOAR",type:"pig",cSkin:"#c0c0c0",cDark:"#000",cSuit:"#808080",pType:"cannon",pColor:"#00ffff",stance:"quadruped",w:36,h:24,mount:"back"},{id:"shalamb",name:"GOD-LAMB",type:"goat",cSkin:"#fff",cDark:"#ffd700",cSuit:"#ff0000",pType:"lightning_shout",pColor:"#ffd700",trait:"fly",stance:"quadruped",w:36,h:24,mount:"back"},{id:"dare",body:"muscular",name:"BLIND-JUSTICE-DOG",type:"dog_pointy",cSkin:"#B22222",cDark:"#800000",cSuit:"#FF0000",pType:"melee_slash",pColor:"#FF0000",stance:"quadruped",w:36,h:24,mount:"back",melee:!0},{id:"restaurantwolf",name:"RESTAURANT-WOLF",type:"wolf",cSkin:"#191970",cDark:"#FFE4C4",cSuit:"#B8860B",pType:"ice_beam",pColor:"#E6E6FA",stance:"quadruped",w:36,h:24,mount:"back"},{id:"wraithhouse",name:"WRAITH-HOUSE",type:"stone",cSkin:"#800000",cDark:"#98FB98",cSuit:"#000080",pType:"acid_spit",pColor:"#5F9EA0",stance:"biped",w:24,h:30,mount:"hand"},{id:"ranchwombat",body:"orb",name:"RANCH-WOMBAT",type:"rodent",cSkin:"#708090",cDark:"#D3D3D3",cSuit:"#000080",pType:"melee_slash",pColor:"#FFE4C4",trait:"climb",stance:"quadruped",w:36,h:24,mount:"back",melee:!0},{id:"owlaf",name:"SNOW-OWL",type:"bird",cSkin:"#fff",cDark:"#ff8c00",cSuit:"#fff",pType:"snow_flurry",pColor:"#fff",trait:"fly",stance:"biped",w:24,h:30,mount:"hand"},{id:"genieguinea",name:"GENIE-GUINEA",type:"rodent",cSkin:"#00bfff",cDark:"#ffd700",cSuit:"#00bfff",pType:"wish_grant",pColor:"#00bfff",trait:"fly",stance:"quadruped",w:36,h:24,mount:"back"},{id:"flashfish",name:"SPEEDSTER-FISH",type:"fish",cSkin:"#ff0000",cDark:"#ffd700",cSuit:"#ff0000",pType:"speed_bolt",pColor:"#ffd700",stance:"fish",w:36,h:18,mount:"mouth"},{id:"trinibee",name:"MATRIX-BEE",type:"bee",cSkin:"#000",cDark:"#ffff00",cSuit:"#000",pType:"dual_pistol",pColor:"#fff",trait:"fly",stance:"biped",w:24,h:30,mount:"hand"},{id:"bakerhamster",name:"BAKER-HAMSTER",type:"rodent",cSkin:"#808000",cDark:"#00FFFF",cSuit:"#2E8B57",pType:"fireball",pColor:"#87CEEB",stance:"quadruped",w:36,h:24,mount:"back",melee:!0},{id:"pup",name:"FLOATING-PUP",type:"dog_pointy",cSkin:"#deb887",cDark:"#8b4513",cSuit:"#a0522d",pType:"balloon_house",pColor:"#ff0000",trait:"fly",stance:"quadruped",w:36,h:24,mount:"back"},{id:"ironmouse",name:"MECH-MOUSE",type:"rodent",cSkin:"#808080",cDark:"#404040",cSuit:"#FF0000",pType:"laser",pColor:"#FFFF00",trait:"fly",stance:"quadruped",w:36,h:24,mount:"back"},{id:"lordblob",name:"LORD-BLOB",type:"alien",cSkin:"#008B8B",cDark:"#F8F8FF",cSuit:"#F0E68C",pType:"water_gun",pColor:"#800080",stance:"biped",w:24,h:30,mount:"hand",melee:!0},{id:"wolfclam",name:"WOLF-CLAM",type:"wolf",cSkin:"#8b4513",cDark:"#000",cSuit:"#8b4513",pType:"pearl",pColor:"#fff",stance:"quadruped",w:36,h:24,mount:"back"},{id:"panther",body:"muscular",name:"JUNGLE-PANTHER",type:"cat",cSkin:"#111",cDark:"#000",cSuit:"#222",pType:"melee_slash",pColor:"#800080",trait:"climb",stance:"quadruped",w:36,h:24,mount:"back",melee:!0},{id:"stylistearth",name:"STYLIST-EARTH",type:"stone",cSkin:"#006400",cDark:"#F0E68C",cSuit:"#00CED1",pType:"card_throw",pColor:"#90EE90",stance:"biped",w:24,h:30,mount:"hand",melee:!0},{id:"mageslime",name:"MAGE-SLIME",type:"alien",cSkin:"#00FA9A",cDark:"#BDB76B",cSuit:"#8FBC8F",pType:"melee_smash",pColor:"#008080",stance:"biped",w:24,h:30,mount:"hand"},{id:"stormgrouper",name:"STORM-GROUPER",type:"fish",cSkin:"#fff",cDark:"#000",cSuit:"#fff",pType:"laser",pColor:"#ff0000",stance:"fish",w:36,h:18,mount:"mouth"},{id:"hulk",body:"brute",name:"GAMMA-POODLE",type:"poodle",cSkin:"#00FF00",cDark:"#006400",cSuit:"#800080",pType:"melee_smash",pColor:"#00FF00",stance:"biped",w:24,h:30,mount:"hand",melee:!0},{id:"frankenswine",name:"FRANK-EN-SWINE",type:"pig",cSkin:"#90ee90",cDark:"#000",cSuit:"#2f4f4f",pType:"bolt_neck",pColor:"#c0c0c0",stance:"quadruped",w:36,h:24,mount:"back"},{id:"punish",name:"VIGILANTE-PENGUIN",type:"bird",cSkin:"#000",cDark:"#FFF",cSuit:"#000",pType:"spread",pColor:"#FFF",stance:"biped",w:24,h:30,mount:"hand"},{id:"sulleyseal",name:"MONSTER-SEAL",type:"fish",cSkin:"#00ced1",cDark:"#800080",cSuit:"#00ced1",pType:"scare_roar",pColor:"#00ced1",stance:"fish",w:36,h:18,mount:"mouth"},{id:"firedonkey",name:"FIRE-DONKEY",type:"horse",cSkin:"#191970",cDark:"#800000",cSuit:"#2F4F4F",pType:"water_gun",pColor:"#EEE8AA",stance:"quadruped",w:36,h:24,mount:"back",melee:!0},{id:"spyboulder",name:"SPY-BOULDER",type:"stone",cSkin:"#7FFFD4",cDark:"#ADD8E6",cSuit:"#E6E6FA",pType:"card_throw",pColor:"#98FB98",stance:"biped",w:24,h:30,mount:"hand"},{id:"corgi",body:"muscular",name:"THUNDER-CORGI",type:"dog_pointy",cSkin:"#E3C099",cDark:"#FFF",cSuit:"#333",pType:"boomerang",pColor:"#00FFFF",stance:"quadruped",w:36,h:24,mount:"back"},{id:"vipear",name:"VI-PEAR",type:"snake",cSkin:"#32cd32",cDark:"#006400",cSuit:"#9acd32",pType:"fang_strike",pColor:"#9acd32",stance:"snake",w:36,h:18,mount:"mouth"},{id:"cat",name:"VAMPIRE-CAT",type:"cat",cSkin:"#222",cDark:"#000",cSuit:"#111",pType:"boomerang",pColor:"#ff69b4",trait:"climb",stance:"quadruped",w:36,h:24,mount:"back",melee:!0},{id:"jacksparrow",name:"PIRATE-SPARROW",type:"bird",cSkin:"#8b4513",cDark:"#000",cSuit:"#a52a2a",pType:"flintlock",pColor:"#c0c0c0",trait:"fly",stance:"biped",w:24,h:30,mount:"hand"},{id:"nemoo",name:"NE-MOO",type:"cow",cSkin:"#ffa500",cDark:"#fff",cSuit:"#ffa500",pType:"bubble_stream",pColor:"#add8e6",stance:"quadruped",w:36,h:24,mount:"back"},{id:"bobaferret",name:"BOUNTY-FERRET",type:"rodent",cSkin:"#556b2f",cDark:"#2f4f4f",cSuit:"#808080",pType:"rocket",pColor:"#00ff00",trait:"fly",stance:"quadruped",w:36,h:24,mount:"back"},{id:"homelizard",name:"HOME-LIZARD",type:"lizard",cSkin:"#808000",cDark:"#CD853F",cSuit:"#BC8F8F",pType:"melee_slash",pColor:"#FFF8DC",trait:"climb",stance:"quadruped",w:36,h:24,mount:"back"},{id:"nunturtle",name:"NUN-TURTLE",type:"turtle",cSkin:"#2E8B57",cDark:"#006400",cSuit:"#FFFAFA",pType:"melee_slash",pColor:"#FFE4E1",stance:"quadruped",w:36,h:24,mount:"back",melee:!0},{id:"jocurr",name:"JESTER-CUR",type:"dog_pointy",cSkin:"#fff",cDark:"#00ff00",cSuit:"#800080",pType:"gas",pColor:"#00ff00",stance:"quadruped",w:36,h:24,mount:"back"},{id:"eternal",name:"ETERNAL-ELEPHANT",type:"elephant",cSkin:"#808080",cDark:"#696969",cSuit:"#FFD700",pType:"magic",pColor:"#FFD700",stance:"quadruped",w:36,h:24,mount:"back"},{id:"artistalien",name:"ARTIST-ALIEN",type:"alien",cSkin:"#FFEBCD",cDark:"#ADFF2F",cSuit:"#0000CD",pType:"ice_beam",pColor:"#F5F5F5",stance:"biped",w:24,h:30,mount:"hand"},{id:"polarbear",name:"PO-LAR BEAR",type:"bear",cSkin:"#fff",cDark:"#000",cSuit:"#d2b48c",pType:"noodle_bowl",pColor:"#ffd700",stance:"quadruped",w:36,h:24,mount:"back"},{id:"frozonefrog",name:"FROST-FROG",type:"frog",cSkin:"#00bfff",cDark:"#fff",cSuit:"#00bfff",pType:"ice_slide",pColor:"#e0ffff",stance:"biped",w:24,h:30,mount:"hand"},{id:"forrestgrump",name:"RUNNER-BEAR",type:"bear",cSkin:"#8b4513",cDark:"#000",cSuit:"#add8e6",pType:"chocolate_box",pColor:"#8b4513",stance:"quadruped",w:36,h:24,mount:"back"},{id:"convictchicken",name:"CONVICT-CHICKEN",type:"duck",cSkin:"#D2691E",cDark:"#FFEBCD",cSuit:"#808080",pType:"grenade",pColor:"#FFFF00",trait:"fly",stance:"biped",w:24,h:30,mount:"hand"},{id:"oozecrow",name:"OOZE-CROW",type:"bird",cSkin:"#ADD8E6",cDark:"#228B22",cSuit:"#778899",pType:"lightning",pColor:"#9ACD32",trait:"fly",stance:"biped",w:24,h:30,mount:"hand"},{id:"paramedicpeacock",name:"PARAMEDIC-PEACOCK",type:"bird",cSkin:"#00FF00",cDark:"#FFF0F5",cSuit:"#0000FF",pType:"laser",pColor:"#FDF5E6",trait:"fly",stance:"biped",w:24,h:30,mount:"hand",melee:!0},{id:"skeletonram",body:"stick",name:"SKELETON-RAM",type:"goat",cSkin:"#006400",cDark:"#800080",cSuit:"#00FA9A",pType:"gun",pColor:"#B0C4DE",stance:"quadruped",w:36,h:24,mount:"back"},{id:"mikewacowski",body:"orb",name:"EYE-BALL-COW",type:"cow",cSkin:"#32cd32",cDark:"#fff",cSuit:"#32cd32",pType:"eye_beam",pColor:"#32cd32",stance:"quadruped",w:36,h:24,mount:"back"},{id:"rex",name:"DINO-DOG",type:"dog_pointy",cSkin:"#32cd32",cDark:"#006400",cSuit:"#32cd32",pType:"tail_whip",pColor:"#32cd32",stance:"quadruped",w:36,h:24,mount:"back",melee:!0},{id:"gamora",name:"JUNGLE-GECKO",type:"lizard",cSkin:"#00FF00",cDark:"#006400",cSuit:"#000",pType:"melee_slash",pColor:"#00FF00",trait:"climb",stance:"quadruped",w:36,h:24,mount:"back",melee:!0},{id:"roarschach",name:"INK-BLOT-LION",type:"lion",cSkin:"#deb887",cDark:"#000",cSuit:"#8b4513",pType:"ink_blot",pColor:"#000",stance:"quadruped",w:36,h:24,mount:"back"}],m={screen:"MENU",running:!1,score:0,cameraX:0,cameraY:0,shake:0,frame:0,checkpointsHit:0,rescues:0,lives:3,unlockedCount:parseInt(localStorage.getItem("loajf_unlocked")||"1"),globalUnlocked:parseInt(localStorage.getItem("loajf_unlocked")||"1"),spawnPoint:{x:100,y:0},bossActive:!1,hitStop:0,zoom:1,currentLevel:1,levelData:{biome:"forest",difficulty:1,width:400,height:60},slowMo:1,levelCompleteStats:{kills:0,rescues:0,time:0}};let g=[],b=[],k=[],S=[],T=[],w=[],v=[],x=null,C=0,E=[{},{},{},{}];function D(e){k=e}function F(e){S=e}function M(e){T=e}function A(e){w=e}function P(e){v=e}function R(e){x=e}function I(e){C=e}function O(){let e=v&&v[0];if(!e)return;let t="‚ù§".repeat(Math.max(0,e.health));if(v.length>1){t+=" | ";for(let e=1;e<v.length;e++)t+="P"+(e+1)+":"+"‚ù§".repeat(Math.max(0,v[e].health))+" "}document.getElementById("healthDisplay").innerText=t,document.getElementById("scoreDisplay").innerText=m.score,document.getElementById("rescueDisplay").innerText=m.rescues,document.getElementById("livesDisplay").innerText=m.lives,document.getElementById("levelDisplay").innerText=m.currentLevel;let i=e.charData?e.charData.name:"UNKNOWN";v.length>1&&(i+=" + TEAM"),document.getElementById("charName").innerText=i,e.charData&&(document.getElementById("charName").style.color=e.charData.cSkin)}const B=new class{constructor(){this.ctx=null,this.masterGain=null,this.musicGain=null,this.sfxGain=null,this.muted=!1,this.volume=.3,this.initialized=!1,this.isPlaying=!1,this.nextNoteTime=0,this.currentBeat=0,this.tempo=130,this.lookahead=25,this.scheduleAheadTime=.1,this.timerID=null,this.bassLine=[41.2,41.2,49,41.2,55,49,41.2,36.7,41.2,41.2,49,41.2,61.7,55,49,55]}init(){if(!this.initialized)try{const e=window.AudioContext||window.webkitAudioContext;this.ctx=new e,this.masterGain=this.ctx.createGain(),this.masterGain.connect(this.ctx.destination),this.musicGain=this.ctx.createGain(),this.musicGain.connect(this.masterGain),this.musicGain.gain.value=.4,this.sfxGain=this.ctx.createGain(),this.sfxGain.connect(this.masterGain),this.sfxGain.gain.value=.6,this.updateMuteState(),this.initialized=!0,console.log("Audio Context Initialized")}catch(e){console.error("Web Audio API not supported",e)}}toggleMute(){return this.muted=!this.muted,this.updateMuteState(),this.muted}updateMuteState(){this.masterGain&&this.ctx&&this.masterGain.gain.setValueAtTime(this.muted?0:this.volume,this.ctx.currentTime)}playMusic(){this.initialized||this.init(),this.isPlaying||(this.isPlaying=!0,this.currentBeat=0,this.nextNoteTime=this.ctx.currentTime+.1,this.scheduler())}stopMusic(){this.isPlaying=!1,clearTimeout(this.timerID)}scheduler(){if(this.isPlaying){for(;this.nextNoteTime<this.ctx.currentTime+this.scheduleAheadTime;)this.scheduleNote(this.currentBeat,this.nextNoteTime),this.nextNote();this.timerID=setTimeout(()=>this.scheduler(),this.lookahead)}}nextNote(){const e=60/this.tempo;this.nextNoteTime+=.25*e,this.currentBeat=(this.currentBeat+1)%16}scheduleNote(e,t){if(0!==e&&8!==e&&14!==e||this.playKick(t),4!==e&&12!==e||this.playSnare(t),e%2==0&&this.playHiHat(t,e%4==0?.1:.05),e%2==0){let i=e/2%this.bassLine.length,a=this.bassLine[i];this.playBass(t,a)}}playKick(e){if(this.muted)return;const t=this.ctx.createOscillator(),i=this.ctx.createGain();t.connect(i),i.connect(this.musicGain),t.frequency.setValueAtTime(150,e),t.frequency.exponentialRampToValueAtTime(.01,e+.5),i.gain.setValueAtTime(.8,e),i.gain.exponentialRampToValueAtTime(.01,e+.5),t.start(e),t.stop(e+.5)}playSnare(e){if(this.muted)return;const t=.2*this.ctx.sampleRate,i=this.ctx.createBuffer(1,t,this.ctx.sampleRate),a=i.getChannelData(0);for(let e=0;e<t;e++)a[e]=2*Math.random()-1;const l=this.ctx.createBufferSource();l.buffer=i;const s=this.ctx.createBiquadFilter();s.type="highpass",s.frequency.value=1e3;const n=this.ctx.createGain();l.connect(s),s.connect(n),n.connect(this.musicGain),n.gain.setValueAtTime(.4,e),n.gain.exponentialRampToValueAtTime(.01,e+.2),l.start(e);const h=this.ctx.createOscillator(),o=this.ctx.createGain();h.connect(o),o.connect(this.musicGain),h.type="triangle",h.frequency.setValueAtTime(200,e),o.gain.setValueAtTime(.2,e),o.gain.exponentialRampToValueAtTime(.01,e+.1),h.start(e),h.stop(e+.1)}playHiHat(e,t){if(this.muted)return;const i=.05*this.ctx.sampleRate,a=this.ctx.createBuffer(1,i,this.ctx.sampleRate),l=a.getChannelData(0);for(let e=0;e<i;e++)l[e]=2*Math.random()-1;const s=this.ctx.createBufferSource();s.buffer=a;const n=this.ctx.createBiquadFilter();n.type="highpass",n.frequency.value=5e3;const h=this.ctx.createGain();s.connect(n),n.connect(h),h.connect(this.musicGain),h.gain.setValueAtTime(.3*t,e),h.gain.exponentialRampToValueAtTime(.01,e+.05),s.start(e)}playBass(e,t){if(this.muted)return;const i=this.ctx.createOscillator(),a=this.ctx.createGain(),l=this.ctx.createWaveShaper();l.curve=function(e){let t,i=e,a=44100,l=new Float32Array(a),s=Math.PI/180,n=0;for(;n<a;++n)t=2*n/a-1,l[n]=(3+i)*t*20*s/(Math.PI+i*Math.abs(t));return l}(100),l.oversample="4x",i.type="sawtooth",i.frequency.setValueAtTime(t,e);const s=this.ctx.createBiquadFilter();s.type="lowpass",s.frequency.setValueAtTime(800,e),s.frequency.linearRampToValueAtTime(100,e+.2),i.connect(l),l.connect(s),s.connect(a),a.connect(this.musicGain),a.gain.setValueAtTime(.15,e),a.gain.exponentialRampToValueAtTime(.01,e+.25),i.start(e),i.stop(e+.25)}play(e){if(this.initialized||this.init(),this.muted||!this.ctx)return;"suspended"===this.ctx.state&&this.ctx.resume().catch(e=>console.error(e));const t=this.ctx.currentTime,i=this.ctx.createOscillator(),a=this.ctx.createGain();switch(i.connect(a),a.connect(this.sfxGain),e){case"jump":i.type="square",i.frequency.setValueAtTime(150,t),i.frequency.exponentialRampToValueAtTime(600,t+.1),a.gain.setValueAtTime(.1,t),a.gain.exponentialRampToValueAtTime(.01,t+.1),i.start(t),i.stop(t+.1);break;case"shoot":i.type="square",i.frequency.setValueAtTime(800,t),i.frequency.exponentialRampToValueAtTime(100,t+.15),a.gain.setValueAtTime(.1,t),a.gain.exponentialRampToValueAtTime(.01,t+.15),i.start(t),i.stop(t+.15);break;case"enemy_shoot":i.type="triangle",i.frequency.setValueAtTime(400,t),i.frequency.exponentialRampToValueAtTime(100,t+.2),a.gain.setValueAtTime(.1,t),a.gain.exponentialRampToValueAtTime(.01,t+.2),i.start(t),i.stop(t+.2);break;case"explosion":i.type="sawtooth",i.frequency.setValueAtTime(100,t),i.frequency.exponentialRampToValueAtTime(10,t+.4);const e=this.ctx.createOscillator();e.type="square",e.frequency.setValueAtTime(80,t),e.frequency.exponentialRampToValueAtTime(5,t+.4),e.connect(a),e.start(t),e.stop(t+.4),a.gain.setValueAtTime(.3,t),a.gain.exponentialRampToValueAtTime(.01,t+.4),i.start(t),i.stop(t+.4);break;case"powerup":i.type="sine",i.frequency.setValueAtTime(440,t),i.frequency.setValueAtTime(554,t+.1),i.frequency.setValueAtTime(659,t+.2),i.frequency.setValueAtTime(880,t+.3),a.gain.setValueAtTime(.1,t),a.gain.linearRampToValueAtTime(.1,t+.3),a.gain.exponentialRampToValueAtTime(.01,t+.6),i.start(t),i.stop(t+.6);break;case"hurt":i.type="sawtooth",i.frequency.setValueAtTime(200,t),i.frequency.linearRampToValueAtTime(50,t+.2),a.gain.setValueAtTime(.1,t),a.gain.exponentialRampToValueAtTime(.01,t+.2),i.start(t),i.stop(t+.2);break;case"brick_break":i.type="square",i.frequency.setValueAtTime(100,t),i.frequency.exponentialRampToValueAtTime(20,t+.1),a.gain.setValueAtTime(.2,t),a.gain.exponentialRampToValueAtTime(.01,t+.1),i.start(t),i.stop(t+.1)}}};function N(){m.running=!1,B&&B.stopMusic(),document.getElementById("lcKills").innerText=m.levelCompleteStats.kills,document.getElementById("lcRescues").innerText=m.rescues,document.getElementById("lcTime").innerText=Math.floor((1e4-m.frame)/60),document.getElementById("levelCompleteOverlay").style.display="flex"}function L(){m.running=!1,B&&B.stopMusic(),document.getElementById("ovTitle").innerText="MISSION FAILED",document.getElementById("ovTitle").style.color="red",document.getElementById("ovMsg").innerText="Out of lives. The pound awaits.",document.getElementById("gameOverOverlay").style.display="flex"}const q=[null,null,null,null];let _=[{},{},{},{}];function G(){return Math.random()}function H(e,t,i,a,l,s,n,h){return l<e+i&&l+n>e&&s<t+a&&s+h>t}function U(e,t){return!(!e||!t)&&H(e.x,e.y,e.w,e.h,t.x,t.y,t.w,t.h)}class W{constructor(e,t,i){this.x=e,this.y=t,this.color=i,this.life=1,this.vx=8*(G()-.5),this.vy=8*(G()-.5),this.size=6*G()+3}update(){this.x+=this.vx,this.y+=this.vy,this.vy+=.4,this.life-=.05}draw(e,t,i,a){e.save(),e.fillStyle=this.color,e.globalAlpha=Math.max(0,this.life),e.beginPath(),e.arc(this.x-t,this.y-i,this.size,0,2*Math.PI),e.fill(),e.restore()}}class V{constructor(e,t,i){this.x=e,this.y=t,this.vx=2*(G()-.5),this.vy=2*-G()-1,this.size=i||10*G()+5,this.life=1,this.decay=.02*G()+.01,this.color="rgba(50, 50, 50, 0.5)"}update(){this.x+=this.vx,this.y+=this.vy,this.size+=.2,this.life-=this.decay}draw(e,t,i,a){e.save(),e.fillStyle=this.color,e.globalAlpha=Math.max(0,.5*this.life),e.beginPath(),e.arc(this.x-t,this.y-i,this.size,0,2*Math.PI),e.fill(),e.restore()}}class Y{constructor(e,t,i){this.x=e,this.y=t,this.vx=3*(G()-.5),this.vy=2*-G(),this.life=1,this.size=5*G()+2,this.color=i||"#fff",this.decay=.05+.03*G()}update(){this.x+=this.vx,this.y+=this.vy,this.vx*=.9,this.size+=.3,this.life-=this.decay}draw(e,t,i,a){this.life<=0||(e.save(),e.fillStyle=this.color,e.globalAlpha=.6*this.life,e.beginPath(),e.arc(this.x-t,this.y-i,this.size,0,2*Math.PI),e.fill(),e.restore())}}class K{constructor(e,t,i){this.x=e,this.y=t,this.vx=15*(G()-.5),this.vy=15*(G()-.5),this.life=1,this.decay=.05+.05*G(),this.color=i||"gold",this.size=3*G()+1}update(){this.x+=this.vx,this.y+=this.vy,this.vy+=.5,this.vx*=.9,this.life-=this.decay;let e=Math.floor(this.y/a),t=Math.floor(this.x/a);e>=0&&e<h&&t>=0&&t<n&&g[e]&&g[e][t]&&0!==g[e][t].type&&(this.vy*=-.6,this.vx*=.6,this.y=e*a-2)}draw(e,t,i,a){e.save(),e.fillStyle=this.color,e.globalAlpha=Math.max(0,this.life),e.fillRect(this.x-t,this.y-i,this.size,this.size),e.restore()}}class z{constructor(e,t,i){this.x=e,this.y=t,this.color=i,this.vx=8*(G()-.5),this.vy=5*-G()-2,this.life=120,this.angle=G(),this.rotSpeed=.5*(G()-.5),this.size=8*G()+4}update(){this.x+=this.vx,this.y+=this.vy,this.vy+=.5,this.angle+=this.rotSpeed,this.life--;let e=Math.floor(this.y/a),t=Math.floor(this.x/a);e>=0&&e<h&&t>=0&&t<n&&g[e]&&g[e][t]&&0!==g[e][t].type&&(this.vy=0,this.vx*=.8,this.rotSpeed*=.8,this.y=e*a-2)}draw(e,t,i,a){e.save(),e.translate(this.x-t,this.y-i),e.rotate(this.angle),e.fillStyle=this.color,e.fillRect(-this.size/2,-this.size/2,this.size,this.size),e.fillStyle="rgba(0,0,0,0.2)",e.fillRect(-this.size/4,-this.size/4,this.size/2,this.size/2),e.restore()}}function X(e,t,i,a="white"){T.push({x:e,y:t,text:i,life:60,vy:-2,color:a})}function j(e,t,i,a=1){for(let l=0;l<10*a;l++)S.push(new W(e,t,i));for(let i=0;i<5*a;i++)S.push(new V(e,t));for(let i=0;i<5*a;i++)S.push(new K(e,t));for(let l=0;l<5*a;l++)S.push(new Y(e,t,i));Z(5*a)}function J(e,t,i){for(let a=0;a<8;a++){let a=new z(e+20*G(),t+20*G(),i);a.size=4*G()+2,w.push(a)}}function $(e,t,i){for(let l=t-i;l<=t+i;l++)for(let t=e-i;t<=e+i;t++)if(l>=0&&l<h&&t>=0&&t<n){let e=g[l][t];e&&(1===e.type?(J(t*a,l*a,c),g[l][t]={type:0},B&&B.play("brick_break")):3===e.type&&i>=2&&(J(t*a,l*a,"#7f8c8d"),g[l][t]={type:0},B&&B.play("brick_break")))}}function Z(e){m.shake=e,e>10&&(m.hitStop=3)}function Q(e,t,i,l){if(j(e,t,"orange",i),B&&B.play("explosion"),$(Math.floor(e/a),Math.floor(t/a),i),v)for(let s of v)if(s.health>0){Math.sqrt(Math.pow(s.x-e,2)+Math.pow(s.y-t,2))<i*a+20&&s.takeDamage(l)}for(let s=0;s<k.length;s++){let n=k[s];if(n.hp>0){Math.sqrt(Math.pow(n.x-e,2)+Math.pow(n.y-t,2))<i*a+20&&n.takeDamage&&n.takeDamage(l,e)}}}function ee(e,t,i,a,l,s){a<2*s&&(s=a/2),l<2*s&&(s=l/2),e.beginPath(),e.moveTo(t+s,i),e.arcTo(t+a,i,t+a,i+l,s),e.arcTo(t+a,i+l,t,i+l,s),e.arcTo(t,i+l,t,i,s),e.arcTo(t,i,t+a,i,s),e.closePath(),e.fill()}function te(e,t,i,a,l){e.save(),e.translate(t,i),e.rotate(l),e.fillStyle="#ccc",e.beginPath(),e.arc(0,0,a,0,2*Math.PI),e.fill(),e.fillStyle="#333",e.beginPath(),e.arc(0,0,.3*a,0,2*Math.PI),e.fill(),e.strokeStyle="#333",e.lineWidth=1,e.beginPath(),e.moveTo(0,-a),e.lineTo(0,a),e.stroke(),e.beginPath(),e.moveTo(-a,0),e.lineTo(a,0),e.stroke(),e.restore()}function ie(e,t,i,a,l,s,n,h,o,r=null,c=!1){if(e.save(),e.translate(t,i),e.rotate(n),e.fillStyle=o,ee(e,-a/2,0,a,l,a/2),!r||"armor"!==r.clothing&&"suit"!==r.clothing||(e.fillStyle="metal"===r.texture?"#999":"#333",e.beginPath(),e.arc(0,0,.8*a,0,2*Math.PI),e.fill()),e.translate(0,l-2),e.rotate(h),e.fillStyle=o,ee(e,-a/2,0,a,s,a/2),r&&"none"!==r.clothing){let t="#333";"armor"===r.clothing?t="#555":"sash"===r.clothing&&(t="#222"),e.fillStyle=t,e.fillRect(-a/2,s/2,a,s/2)}e.restore()}function ae(e,t,i,a,l,s,n){e.save(),e.translate(t,i),e.rotate(s),e.fillStyle=n,e.beginPath(),e.moveTo(0,0),e.quadraticCurveTo(3*a,l/2,0,l),e.quadraticCurveTo(-a,l/2,0,0),e.fill(),e.strokeStyle="rgba(0,0,0,0.15)",e.lineWidth=2,e.beginPath(),e.moveTo(a,.3*l),e.lineTo(2*a,.4*l),e.moveTo(.5*a,.6*l),e.lineTo(1.5*a,.7*l),e.stroke(),e.restore()}function le(e,t,i,a,l,s){t&&("vest"===t.clothing?(e.fillStyle="#333",e.fillRect(i,a,l,.6*s),e.fillStyle="#555",e.fillRect(i+.2*l,a+.3*s,.2*l,.2*s),e.fillRect(i+.6*l,a+.3*s,.2*l,.2*s)):"sash"===t.clothing?(e.fillStyle="#b00",e.beginPath(),e.moveTo(i+l,a),e.lineTo(i+l,a+10),e.lineTo(i,a+s),e.lineTo(i,a+s-10),e.fill(),e.fillRect(i,a+.6*s,l,6)):"belt"===t.clothing?(e.fillStyle="#420",e.fillRect(i,a+s-8,l,6),e.fillStyle="gold",e.fillRect(i+l/2-3,a+s-9,6,8)):"armor"===t.clothing&&(e.fillStyle="rgba(255,255,255,0.4)",e.beginPath(),e.arc(i+l/2,a+.3*s,.25*l,0,2*Math.PI),e.fill(),e.fillStyle="#555",e.fillRect(i,a+s-5,l,5)))}function se(e,t,i,a,l,s,n){if("cape"===i.clothing){e.save(),e.translate(a,l),e.fillStyle=t.cDark||"#c00";let i=Math.sin(.2*s),h=Math.min(Math.max(.5*n,-.5),1);Math.abs(n)>.5&&(h-=.5),"quadruped"===t.stance?(e.translate(-2,-5),e.rotate(.1+.5*h),e.beginPath(),e.moveTo(0,0),e.lineTo(-28-5*h,5+2*i),e.lineTo(-32-8*h,20+5*i),e.quadraticCurveTo(-15,12,0,8),e.fill()):(e.rotate(.2+h+.1*i),e.beginPath(),e.moveTo(0,0),e.lineTo(-20-10*h,40),e.quadraticCurveTo(-10,45+5*i,0,40),e.lineTo(5,0),e.fill()),e.restore()}"vest"===i.clothing&&(e.fillStyle="#222",e.fillRect(a-6,l+5,12,16),e.fillStyle="#333",e.fillRect(a-4,l+7,8,12))}function ne(e,t,i,a,l,s){let n=t.rng;if(e.save(),"metal"!==t.texture&&e.rotate(.1*(n()-.5)),"fur"===t.texture){e.strokeStyle="rgba(0,0,0,0.15)",e.lineWidth=1;let t=l*s/50;for(let h=0;h<t;h++){let t=i+n()*l,h=a+n()*s;e.beginPath(),e.moveTo(t,h),e.lineTo(t+2,h+2),e.stroke()}}else if("scales"===t.texture){e.strokeStyle="rgba(0,0,0,0.2)",e.lineWidth=1;let t=l*s/40;for(let h=0;h<t;h++){let t=i+n()*l,h=a+n()*s;e.beginPath(),e.arc(t,h,2,0,Math.PI),e.stroke()}}else if("metal"===t.texture){e.fillStyle="rgba(0,0,0,0.3)";for(let t=0;t<4;t++)e.beginPath(),e.arc(i+n()*l,a+n()*s,1.5,0,2*Math.PI),e.fill();e.fillStyle="rgba(255,255,255,0.1)",e.fillRect(i,a,l/2,s)}else if("stone"===t.texture){e.strokeStyle="rgba(0,0,0,0.3)",e.lineWidth=1;for(let t=0;t<3;t++){let t=i+n()*l,h=a+n()*s;e.beginPath(),e.moveTo(t,h),e.lineTo(t+10*(n()-.5),h+10*(n()-.5)),e.lineTo(t+20*(n()-.5),h+20*(n()-.5)),e.stroke()}}else if("wood"===t.texture){e.strokeStyle="rgba(0,0,0,0.2)",e.lineWidth=1;let t=l/4;for(let l=0;l<t;l++){let t=i+4*l;e.beginPath(),e.moveTo(t,a),e.lineTo(t,a+s),e.stroke()}}if(t.dirty){e.fillStyle="rgba(60, 40, 20, 0.1)";for(let t=0;t<10;t++)e.beginPath(),e.arc(i+n()*l,a+n()*s,3*n(),0,2*Math.PI),e.fill()}e.restore()}function he(e,t,i,a,l){let s=e.createLinearGradient(t,i,t+a,i+l);s.addColorStop(0,"rgba(255,255,255,0.1)"),s.addColorStop(.5,"transparent"),s.addColorStop(1,"rgba(0,0,0,0.3)"),e.fillStyle=s,e.fillRect(t,i,a,l)}function oe(e,t,i,a,l=1,s=null){if(t.rng,Date.now()%4e3<150)return e.strokeStyle="#000",e.lineWidth=2,e.beginPath(),e.moveTo(i-4*l,a),e.lineTo(i-l,a),e.moveTo(i+l,a),e.lineTo(i+4*l,a),void e.stroke();let n="#fff",h="#000";"robot"===t.eyeType?(n="#0ff",h="#fff"):"glow"===t.eyeType?(n="#afa",h="#afa"):"slit"===t.eyeType&&(n="#ff0",h="#000");let o=i-4*l,r=a,c=i+4*l,d=a;"robot"===t.eyeType?(e.fillStyle=n,e.shadowBlur=5,e.shadowColor=n,e.fillRect(o-2,r-1,4*l,2*l),e.fillRect(c-2,d-1,4*l,2*l),e.shadowBlur=0):(e.fillStyle=n,e.beginPath(),e.arc(o,r,3*l,0,2*Math.PI),e.fill(),e.beginPath(),e.arc(c,d,3*l,0,2*Math.PI),e.fill(),e.fillStyle=h,"slit"===t.eyeType?(e.fillRect(o-.5,r-3,1,6),e.fillRect(c-.5,d-3,1,6)):(e.beginPath(),e.arc(o+1,r,1.5*l,0,2*Math.PI),e.fill(),e.beginPath(),e.arc(c+1,d,1.5*l,0,2*Math.PI),e.fill())),e.strokeStyle="fur"===t.texture&&t.cDark||"#000",e.lineWidth=1,e.beginPath(),"angry"===t.expression?(e.moveTo(o-3,r-4),e.lineTo(o+2,r-2),e.moveTo(c+3,r-4),e.lineTo(c-2,r-2)):"crazy"===t.expression?(e.moveTo(o-3,r-5),e.lineTo(o+2,r-3),e.moveTo(c-2,r-4),e.lineTo(c+3,r-6)):(e.moveTo(o-2,r-4),e.lineTo(o+2,r-4),e.moveTo(c-2,r-4),e.lineTo(c+2,r-4)),e.stroke(),e.beginPath();let f=i,p=a+6*l;s&&(f=s.x,p=s.y),"angry"===t.expression?(e.moveTo(f-3,p),e.lineTo(f+3,p),e.strokeStyle="#fff",e.lineWidth=2,e.stroke(),e.lineWidth=1):"happy"===t.expression?(e.arc(f,p-2,4,.2,Math.PI-.2),e.strokeStyle="#000",e.stroke()):(e.moveTo(f-2,p),e.lineTo(f+2,p),e.strokeStyle="#000",e.stroke())}function re(e,t,i){let a=t.cSkin,l=t.cDark,s=t.type,n=t.name;if(e.fillStyle=a,["wolf","fox","dog_pointy","dog_long","dog_flat","poodle"].some(e=>s.includes(e)))s.includes("dog_flat")||s.includes("poodle")?ee(e,-12,-12,24,24,8):(e.beginPath(),e.moveTo(-10,-10),e.lineTo(6,-10),e.lineTo(16,2),e.lineTo(6,10),e.lineTo(-10,8),e.fill(),e.fillStyle="#000",e.beginPath(),e.arc(16,2,2.5,0,2*Math.PI),e.fill(),e.fillStyle=a),s.includes("poodle")||s.includes("dog_flat")?(e.fillStyle=l,e.beginPath(),e.ellipse(-12,-4,4,10,-.2,0,2*Math.PI),e.fill(),e.beginPath(),e.ellipse(8,-4,4,10,.2,0,2*Math.PI),e.fill()):(e.fillStyle=a,e.beginPath(),e.moveTo(-6,-10),e.lineTo(-10,-24),e.lineTo(2,-10),e.fill(),e.fillStyle=l,e.beginPath(),e.moveTo(-5,-10),e.lineTo(-9,-20),e.lineTo(0,-10),e.fill()),n.includes("DARE")||oe(e,i,2,-5,1,{x:11,y:6});else if(["cat","lion","panther","tiger","cheetah","leopard"].some(e=>s.includes(e)))(s.includes("lion")||n.includes("LION"))&&(e.fillStyle=l,e.beginPath(),e.arc(-2,0,20,0,2*Math.PI),e.fill(),e.fillStyle=a),e.beginPath(),e.arc(0,0,11,0,2*Math.PI),e.fill(),e.fillStyle="#fff","#fff"===a&&(e.fillStyle="#eee"),e.beginPath(),e.ellipse(2,4,5,3,0,0,2*Math.PI),e.fill(),e.fillStyle=a,e.fillStyle="#fba",(s.includes("panther")||"#000"===a)&&(e.fillStyle="#444"),e.beginPath(),e.moveTo(0,2),e.lineTo(4,2),e.lineTo(2,5),e.fill(),e.fillStyle=a,e.beginPath(),e.moveTo(-8,-6),e.lineTo(-12,-18),e.lineTo(-2,-10),e.fill(),e.beginPath(),e.moveTo(2,-10),e.lineTo(8,-18),e.lineTo(10,-6),e.fill(),n.includes("DARE")||oe(e,i,0,-3,1,{x:0,y:5});else if(["cow","bull","buffalo","rhino","elephant","pig","boar","horse","donkey","deer","sheep","goat","llama","giraffe"].some(e=>s.includes(e)))e.save(),s.includes("horse")||s.includes("donkey")||s.includes("giraffe")||s.includes("llama")?(e.rotate(.2),ee(e,-12,-10,26,18,6)):ee(e,-12,-12,24,24,8),s.includes("pig")||s.includes("boar")?(e.fillStyle="#fcc","#ffc0cb"!==a&&"#ffe4c4"!==a&&(e.fillStyle=l),e.beginPath(),e.ellipse(12,2,4,6,0,0,2*Math.PI),e.fill(),e.fillStyle="#000",e.beginPath(),e.arc(12,0,1.5,0,2*Math.PI),e.fill(),e.beginPath(),e.arc(12,4,1.5,0,2*Math.PI),e.fill()):s.includes("elephant")?(e.lineWidth=6,e.strokeStyle=a,e.lineCap="round",e.beginPath(),e.moveTo(10,4),e.bezierCurveTo(20,4,20,20,10,25),e.stroke(),e.fillStyle="#fff",e.beginPath(),e.moveTo(8,8),e.quadraticCurveTo(15,12,18,4),e.lineTo(16,4),e.quadraticCurveTo(14,10,8,6),e.fill()):s.includes("rhino")?(e.fillStyle="#eee",e.beginPath(),e.moveTo(10,-6),e.lineTo(22,-14),e.lineTo(14,2),e.fill(),e.beginPath(),e.moveTo(16,-2),e.lineTo(20,-6),e.lineTo(18,0),e.fill()):(e.fillStyle="#111",e.beginPath(),e.arc(12,0,2,0,2*Math.PI),e.fill()),n.includes("DARE")||oe(e,i,2,-4,1,{x:12,y:6}),e.restore(),e.fillStyle="#eee",s.includes("cow")||s.includes("bull")||s.includes("buffalo")?(e.beginPath(),e.moveTo(-6,-10),e.quadraticCurveTo(-10,-20,0,-18),e.lineTo(-2,-10),e.fill(),e.beginPath(),e.moveTo(6,-10),e.quadraticCurveTo(10,-20,0,-18),e.lineTo(2,-10),e.fill()):s.includes("deer")||s.includes("moose")?(e.strokeStyle="#deb887",e.lineWidth=2,e.beginPath(),e.moveTo(-4,-10),e.lineTo(-8,-25),e.moveTo(-8,-20),e.lineTo(-12,-28),e.stroke()):(s.includes("goat")||s.includes("sheep")||s.includes("ram"))&&(e.strokeStyle="#ccc",e.lineWidth=3,e.beginPath(),e.moveTo(-2,-10),e.arc(-5,-12,8,0,Math.PI,!0),e.stroke()),e.fillStyle=a,s.includes("horse")||s.includes("donkey")?(e.beginPath(),e.moveTo(-6,-10),e.lineTo(-8,-22),e.lineTo(0,-10),e.fill()):(e.beginPath(),e.ellipse(-8,-8,8,4,-.5,0,2*Math.PI),e.fill());else if(["bird","duck","chicken","owl","penguin","eagle","hawk","crow","raven","falcon","turkey","peacock"].some(e=>s.includes(e)))e.beginPath(),e.arc(0,-4,10,0,2*Math.PI),e.fill(),s.includes("duck")||s.includes("goose")||s.includes("penguin")?(e.fillStyle="orange",e.beginPath(),e.moveTo(8,-2),e.quadraticCurveTo(18,-2,18,2),e.quadraticCurveTo(8,4,8,2),e.fill(),e.fillStyle="#000",e.beginPath(),e.arc(12,-1,1,0,2*Math.PI),e.fill()):s.includes("chicken")||s.includes("rooster")||s.includes("turkey")?(e.fillStyle="#eba",e.beginPath(),e.moveTo(8,-2),e.lineTo(14,0),e.lineTo(8,2),e.fill(),e.fillStyle="red",e.beginPath(),e.moveTo(-4,-12),e.quadraticCurveTo(0,-18,4,-12),e.quadraticCurveTo(8,-16,8,-10),e.lineTo(-4,-10),e.fill(),e.beginPath(),e.arc(10,6,3,0,2*Math.PI),e.fill()):(e.fillStyle=s.includes("crow")||s.includes("raven")?"#333":"orange",(s.includes("eagle")||s.includes("hawk")||s.includes("falcon"))&&(e.fillStyle="#ffd700"),e.beginPath(),e.moveTo(8,-6),e.quadraticCurveTo(18,-6,18,2),e.lineTo(8,2),e.fill()),n.includes("DARE")||oe(e,i,2,-6,1,{x:12,y:0});else if(["rodent","mouse","rat","hamster","rabbit","hare","squirrel","chipmunk","beaver","porcupine","skunk","raccoon","hedgehog","badger"].some(e=>s.includes(e)))e.beginPath(),e.moveTo(-8,-8),e.lineTo(8,-6),e.lineTo(14,2),e.lineTo(8,8),e.lineTo(-8,8),e.fill(),e.fillStyle="#fba",(s.includes("rat")||s.includes("raccoon")||s.includes("skunk"))&&(e.fillStyle="#000"),e.beginPath(),e.arc(14,2,2,0,2*Math.PI),e.fill(),e.strokeStyle="#000",e.lineWidth=1,e.beginPath(),e.moveTo(10,2),e.lineTo(18,-2),e.stroke(),e.beginPath(),e.moveTo(10,4),e.lineTo(18,8),e.stroke(),e.fillStyle=a,s.includes("rabbit")||s.includes("hare")?(e.beginPath(),e.ellipse(-4,-18,4,12,-.2,0,2*Math.PI),e.fill(),e.fillStyle="#fba",e.beginPath(),e.ellipse(-4,-18,2,8,-.2,0,2*Math.PI),e.fill()):(e.beginPath(),e.arc(-4,-10,6,0,2*Math.PI),e.fill()),n.includes("DARE")||oe(e,i,2,-4,1,{x:12,y:5});else if(["lizard","snake","croc","turtle","frog","toad","gecko","chameleon","iguana"].some(e=>s.includes(e)))if(s.includes("frog")||s.includes("toad"))e.beginPath(),e.ellipse(0,-4,14,8,0,0,2*Math.PI),e.fill(),e.strokeStyle="#000",e.beginPath(),e.moveTo(-8,2),e.quadraticCurveTo(0,4,8,2),e.stroke(),n.includes("DARE")||oe(e,i,0,-10,1,{x:0,y:2});else if(s.includes("croc")||s.includes("alligator")){ee(e,-12,-8,12,16,4),ee(e,0,-4,20,10,2),e.fillStyle="#fff";for(let t=0;t<4;t++)e.beginPath(),e.moveTo(2+4*t,6),e.lineTo(4+4*t,10),e.lineTo(6+4*t,6),e.fill();n.includes("DARE")||oe(e,i,-4,-6,1,{x:10,y:4})}else e.beginPath(),e.moveTo(-10,-6),e.lineTo(4,-8),e.lineTo(12,0),e.lineTo(4,8),e.lineTo(-10,6),e.fill(),Math.random()<.1&&(e.strokeStyle="red",e.lineWidth=1,e.beginPath(),e.moveTo(12,0),e.lineTo(20,0),e.lineTo(22,-2),e.moveTo(20,0),e.lineTo(22,2),e.stroke()),n.includes("DARE")||oe(e,i,0,-4,1,{x:12,y:2});else if(["bee","ant","insect","spider","anteater"].some(e=>s.includes(e)))s.includes("anteater")?(e.beginPath(),e.moveTo(-10,-8),e.lineTo(0,-8),e.quadraticCurveTo(15,-8,20,4),e.quadraticCurveTo(10,0,-10,8),e.fill(),n.includes("DARE")||oe(e,i,2,-6,1,{x:15,y:0})):(e.beginPath(),e.ellipse(0,-4,10,8,0,0,2*Math.PI),e.fill(),e.strokeStyle="#000",e.lineWidth=1,e.beginPath(),e.moveTo(-4,-10),e.quadraticCurveTo(-8,-18,-12,-14),e.stroke(),e.beginPath(),e.moveTo(4,-10),e.quadraticCurveTo(8,-18,12,-14),e.stroke(),(s.includes("ant")||s.includes("spider"))&&(e.beginPath(),e.moveTo(-4,4),e.lineTo(-2,8),e.stroke(),e.beginPath(),e.moveTo(4,4),e.lineTo(2,8),e.stroke()),n.includes("DARE")||oe(e,i,0,-4,1,{x:0,y:4}));else if(["bear","panda","koala"].some(e=>s.includes(e))){let t=n.includes("PANDA")||s.includes("panda"),l=t?"#fff":a;e.fillStyle=l,e.beginPath(),e.arc(0,-2,11,0,2*Math.PI),e.fill(),e.fillStyle=t?"#000":a,s.includes("koala")?(e.beginPath(),e.arc(-12,-10,6,0,2*Math.PI),e.fill(),e.beginPath(),e.arc(12,-10,6,0,2*Math.PI),e.fill(),e.fillStyle="#eee",e.beginPath(),e.arc(-12,-10,3,0,2*Math.PI),e.fill(),e.beginPath(),e.arc(12,-10,3,0,2*Math.PI),e.fill()):(e.beginPath(),e.arc(-9,-11,4.5,0,2*Math.PI),e.fill(),e.beginPath(),e.arc(9,-11,4.5,0,2*Math.PI),e.fill()),e.fillStyle=l,e.fillStyle=t||"#fff"===a?"#f9f9f9":"#deb887",e.beginPath(),e.ellipse(0,3,5,3.5,0,0,2*Math.PI),e.fill(),e.fillStyle="#222",e.beginPath(),e.moveTo(-2,2),e.lineTo(2,2),e.lineTo(0,5),e.fill(),t&&(e.fillStyle="#000",e.beginPath(),e.ellipse(-5,-3,4,3,-.3,0,2*Math.PI),e.fill(),e.beginPath(),e.ellipse(5,-3,4,3,.3,0,2*Math.PI),e.fill()),n.includes("DARE")||oe(e,i,0,-3,1,{x:0,y:5})}else ee(e,-10,-12,20,24,8),e.fillStyle=a,e.beginPath(),e.arc(-10,0,3,0,2*Math.PI),e.fill(),e.beginPath(),e.arc(10,0,3,0,2*Math.PI),e.fill(),s.includes("monkey")||s.includes("ape")?(e.fillStyle="#deb887",e.beginPath(),e.ellipse(0,4,6,4,0,0,2*Math.PI),e.fill(),e.fillStyle="#000",e.beginPath(),e.arc(-2,4,1,0,2*Math.PI),e.fill(),e.beginPath(),e.arc(2,4,1,0,2*Math.PI),e.fill(),n.includes("DARE")||oe(e,i,0,-4,1,{x:0,y:6})):n.includes("DARE")||oe(e,i,0,-2);!function(e,t,i,a,l=1){"none"!==t.headgear&&("helmet"===t.headgear?(e.fillStyle="metal"===t.texture?"#aaa":"#444",e.beginPath(),e.arc(i,a-2,12*l,Math.PI,0),e.lineTo(i+12*l,a+5),e.lineTo(i+4,a+5),e.lineTo(i,a+2),e.lineTo(i-4,a+5),e.lineTo(i-12*l,a+5),e.fill(),t.rng()>.5&&(e.fillStyle="red",e.beginPath(),e.moveTo(i,a-12),e.quadraticCurveTo(i+10,a-20,i+5,a-5),e.fill())):"hat"===t.headgear?(e.fillStyle="#321",e.fillRect(i-14,a-2,28,4),e.fillRect(i-8,a-12,16,10)):"bandana"===t.headgear?(e.fillStyle="red",e.fillRect(i-11,a-8,22,6),e.fillRect(i+10,a-8,4,4)):"crown"===t.headgear?(e.fillStyle="gold",e.beginPath(),e.moveTo(i-8,a),e.lineTo(i-8,a-10),e.lineTo(i-4,a-4),e.lineTo(i,a-12),e.lineTo(i+4,a-4),e.lineTo(i+8,a-10),e.lineTo(i+8,a),e.fill()):"mask"===t.headgear?(e.fillStyle="sash"===t.clothing&&t.cSuit||"#222",e.fillRect(i-11,a-5,22,10)):"glasses"===t.headgear&&(e.fillStyle="rgba(0,0,0,0.5)",e.fillRect(i-10,a-4,8,6),e.fillRect(i+2,a-4,8,6),e.strokeStyle="#000",e.beginPath(),e.moveTo(i-2,a-1),e.lineTo(i+2,a-1),e.stroke()))}(e,i,0,-10)}function ce(e,t,i,a=null,l=0){let s=t.cSkin,n=t.cDark,h=t.cSuit,o=t.stance||"biped",r=function(e){let t=0;for(let i=0;i<e.id.length;i++)t=(t<<5)-t+e.id.charCodeAt(i),t|=0;const i=function(e){let t=e;return function(){return t=(9301*t+49297)%233280,t/233280}}(Math.abs(t)),a=e.name.toUpperCase(),l=e.type.toLowerCase();let s={texture:"smooth",clothing:"none",headgear:"none",expression:"neutral",eyeType:"normal",hasScars:i()>.8,hasAccessories:i()>.7,dirty:i()>.5,rng:i,seed:Math.abs(t)};return["dog","wolf","fox","cat","lion","panther","bear","rodent","rabbit","skunk","poodle","raccoon","monkey","sheep","goat","cow","buffalo","pig","horse","donkey","hamster","mouse"].some(e=>l.includes(e))?s.texture="fur":["lizard","snake","croc","turtle","fish","shark","gecko","frog","toad"].some(e=>l.includes(e))?s.texture="scales":["robot","cyborg","stone","rock"].some(e=>l.includes(e)||a.includes(e.toUpperCase()))?s.texture=l.includes("stone")||l.includes("rock")?"stone":"metal":["tree","wood"].some(e=>l.includes(e))?s.texture="wood":["bee","ant","insect"].some(e=>l.includes(e))&&(s.texture="chitin"),a.includes("NINJA")||a.includes("KARATE")||a.includes("MONK")?s.clothing="sash":a.includes("KNIGHT")||a.includes("ARMOR")||a.includes("IRON")?s.clothing="armor":a.includes("AGENT")||a.includes("DETECTIVE")||a.includes("POLICE")||a.includes("SOLDIER")||a.includes("RAMBO")||a.includes("COMMANDO")?s.clothing="vest":a.includes("SUPER")||a.includes("BAT")||a.includes("THOR")||a.includes("DOCTOR")||a.includes("MAGIC")||a.includes("WONDER")||a.includes("VAMPIRE")?s.clothing="cape":a.includes("COWBOY")||a.includes("SHERIFF")||a.includes("WEST")||a.includes("RANCH")?s.clothing="vest":i()>.6&&(s.clothing="belt"),a.includes("KNIGHT")||a.includes("HELMET")||a.includes("CYBORG")?s.headgear="helmet":a.includes("NINJA")||a.includes("TURTLE")||a.includes("SPIDER")?s.headgear="mask":a.includes("DETECTIVE")||a.includes("COWBOY")||a.includes("INDIANA")||a.includes("CAPTAIN")||a.includes("WITCH")||a.includes("WIZARD")?s.headgear="hat":a.includes("RAMBO")||a.includes("KARATE")||a.includes("PIRATE")?s.headgear="bandana":a.includes("KING")||a.includes("PRINCE")||a.includes("QUEEN")||a.includes("PRINCESS")||a.includes("LORD")?s.headgear="crown":(a.includes("DOC")||a.includes("PROFESSOR")||a.includes("NERD"))&&(s.headgear="glasses"),e.melee||a.includes("VILLAIN")||a.includes("KILLER")||a.includes("DEAD")||a.includes("WAR")||a.includes("ANGRY")?s.expression="angry":a.includes("HAPPY")||a.includes("CLOWN")||a.includes("JOKER")||a.includes("MAD")?s.expression="crazy":(l.includes("dog")||l.includes("cat")||l.includes("monkey"))&&(s.expression="happy"),l.includes("robot")||a.includes("CYBORG")||a.includes("IRON")||a.includes("TERMINATOR")?s.eyeType="robot":l.includes("lizard")||l.includes("snake")||l.includes("croc")||l.includes("dragon")?s.eyeType="slit":(a.includes("ZOMBIE")||a.includes("GHOST")||a.includes("SPECTRE"))&&(s.eyeType="glow"),s}(t),c=1.5*Math.sin(Date.now()/300);i>0&&(c=2*Math.sin(.5*i)),"quadruped"===o?function(e,t,i,a,l,s,n,h,o,r){let c=t.w||36,d=t.h||24,f=i>0,p=.5*i,y=0,u=0,m=0,g=0;Math.abs(o)>.5?o<0?(y=.5,u=.6,m=-.5,g=-.6):(y=-.2,u=-.2,m=.2,g=.2):f&&(y=.6*Math.sin(p),u=.6*Math.sin(p+Math.PI),m=.6*Math.sin(p+.5*Math.PI),g=.6*Math.sin(p+1.5*Math.PI)),e.strokeStyle=l,e.lineWidth=4,e.lineCap="round",e.beginPath(),e.moveTo(-c/2,5+a),e.quadraticCurveTo(-c/2-10,5+a-10,-c/2-20,5+a+5*Math.sin(.3*i)),e.stroke(),e.fillStyle=s,ie(e,-c/2+8,10+a,6,8,8,y,.5*y,s,r,!0),ie(e,c/2-8,10+a,6,8,8,m,.5*m,s,r,!0),se(e,t,r,c/2-8,a+5,i,o);let b=t.body||"standard";if(e.beginPath(),"orb"===b||"pumpkin"===b)e.ellipse(0,a,c/2,d/2,0,0,2*Math.PI);else if("muscular"===b)e.moveTo(-c/2+5,-d/2+a+4),e.lineTo(c/2,-d/2+a-2),e.lineTo(c/2+2,d/2+a),e.lineTo(-c/2+5,d/2+a-2);else if("brute"===b){let t=6,i=-c/2-5,l=-d/2+a-5,s=c+10,n=d+10;e.moveTo(i+t,l),e.arcTo(i+s,l,i+s,l+n,t),e.arcTo(i+s,l+n,i,l+n,t),e.arcTo(i,l+n,i,l,t),e.arcTo(i,l,i+s,l,t)}else if("stick"===b)e.rect(-c/2,a-2,c,4);else{let t=8,i=-c/2,l=-d/2+a,s=c,n=d;e.moveTo(i+t,l),e.arcTo(i+s,l,i+s,l+n,t),e.arcTo(i+s,l+n,i,l+n,t),e.arcTo(i,l+n,i,l,t),e.arcTo(i,l,i+s,l,t)}e.closePath(),e.fillStyle=n,e.fill(),"stick"!==b?(e.save(),e.clip(),ne(e,r,-c,a-d,2*c,2*d),he(e,-c,a-d,2*c,2*d),le(e,r,-c,a-d,2*c,2*d),e.restore()):(e.lineWidth=4,e.strokeStyle=n,e.beginPath(),e.moveTo(-c/2,a),e.lineTo(c/2,a),e.stroke()),"back"===t.mount&&(e.fillStyle="#555",e.fillRect(-5,-d/2+a-6,10,6),e.fillStyle=t.pColor,e.beginPath(),e.arc(0,-d/2+a-6,4,0,2*Math.PI),e.fill()),e.save(),e.translate(c/2,-5+a),f&&e.rotate(.05*Math.sin(2*p)),re(e,t,r),e.restore(),e.fillStyle=l,ie(e,-c/2+8,15+a,6,8,8,u,.5*u,l,r,!0),ie(e,c/2-8,15+a,6,8,8,g,.5*g,l,r,!0)}(e,t,i,c,s,n,h,0,l,r):"snake"===o?function(e,t,i,a,l,s,n,h,o,r){let c=t.w||36,d=t.h||18,f=5;Math.abs(o)>.5&&(f=2),e.fillStyle=n;for(let t=0;t<8;t++){let l=c/2-t*(c/8),s=a+Math.sin(.5*i+t)*f,n=d/2+(2-Math.abs(t-2));e.beginPath(),e.arc(l,s+10,n,0,2*Math.PI),e.fill(),e.save(),e.clip(),ne(e,r,l-n,s+10-n,2*n,2*n),2!==t&&3!==t||le(e,r,l-n,s+10-n,2*n,2*n),e.restore()}e.save(),e.translate(c/2+5,a+Math.sin(.5*i)*f),re(e,t,r),e.restore()}(e,t,i,c,0,0,h,0,l,r):"fish"===o?function(e,t,i,a,l,s,n,h,o,r){let c=t.w||36,d=t.h||18;e.save(),e.translate(0,a);let f=.05*o;e.rotate(f);let p=.4*i;e.fillStyle="#222",ee(e,-c/2-2,14,c+4,5,2),te(e,-c/3,18,4,p),te(e,c/3,18,4,p);let y=Math.sin(.3*i);e.save(),e.translate(-c/4,0),e.rotate(.3*y),e.beginPath(),e.moveTo(0,-d/2+2),e.lineTo(-c/2,-d/4),e.lineTo(-c/2,d/4),e.lineTo(0,d/2-2),e.fillStyle=n,e.fill(),e.save(),e.clip(),ne(e,r,-c,-d,c,2*d),e.restore(),e.translate(-c/2,0),e.rotate(.5*y),e.fillStyle=s,e.beginPath(),e.moveTo(0,0),e.lineTo(-10,-12),e.quadraticCurveTo(-5,0,-10,12),e.lineTo(0,0),e.fill(),e.restore(),e.beginPath(),e.ellipse(c/8,0,c/2.5,d/2,0,0,2*Math.PI),e.fillStyle=n,e.fill(),e.save(),e.clip(),ne(e,r,-c/2,-d,c,2*d),he(e,-c/2,-d,c,2*d),le(e,r,-c/2,-d,c,2*d),e.restore(),e.fillStyle=s,e.beginPath(),e.moveTo(0,-d/2+2),e.quadraticCurveTo(-5,-d/2-10,-15,-d/2),e.fill(),e.save(),e.translate(c/4,5),e.rotate(.5*Math.sin(.5*i)),e.fillStyle=l,e.beginPath(),e.moveTo(0,0),e.quadraticCurveTo(-5,10,-10,2),e.fill(),e.restore(),e.save(),e.translate(c/2-5,-2),oe(e,r,0,0,.5),e.restore(),e.restore()}(e,t,i,c,s,n,h,0,l,r):function(e,t,i,a,l,s,n,h,o,r){let c=i>0,d=Math.abs(o)>.5,f=["bird","duck","chicken","owl","penguin","bee"].some(e=>t.type.includes(e))||"bird"===t.type,p=0,y=0,u=0,m=0,g=0,b=0,k=.5*i;if(d)o<0?(p=-.5,y=1,u=.2,m=.5,g=f?-2:-2.5,b=f?-2:-2.5):(p=.2,y=.1,u=-.2,m=.1,g=f?-1:-.5,b=f?-1:-.5);else if(c){let e=Math.sin(k),t=Math.sin(k+Math.PI);p=.8*e,y=e>0?.2:1+.5*e,u=.8*t,m=t>0?.2:1+.5*t,g=1*t,b=1*e}else{let e=.05*Math.sin(Date.now()/500);g=e,b=-e,f&&(g+=.5,b+=.5)}if(h&&h.timer>0){let t=h.timer/h.max,i=Math.sin(t*Math.PI);"shoot"===h.type?b=-Math.PI/2:"kick"===h.type?(u=-1.5*i,m=0,e.rotate(-.2*i)):"punch"===h.type&&(b=-Math.PI/2+.5*i)}ie(e,-4,25+a,6,8,8,p,y,s,r,!0),f?ae(e,-5,15+a,6,18,g,s):(e.save(),e.translate(0,15+a),e.rotate(g),e.fillStyle=s,ee(e,-3,0,6,12,3),e.restore()),se(e,t,r,0,10+a,i,o);let S=t.body||"standard";if(e.beginPath(),"brute"===S)e.moveTo(-15,0+a),e.lineTo(15,0+a),e.lineTo(6,25+a),e.lineTo(-6,25+a);else if("orb"===S||"pumpkin"===S)e.arc(0,15+a,14,0,2*Math.PI);else if("teardrop"===S)e.moveTo(0,5+a),e.quadraticCurveTo(12,5+a,12,18+a),e.quadraticCurveTo(0,30+a,-12,18+a),e.quadraticCurveTo(-12,5+a,0,5+a);else if("muscular"===S)e.moveTo(-12,5+a),e.lineTo(12,5+a),e.lineTo(8,20+a),e.lineTo(-8,20+a),e.lineTo(-12,5+a);else if("stick"===S);else if("block"===S)e.rect(-12,5+a,24,20);else{let t=5,i=-10,l=8+a,s=20,n=18;e.moveTo(i+t,l),e.arcTo(i+s,l,i+s,l+n,t),e.arcTo(i+s,l+n,i,l+n,t),e.arcTo(i,l+n,i,l,t),e.arcTo(i,l,i+s,l,t)}if(e.closePath(),"stick"!==S?(e.fillStyle=n,e.fill(),e.save(),e.clip(),ne(e,r,-20,a,40,40),he(e,-20,a,40,40),le(e,r,-20,a,40,40),e.restore(),"muscular"===S&&(e.fillStyle="rgba(0,0,0,0.1)",e.fillRect(-4,8+a,8,4),e.fillRect(-3,13+a,6,4))):(e.lineWidth=4,e.strokeStyle=n,e.beginPath(),e.moveTo(0,5+a),e.lineTo(0,25+a),e.stroke()),e.save(),e.translate(0,a),c&&e.rotate(.1),re(e,t,r),e.restore(),ie(e,4,25+a,6,8,8,u,m,s,r,!0),f)ae(e,5,15+a,6,18,b,n),"hand"===t.mount&&(e.save(),e.translate(5,15+a),e.rotate(b),e.translate(0,15),e.fillStyle=t.pColor,e.restore());else{if(e.save(),e.translate(0,15+a),e.rotate(b),e.fillStyle=n,ee(e,-3,0,6,12,3),e.fillStyle=l,e.beginPath(),e.arc(0,12,4,0,2*Math.PI),e.fill(),r&&"none"!==r.clothing){let t="armor"===r.clothing?"#555":"#333";e.fillStyle=t,e.fillRect(-3.5,8,7,4)}"hand"===t.mount&&(e.fillStyle=t.pColor,e.translate(0,12)),e.restore()}}(e,t,i,c,s,n,h,a,l,r)}class de{constructor(e,t,i,a,l,s=!1,n=!1,h=!1){this.x=e,this.y=t,this.life=80,this.isSpecial=a,this.w=15,this.h=5,this.behavior=l.behavior||null,this.renderer=l.renderer||null,this.owner=l.owner||null,this.damage=l.damage||(a?5:1),this.color=l.pColor||"#fff",this.type=l.pType||"normal",this.isEnemy=l.isEnemy||!1,this.returnState=0,l.w&&(this.w=l.w),l.h&&(this.h=l.h),l.life&&(this.life=l.life),void 0!==l.vx?this.vx=l.vx:this.vx=15*i,void 0!==l.vy?this.vy=l.vy:this.vy=2*(G()-.5),s&&(this.vx=0,this.vy=15,this.w=8,this.h=20),h&&(this.vx=0,this.vy=-15,this.w=8,this.h=20),n&&(this.vx=12*i,this.vy=-5,this.w=12,this.h=12,this.color="#ccc"),this.behavior||s||n||h||("spread"===this.type&&(this.w=8,this.h=8,this.vx=15*i+5*(G()-.5),this.vy=10*(G()-.5)),"rocket"!==this.type&&"grenade"!==this.type||(this.w=12,this.h=12,this.vy=-5),"boomerang"===this.type&&(this.w=20,this.h=20,this.life=100),"bolt"===this.type&&(this.w=25,this.h=10),"laser"===this.type&&(this.w=40,this.h=5,this.vx=25*i),"magic"===this.type&&(this.w=10,this.h=10,this.baseY=t,this.timer=0),"fireball"===this.type&&(this.w=20,this.h=20,this.vx=12*i),"ice_beam"===this.type&&(this.w=30,this.h=6,this.vx=20*i),"sonic_wave"===this.type&&(this.w=10,this.h=40,this.vx=8*i,this.life=120),"lightning"===this.type&&(this.w=50,this.h=4,this.vx=40*i),"shuriken"===this.type&&(this.w=15,this.h=15,this.vx=18*i,this.rotation=0),"water_gun"===this.type&&(this.w=12,this.h=12,this.vx=14*i,this.vy=5*(G()-.5)),"acid_spit"===this.type&&(this.w=10,this.h=10,this.vx=10*i,this.vy=-8),"card_throw"===this.type&&(this.w=12,this.h=4,this.vx=22*i))}update(){if(this.behavior)return this.behavior(this),this.life--,void this.checkCollisions();if("grenade"===this.type||"rocket"===this.type||"acid_spit"===this.type)this.vy+=.3,this.x+=this.vx,this.y+=this.vy;else if("boomerang"===this.type&&0!==this.vx)if(0===this.returnState)this.x+=this.vx,this.vx*=.95,Math.abs(this.vx)<1&&(this.returnState=1);else{let e=x.x-this.x,t=x.y-this.y,i=Math.atan2(t,e);this.x+=15*Math.cos(i),this.y+=15*Math.sin(i),Math.abs(e)<20&&Math.abs(t)<20&&(this.life=0)}else"magic"===this.type&&0!==this.vx?(this.timer++,this.x+=this.vx,this.y=this.baseY+20*Math.sin(.2*this.timer)):"shuriken"===this.type?(this.x+=this.vx,this.y+=this.vy,this.rotation+=.5):"sonic_wave"===this.type?(this.x+=this.vx,this.w+=.5,this.h+=1,this.y-=.5):(this.x+=this.vx,this.y+=this.vy);this.life--,this.checkCollisions()}checkCollisions(){let e=Math.floor(this.x/a),t=Math.floor(this.y/a);if(t>=0&&t<h&&e>=0&&e<n&&g[t]&&g[t][e]&&0!==g[t][e].type){let i=g[t][e];"sonic_wave"===this.type||1!==i.type&&2!==i.type&&3!==i.type||("boomerang"===this.type&&0!==this.vx?(this.returnState=1,1===i.type&&(j(this.x,this.y,c,1),g[t][e]={type:0},B&&B.play("brick_break"))):(j(this.x,this.y,c,1),this.life=0,1===i.type&&(g[t][e]={type:0},B&&B.play("brick_break")),(this.isSpecial||"rocket"===this.type||"grenade"===this.type||"fireball"===this.type||this.vy>0)&&$(e,t,1)))}if(!this.isEnemy)for(let e=0;e<k.length;e++){let t=k[e];void 0!==t.hp&&t.hp>0&&H(this.x,this.y,this.w,this.h,t.x,t.y,t.w,t.h)&&(t.takeDamage&&t.takeDamage(this.damage),"boomerang"!==this.type?this.life=0:this.returnState=1)}this.isEnemy&&x&&H(this.x,this.y,this.w,this.h,x.x,x.y,x.w,x.h)&&(x.takeDamage(this.isSpecial?2:1),"boomerang"!==this.type?this.life=0:this.returnState=1)}draw(e,t,i,a){let l=this.x-t,s=this.y-i;if(this.renderer)this.renderer(e,this,l,s,a);else if("boomerang"===this.type)e.save(),e.translate(l,s),e.rotate(.2*a),e.fillStyle=this.color,e.beginPath(),e.moveTo(0,0),e.lineTo(15,-10),e.lineTo(10,0),e.lineTo(15,10),e.fill(),e.restore();else if("grenade"===this.type||"rocket"===this.type)e.fillStyle="#2ecc71",e.beginPath(),e.arc(l+this.w/2,s+this.h/2,6,0,2*Math.PI),e.fill(),e.fillStyle="#27ae60",e.fillRect(l+this.w/2-2,s-2,4,4);else if("bolt"===this.type||"laser"===this.type||"ice_beam"===this.type||"lightning"===this.type)e.fillStyle=this.color,e.shadowBlur=10,e.shadowColor=this.color,ee(e,l,s,this.w,this.h,2),e.shadowBlur=0;else if("fireball"===this.type)e.fillStyle="#FF4500",e.beginPath(),e.arc(l+this.w/2,s+this.h/2,10,0,2*Math.PI),e.fill(),e.fillStyle="#FFFF00",e.beginPath(),e.arc(l+this.w/2,s+this.h/2,6,0,2*Math.PI),e.fill();else if("shuriken"===this.type){e.save(),e.translate(l+this.w/2,s+this.h/2),e.rotate(this.rotation||0),e.fillStyle="#C0C0C0",e.beginPath();for(let t=0;t<4;t++)e.rotate(Math.PI/2),e.moveTo(0,0),e.lineTo(8,0),e.lineTo(2,2),e.lineTo(0,0);e.fill(),e.restore()}else"sonic_wave"===this.type?(e.strokeStyle=this.color,e.lineWidth=2,e.beginPath(),e.arc(l,s+this.h/2,this.h,-Math.PI/4,Math.PI/4),e.stroke(),e.beginPath(),e.arc(l-10,s+this.h/2,this.h-10,-Math.PI/4,Math.PI/4),e.stroke()):"card_throw"===this.type?(e.fillStyle="#fff",e.fillRect(l,s,this.w,this.h),e.fillStyle="red",e.beginPath(),e.arc(l+this.w/2,s+this.h/2,2,0,2*Math.PI),e.fill()):(e.fillStyle=this.color,e.beginPath(),e.arc(l+this.w/2,s+this.h/2,5,0,2*Math.PI),e.fill())}}class fe{constructor(e,t,i,a,l,s=1){this.x=e,this.y=t,this.w=i,this.h=a,this.life=15,this.power=s,this.hp=1,j(e+i/2,t+a/2,"#fff",.5)}update(){this.life--,this.life<=0&&(this.hp=0),$(Math.floor((this.x+this.w/2)/a),Math.floor((this.y+this.h/2)/a),1);for(let e=0;e<k.length;e++){let t=k[e];t!==this&&void 0!==t.hp&&t.hp>0&&H(this.x,this.y,this.w,this.h,t.x,t.y,t.w,t.h)&&t.takeDamage&&t.takeDamage(2*this.power)}}draw(e,t,i,a){}takeDamage(){}}class pe{constructor(e,t){this.x=e,this.y=t,this.w=a,this.h=a,this.hp=10,this.vx=0,this.vy=0,this.type="prop",this.burning=!1,this.burnTimer=0}update(){this.vy+=l,this.y+=this.vy;let e=Math.floor((this.y+this.h)/a),t=Math.floor((this.x+this.w/2)/a),i=g&&g[0]?g[0].length:n,s=g?g.length:h;e>=0&&e<s&&t>=0&&t<i&&g[e]&&g[e][t]&&0!==g[e][t].type&&(this.y=e*a-this.h,this.vy=0,this.vx=0),this.x+=this.vx,this.burning&&(this.burnTimer--,Math.random()<.3&&(j(this.x+this.w/2+10*(Math.random()-.5),this.y+this.h/2+10*(Math.random()-.5),"orange",.2),j(this.x+this.w/2+10*(Math.random()-.5),this.y+10*(Math.random()-.5),"grey",.1)),this.burnTimer<=0&&(this.hp=0,Q(this.x+this.w/2,this.y+this.h/2,2,50),this.x=-9999))}takeDamage(e,t){this.vx=0,this.vy=0,this.burning?(this.burnTimer-=20,this.hp-=e):(this.burning=!0,this.burnTimer=60,X(this.x,this.y,"WARNING!","orange")),this.hp<=0&&(Q(this.x+this.w/2,this.y+this.h/2,2,50),this.x=-9999)}draw(e,t,i,a){let l=this.x-t,s=this.y-i;this.burning&&Math.floor(a/100)%2==0?e.fillStyle="#e67e22":e.fillStyle="#e74c3c",ee(e,l+5,s+5,this.w-10,this.h-5,5),e.fillStyle="#bdc3c7",e.fillRect(l+12,s,16,5),e.fillStyle="white",e.font="10px Arial",e.fillText("GAS",l+10,s+25)}}class ye{constructor(e,t){this.x=e,this.y=t,this.w=a,this.h=a,this.vx=0,this.vy=0,this.active=!1,this.solid=!0,this.hp=100}update(){if(this.active){if(this.vy+=l,this.y+=this.vy,v)for(let e of v)if(U(this,e))return e.takeDamage(2),void this.shatter();let e=Math.floor((this.y+this.h)/a),t=Math.floor((this.x+this.w/2)/a);g&&g[e]&&g[e][t]&&0!==g[e][t].type&&this.shatter()}else if(v)for(let e of v)Math.abs(e.x+e.w/2-(this.x+this.w/2))<40&&e.y>this.y&&(this.active=!0,j(this.x+this.w/2,this.y,"grey",.5))}shatter(){j(this.x+this.w/2,this.y+this.h/2,"grey",2),this.x=-9999}draw(e,t,i,a){let l=this.x-t,s=this.y-i;e.fillStyle="#7f8c8d",e.fillRect(l,s,this.w,this.h),e.strokeStyle="#2c3e50",e.beginPath(),e.moveTo(l+5,s+5),e.lineTo(l+15,s+20),e.lineTo(l+10,s+30),e.stroke()}}class ue{constructor(e,t){this.x=e,this.y=t,this.w=60,this.h=80,this.occupied=!1,this.hp=500}update(){if(!this.occupied){this.y+=5;let e=Math.floor((this.y+this.h)/a),t=Math.floor((this.x+this.w/2)/a);if(e>=0&&e<h&&t>=0&&t<n&&g[e]&&g[e][t]&&0!==g[e][t].type&&(this.y=e*a-this.h),v)for(let e of v)if(Math.abs(e.x-this.x)<50&&Math.abs(e.y-this.y)<50&&E[e.index].e){this.enter(e);break}}}enter(e){this.occupied=!0,e.inMech=!0,e.mech=this,j(this.x+30,this.y+40,"cyan",2)}eject(e){this.occupied=!1,e.inMech=!1,e.mech=null,this.x=e.x,this.y=e.y,this.hp=0,j(this.x+30,this.y+40,"cyan",5),this.x=-9999}draw(e,t,i,a){if(this.occupied)return;let l=this.x-t,s=this.y-i;e.fillStyle="#34495e",ee(e,l,s,this.w,this.h,10),e.fillStyle="#f1c40f",e.fillRect(l+15,s+10,30,20),e.fillStyle="#2c3e50",e.fillRect(l+10,s+60,15,20),e.fillRect(l+35,s+60,15,20),e.fillRect(l-10,s+20,10,30),e.fillRect(l+60,s+20,10,30)}}class me{constructor(e,t){this.x=e,this.y=t,this.w=60,this.h=60,this.r=30,this.vx=0,this.vy=0,this.angle=0,this.occupied=!1,this.driver=null,this.jumpCount=0,this.maxJumps=3,this.grounded=!1,this.hp=100,this.cooldown=0,this.interactionCooldown=0,this.facing=1}update(){if(this.occupied&&this.driver&&(!this.driver.dead&&this.driver.inHamsterBall&&this.driver.hamsterBall===this||(this.occupied=!1,this.driver=null)),!this.occupied&&(this.vy+=l,this.y+=this.vy,this.vx*=.95,this.x+=this.vx,this.angle+=.1*this.vx,this.checkCollisions(),v))for(let e of v)if(e.health>0&&!e.dead&&!e.inHamsterBall&&U(this,e)){let t=E[e.index];if(t&&t.f){this.enter(e);break}}}updateDriven(e){this.interactionCooldown>0&&this.interactionCooldown--;let t=E[e.index];if(t.f&&this.interactionCooldown<=0)return void this.eject(e);let i=0;(t.arrowleft||t.a)&&(i=-1),(t.arrowright||t.d)&&(i=1),0!==i&&(this.facing=i);if(this.vx+=.5*i,this.vx*=.98,Math.abs(this.vx)>12&&(this.vx=12*Math.sign(this.vx)),this.angle+=.1*this.vx,t[" "]&&!e.wallJumpLocked&&this.jumpCount<this.maxJumps){this.vy=-12,this.jumpCount++,e.wallJumpLocked=!0,B&&B.play("jump");for(let e=0;e<5;e++)S.push(new W(this.x+this.w/2,this.y+this.h,"orange",2*(Math.random()-.5),2+2*Math.random()))}t[" "]||(e.wallJumpLocked=!1),this.cooldown>0&&this.cooldown--,t.z&&this.cooldown<=0&&(this.shootMinigun(),this.cooldown=4),this.vy+=l,this.y+=this.vy,this.x+=this.vx,this.checkCollisions(),e.x=this.x+(this.w-e.w)/2,e.y=this.y+(this.h-e.h)/2,e.vx=this.vx,e.vy=this.vy,e.facing=this.facing}shootMinigun(){Z(1);let e=this.x+this.w/2+35*this.facing,t=this.y+this.h/2;k.push(new de(e,t,this.facing,!1,{pColor:"#ff0",pType:"round"})),B&&B.play("shoot"),S.push(new W(e,t,"gold",2*-this.facing,-2))}enter(e){this.occupied=!0,this.driver=e,e.inHamsterBall=!0,e.hamsterBall=this,e.vx=0,e.vy=0,this.interactionCooldown=30,j(this.x+this.w/2,this.y+this.h/2,"cyan",2)}eject(e){this.occupied=!1,this.driver=null,e.inHamsterBall=!1,e.hamsterBall=null,e.vy=-10,e.y-=20,this.vx=5*e.facing,this.vy=-5,j(this.x+this.w/2,this.y+this.h/2,"white",2)}checkCollisions(){if(!g)return;let e=Math.floor(this.x/a),t=Math.floor((this.x+this.w-.01)/a),i=Math.floor(this.y/a),l=Math.floor((this.y+this.h-.01)/a);this.grounded=!1;for(let s=i;s<=l;s++)for(let i=e;i<=t;i++)if(s>=0&&s<h&&i>=0&&i<n&&g[s]&&g[s][i]&&0!==g[s][i].type){let e=g[s][i].type;if(6===e)continue;if(4===e)return void(this.occupied&&this.driver?this.driver.takeDamage():this.vy=-5);if(1===e||2===e||3===e||5===e){if(this.vy>0&&this.y+this.h<(s+1)*a){let e=s*a;this.y+this.h>e&&this.y+this.h-this.vy<=e+5&&(this.y=e-this.h,this.vy=.4*-this.vy,Math.abs(this.vy)<2&&(this.vy=0),this.grounded=!0,this.jumpCount=0)}else if(this.vy<0){let e=(s+1)*a;this.y<e&&this.y-this.vy>=e-5&&(this.y=e,this.vy=.4*-this.vy)}if(this.y+this.h>s*a&&this.y<(s+1)*a)if(this.vx>0){let e=i*a;this.x+this.w>e&&this.x+this.w-this.vx<=e+10&&(this.x=e-this.w,this.vx=.6*-this.vx)}else if(this.vx<0){let e=(i+1)*a;this.x<e&&this.x-this.vx>=e-10&&(this.x=e,this.vx=.6*-this.vx)}}}}draw(e,t,i,a){let l=this.x-t+this.w/2,s=this.y-i+this.h/2;if(e.save(),e.translate(l,s),this.occupied&&this.driver){let t=Math.floor(Math.abs(2*this.angle));e.save(),e.translate(0,10),e.scale(this.driver.facing,1),ce(e,this.driver.charData,t,{type:null,timer:0},0),e.restore()}e.rotate(this.angle),e.beginPath(),e.arc(0,0,this.r,0,2*Math.PI),e.fillStyle="rgba(100, 200, 255, 0.3)",e.fill(),e.lineWidth=3,e.strokeStyle="rgba(255, 255, 255, 0.8)",e.stroke(),e.beginPath(),e.moveTo(0,-this.r),e.lineTo(0,this.r),e.moveTo(-this.r,0),e.lineTo(this.r,0),e.strokeStyle="rgba(255, 255, 255, 0.5)",e.stroke(),e.restore(),e.save(),e.translate(l,s);let n=this.occupied?this.driver.facing:this.vx>0?1:-1;e.fillStyle="#555",e.fillRect(-10-25*n,-10,10,20),e.fillStyle="#222",e.save(),e.translate(25*n,5),e.fillStyle="#888",e.fillRect(0,-5,20,4),e.fillRect(0,0,20,4),e.fillRect(0,5,20,4),e.fillStyle="#333",e.fillRect(-5,-8,10,20),e.restore(),e.restore()}}class ge{constructor(e,t,i=!1){this.x=e,this.y=t,this.w=120,this.h=60,this.timer=0,this.isIntro=i,this.hp=1e3}update(){if(this.timer++,this.y+=2*Math.sin(.1*this.timer),!this.isIntro&&v)for(let e of v)if(e.health>0&&U(this,e)){m.levelComplete=!0,N();break}this.isIntro&&this.timer>100&&(this.y-=2,this.x-=2,this.y<-200&&(this.x=-9999))}draw(e,t,i,a){let l=this.x-t,s=this.y-i;e.fillStyle="#27ae60",ee(e,l,s,100,50,10),e.fillStyle="rgba(0,0,0,0.5)",e.fillRect(l-20,s-10,140,5),e.fillStyle="#27ae60",e.fillRect(l-40,s+10,40,10),e.fillRect(l-50,s,10,30),e.strokeStyle="#fff",e.beginPath(),e.moveTo(l+50,s+50),e.lineTo(l+50,s+100),e.stroke()}}class be{constructor(e,t){this.x=e,this.y=t,this.w=40,this.h=40,this.freed=!1,this.hp=100;let i=Math.max(1,m.globalUnlocked),a=u.slice(0,i);this.prisonerChar=a[Math.floor(G()*a.length)]}update(){let e=null;if(!this.freed&&v)for(let t of v)if(t.health>0&&U(this,t)){e=t;break}if(e){if(this.freed=!0,j(this.x,this.y,"green",2),function(e){let t=e?e.x:0,i=e?e.y:0,a=m.rescues+1,l=0===m.globalUnlocked?0:2*m.globalUnlocked-1;a>=l?m.globalUnlocked<u.length?(m.globalUnlocked++,m.unlockedCount=m.globalUnlocked,localStorage.setItem("loajf_unlocked",m.globalUnlocked),e&&(e.setCharacter(u[m.globalUnlocked-1].id),e.health=3,e.invincible=60),X(t,i-40,"NEW HERO!","gold"),j(t,i,"gold",2),B&&B.play("powerup")):X(t,i-40,"MAX ROSTER!","gold"):X(t,i-40,l-a+" MORE","cyan")}(e),m.rescues++,m.lives++,X(this.x,this.y-40,"1 UP!","gold"),v)for(let e of v)if(e.dead){e.dead=!1,e.health=3,e.x=this.x,e.y=this.y-40,e.vx=0,e.vy=-5,e.invincible=120,j(e.x,e.y,"#00ff41",2),X(e.x,e.y-20,"REVIVED!","green");break}void 0!==B&&B&&B.play("powerup");try{O()}catch(e){}e&&this.prisonerChar&&(e.setCharacter(this.prisonerChar.id),e.health=3,O(),j(e.x,e.y,"white",2),X(e.x,e.y-60,"SWITCH!","cyan"))}}draw(e,t,i,a){if(this.freed)return;let l=this.x-t,s=this.y-i;e.save(),e.translate(l+20,s+30),e.scale(.8,.8),ce(e,this.prisonerChar,0,{type:null,timer:0}),e.restore(),e.strokeStyle="#bdc3c7",e.lineWidth=2,e.strokeRect(l,s,this.w,this.h);for(let t=10;t<this.w;t+=10)e.beginPath(),e.moveTo(l+t,s),e.lineTo(l+t,s+this.h),e.stroke()}}class ke{constructor(e,t){this.x=e,this.y=t,this.w=a,this.h=a,this.solid=!0,this.state=0,this.timer=0,this.hp=1e3}update(){if(0===this.state){if(v)for(let e of v)if(e.health>0&&Math.abs(e.x-this.x)<20&&Math.abs(e.y+e.h-(this.y+this.h))<10){this.state=1,this.timer=20;break}}else 1===this.state?(this.timer--,this.timer<=0&&(this.state=2,this.timer=60,this.checkDamage())):2===this.state?(this.checkDamage(),this.timer--,this.timer<=0&&(this.state=3,this.timer=30)):3===this.state&&(this.timer--,this.timer<=0&&(this.state=0))}checkDamage(){if(v)for(let e of v)U(this,e)&&(e.takeDamage(1),e.vy=-8)}draw(e,t,i,a){let l=this.x-t,s=this.y-i;e.fillStyle="#555",e.fillRect(l,s+10,this.w,this.h-10),e.fillStyle="#222",e.beginPath(),e.arc(l+10,s+15,3,0,6.28),e.arc(l+30,s+15,3,0,6.28),e.fill(),1===this.state?Math.floor(a/100)%2==0&&(e.fillStyle="red",e.fillRect(l+15,s+12,10,5)):2===this.state&&(e.fillStyle="#bdc3c7",e.beginPath(),e.moveTo(l+5,s+15),e.lineTo(l+10,s-20),e.lineTo(l+15,s+15),e.moveTo(l+25,s+15),e.lineTo(l+30,s-20),e.lineTo(l+35,s+15),e.fill())}}class Se{constructor(e,t,i,a="x"){this.x=e,this.y=t,this.w=60,this.h=20,this.startX=e,this.startY=t,this.range=i,this.axis=a,this.timer=0,this.solid=!0,this.vx=0,this.vy=0,this.hp=9999}update(){this.timer+=.05;let e=Math.sin(this.timer)*this.range,t=this.x,i=this.y;"x"===this.axis?this.x=this.startX+e:this.y=this.startY+e,this.vx=this.x-t,this.vy=this.y-i}draw(e,t,i,a){let l=this.x-t,s=this.y-i;e.fillStyle="#34495e",ee(e,l,s,this.w,this.h,5),e.fillStyle="#f39c12";for(let t=0;t<this.w;t+=10)e.fillRect(l+t,s,5,this.h)}}class Te{constructor(e,t,i,a="x"){this.x=e,this.y=t,this.w=40,this.h=40,this.startX=e,this.startY=t,this.range=i,this.axis=a,this.timer=0,this.solid=!0,this.hp=9999}update(){this.timer+=.1;let e=Math.sin(this.timer)*this.range;if("x"===this.axis?this.x=this.startX+e:this.y=this.startY+e,this.angle=5*this.timer,v)for(let e of v)U(this,e)&&e.takeDamage(1)}draw(e,t,i,a){let l=this.x-t+this.w/2,s=this.y-i+this.h/2;e.save(),e.translate(l,s),e.rotate(this.angle),e.fillStyle="#7f8c8d",e.beginPath();for(let t=0;t<8;t++)e.rotate(Math.PI/4),e.moveTo(0,-20),e.lineTo(10,0),e.lineTo(-10,0);e.fill(),e.fillStyle="#c0392b",e.beginPath(),e.arc(0,0,10,0,6.28),e.fill(),e.restore()}}class we{constructor(e,t){this.x=e,this.y=t,this.w=20,this.h=10,this.solid=!0,this.anchorY=t,this.vy=0,this.hp=50}update(){let e=this.anchorY,t=0;if(v)for(let e of v)e.grounded&&Math.abs(e.x+e.w/2-(this.x+this.w/2))<15&&Math.abs(e.y+e.h-this.y)<20&&(t=10);let i=.1*(e+t-this.y);this.vy+=i,this.vy*=.8,this.y+=this.vy}draw(e,t,i,a){let l=this.x-t,s=this.y-i;e.fillStyle="#8e44ad",ee(e,l,s,this.w,this.h,2),e.strokeStyle="#555",e.beginPath(),e.moveTo(l,s+5),e.lineTo(l-5,s-5),e.stroke(),e.beginPath(),e.moveTo(l+this.w,s+5),e.lineTo(l+this.w+5,s-5),e.stroke()}}class ve{constructor(e,t,i){this.x=e,this.y=t,this.type=i,this.w=20,this.h=20,this.sway=0,this.timer=100*Math.random(),this.solid=!1,this.hp=10}update(){if(this.timer++,this.sway=5*Math.sin(.05*this.timer),v)for(let e of v)Math.abs(e.x-this.x)<30&&Math.abs(e.y-this.y)<30&&(this.sway+=2*(e.vx||0))}draw(e,t,i,a){let l=this.x-t,s=this.y-i;if(e.save(),e.translate(l,s),"grass"===this.type){e.strokeStyle="#2ecc71",e.lineWidth=2;for(let t=0;t<3;t++)e.beginPath(),e.moveTo(0,0),e.quadraticCurveTo(5+this.sway/2,-10,10*t-10+this.sway,-15-Math.abs(this.sway)),e.stroke()}else"vine"===this.type?(e.strokeStyle="#27ae60",e.lineWidth=3,e.beginPath(),e.moveTo(0,0),e.bezierCurveTo(this.sway,10,-this.sway,20,this.sway/2,30),e.stroke(),e.fillStyle="#2ecc71",e.beginPath(),e.arc(this.sway/2,30,3,0,6.28),e.fill()):"rock"===this.type?(e.fillStyle="#7f8c8d",e.beginPath(),e.moveTo(0,0),e.lineTo(10,-10),e.lineTo(20,0),e.fill()):"pipe"===this.type&&(e.fillStyle="#555",e.fillRect(0,-10,20,40),e.strokeStyle="#333",e.strokeRect(0,-10,20,40));e.restore()}}class xe{constructor(e,t){this.x=e,this.y=t,this.w=40,this.h=60,this.vx=0,this.vy=0,this.hp=3,this.facing=1,this.state="patrol",this.timer=0,this.shootTimer=0,this.color="#e74c3c",this.blockedTimer=0,this.speed=2,this.chaseSpeed=3,this.animFrame=0,this.recoil=0}update(){this.vy+=l,this.y+=this.vy,this.recoil>0&&this.recoil--;let e=Math.floor((this.y+this.h)/a),t=Math.floor((this.x+this.w/2)/a);if(e>=0&&e<h&&t>=0&&t<n&&g[e]&&g[e][t]&&(1===g[e][t].type||2===g[e][t].type||3===g[e][t].type)&&(this.y=e*a-this.h,this.vy=0),this.blockedTimer>0)this.blockedTimer--,this.vx=this.facing*this.speed;else{let e=null,t=9999;if(v)for(let i of v)if(i.health>0){let a=Math.hypot(i.x-this.x,i.y-this.y);a<t&&(t=a,e=i)}e&&(this.state=t<600?"chase":"patrol","patrol"===this.state?(this.timer<=0&&(this.timer=60+60*Math.random(),this.facing=Math.random()<.5?-1:1,this.vx=this.facing*this.speed),this.timer--,this.vx=this.facing*this.speed):"chase"===this.state&&(this.facing=e.x<this.x?-1:1,this.vx=this.facing*this.chaseSpeed,this.shootTimer++,this.shootTimer>60&&(this.shoot(e),this.shootTimer=0,this.recoil=5)))}0!==this.vx&&this.animFrame++;let i=this.x+this.vx,s=Math.floor(this.y/a),o=Math.floor((this.y+this.h-1)/a),r=Math.floor((i+(this.vx>0?this.w:0))/a),c=!1;if(r>=0&&r<n){let e=g[s]&&g[s][r],t=g[o]&&g[o][r];(e&&(1===e.type||2===e.type||3===e.type)||t&&(1===t.type||2===t.type||3===t.type))&&(c=!0)}else c=!0;let d=Math.floor((i+(this.vx>0?this.w:0))/a),f=Math.floor((this.y+this.h+2)/a),p=!1;if(f<h&&d>=0&&d<n){let e=g[f][d];e&&0!==e.type&&4!==e.type&&6!==e.type||(p=!0)}else p=!0;c||p?(this.vx=0,this.facing*=-1,this.blockedTimer=60):this.x+=this.vx}shoot(e){if(!e)return;let t=Math.atan2(e.y-this.y,e.x-this.x);t+=.2*(Math.random()-.5);let i=new de(this.x+this.w/2,this.y+20,1,!1,{pColor:this.color,pType:"normal",isEnemy:!0});i.vx=8*Math.cos(t),i.vy=8*Math.sin(t),k.push(i),B&&B.play("enemy_shoot")}takeDamage(e,t){this.hp<=0||(this.hp-=e,X(this.x,this.y,10*e),this.vx=this.x-t>0?5:-5,this.vy=-3,this.blockedTimer=10,this.hp<=0&&(m.levelCompleteStats.kills++,j(this.x+this.w/2,this.y+this.h/2,"red",1),B&&B.play("explosion"),this.x=-9999))}draw(e,t,i,a){let l=this.x-t-this.facing*this.recoil,s=this.y-i,n="#7f8c8d",h=Math.sin(.3*this.animFrame);e.fillStyle="#2c3e50",e.save(),e.translate(l+10,s+40),e.rotate(.5*h),e.fillRect(-5,0,10,20),e.restore(),e.save(),e.translate(l+30,s+40),e.rotate(.5*-h),e.fillRect(-5,0,10,20),e.restore(),e.fillStyle="#c0392b";let o=2*Math.abs(h);e.fillRect(l,s+10-o,40,30),e.strokeStyle="#000",e.lineWidth=2,e.strokeRect(l,s+10-o,40,30),e.fillStyle="#fff",e.fillRect(l+2,s+12-o,2,2),e.fillRect(l+36,s+12-o,2,2),e.fillRect(l+2,s+36-o,2,2),e.fillRect(l+36,s+36-o,2,2),e.fillStyle=n,e.save(),e.translate(l+20,s+2-o),e.fillRect(-10,0,20,15),e.strokeRect(-10,0,20,15),e.fillStyle="#e74c3c",e.beginPath(),e.arc(0+2*this.facing,7,4,0,2*Math.PI),e.fill(),e.fillStyle="#fff",e.fillRect(0+2*this.facing-1,6,2,2),e.restore(),e.fillStyle=n;let r=1===this.facing?l+30:l-10;e.save(),e.translate(r+10,s+20-o),e.rotate(.2*h),e.fillRect(-10,-5,20,8),e.fillStyle="#222",e.fillRect(1===this.facing?10:-15,-8,5,14),e.restore()}}class Ce extends xe{constructor(e,t){super(e,t),this.type="fly",this.hp=2,this.w=40,this.h=40,this.hoverOffset=0}update(){let e=null,t=9999;if(v)for(let i of v)if(i.health>0){let a=Math.hypot(i.x-this.x,i.y-this.y);a<t&&(t=a,e=i)}if(!e)return;let i=0,l=0;t<700?(i=.02*(e.x-this.x),l=.02*(e.y-this.y-100),this.shootTimer++,this.shootTimer>100&&(this.shoot(e),this.shootTimer=0)):(i*=.9,l=1*Math.sin(.005*Date.now()));let s=this.x+i,o=this.y+l,r=Math.floor((o+this.h/2)/a),c=Math.floor((s+this.w/2)/a);r>=0&&r<h&&c>=0&&c<n&&g[r]&&g[r][c]&&(1===g[r][c].type||2===g[r][c].type||3===g[r][c].type)&&(i*=-1.5,l*=-1.5),this.vx+=.1*(i-this.vx),this.vy+=.1*(l-this.vy),this.x+=this.vx,this.y+=this.vy,this.hoverOffset+=.1}draw(e,t,i,a){let l=5*Math.sin(this.hoverOffset),s=this.x-t,n=this.y-i+l;e.save(),e.translate(s+20,n+20),e.rotate(.1*this.vx),e.translate(-20,-20),e.fillStyle="rgba(142, 68, 173, 0.6)",e.beginPath(),e.arc(20,15,15,Math.PI,0),e.fill(),e.strokeStyle="#fff",e.lineWidth=1,e.stroke(),e.fillStyle="#8e44ad",e.beginPath(),e.arc(20,12,6,0,2*Math.PI),e.fill(),e.fillStyle="#bdc3c7",e.beginPath(),e.ellipse(20,20,20,8,0,0,2*Math.PI),e.fill(),e.strokeStyle="#7f8c8d",e.stroke();let h=a;for(let t=0;t<3;t++)e.fillStyle=Math.floor(h/200)%3===t?"red":"#550000",e.beginPath(),e.arc(10+10*t,20,2,0,2*Math.PI),e.fill();e.fillStyle="#333",e.fillRect(15,25,10,5),Math.random()<.5&&(e.fillStyle="cyan",e.beginPath(),e.moveTo(15,30),e.lineTo(20,40+5*Math.random()),e.lineTo(25,30),e.fill()),e.restore()}}class Ee extends xe{constructor(e,t){super(e,t),this.hp=1,this.speed=4,this.chaseSpeed=5,this.color="#d35400",this.charging=!1,this.chargeTimer=0}update(){if(this.charging){this.vx=0,this.vy+=l,this.y+=this.vy;let e=Math.floor((this.y+this.h)/a);if(e>=0&&e<h&&g[e]){let t=Math.floor((this.x+this.w/2)/a);!g[e][t]||1!==g[e][t].type&&2!==g[e][t].type&&3!==g[e][t].type||(this.y=e*a-this.h,this.vy=0)}return this.chargeTimer--,this.chargeTimer%4==0&&(this.x+=4*(Math.random()-.5)),void(this.chargeTimer<=0&&this.explode())}super.update();let e=null,t=9999;if(v)for(let i of v)if(i.health>0){let a=Math.hypot(i.x-this.x,i.y-this.y);a<t&&(t=a,e=i)}e&&t<50&&(this.charging=!0,this.chargeTimer=60)}explode(){let e=this.x,t=this.y;this.x=-9999,Q(e+20,t+30,2,50)}takeDamage(e,t){super.takeDamage(e,t),this.hp<=0&&this.explode()}draw(e,t,i,a){let l=this.x-t,s=this.y-i,n=5*Math.sin(.5*this.animFrame);e.fillStyle="#333",e.save(),e.translate(l+10,s+40),e.rotate(.1*n),e.fillRect(-2,0,5,20),e.restore(),e.save(),e.translate(l+25,s+40),e.rotate(.1*-n),e.fillRect(-2,0,5,20),e.restore(),e.fillStyle="#2c3e50";let h=this.charging?2*Math.sin(.05*a):0;e.beginPath(),e.arc(l+20,s+25,18+h,0,2*Math.PI),e.fill(),e.fillStyle="#7f8c8d",e.fillRect(l+18,s,4,10),(Math.random()<.5||this.charging)&&(e.fillStyle="yellow",e.beginPath(),e.arc(l+20,s,4+h,0,2*Math.PI),e.fill()),e.fillStyle="#000",e.fillRect(l+10,s+20,20,10),e.fillStyle="red",e.font="10px monospace";let o=Math.floor(a/100)%2==0;this.charging?(o=Math.floor(a/10)%2==0,e.fillStyle=o?"white":"red",e.font="bold 12px monospace",e.fillText("!!!",l+14,s+28)):e.fillText(o?":(":"X(",l+12,s+28),e.fillStyle=o?"red":"#500",this.charging&&o&&(e.fillStyle="yellow"),e.beginPath(),e.arc(l+20,s+35,3,0,2*Math.PI),e.fill()}}class De extends xe{constructor(e,t){super(e,t),this.hp=10,this.w=50,this.h=70,this.color="#27ae60",this.speed=0,this.chaseSpeed=0,this.recoil=0}update(){this.vy+=l,this.y+=this.vy,this.recoil>0&&this.recoil--;let e=Math.floor((this.y+this.h)/a),t=Math.floor((this.x+this.w/2)/a);e>=0&&e<h&&t>=0&&t<n&&g[e]&&g[e][t]&&(1===g[e][t].type||2===g[e][t].type||3===g[e][t].type)&&(this.y=e*a-this.h,this.vy=0);let i=null,s=9999;if(v)for(let e of v)if(e.health>0){let t=Math.hypot(e.x-this.x,e.y-this.y);t<s&&(s=t,i=e)}i&&s<700&&(this.facing=i.x<this.x?-1:1,this.shootTimer++,this.shootTimer>10&&(this.shoot(i),this.shootTimer=0,this.recoil=4))}shoot(e){if(!e)return;let t=Math.atan2(e.y-this.y,e.x-this.x);t+=.4*(Math.random()-.5);let i=new de(this.x+this.w/2,this.y+30,1,!1,{pColor:this.color,pType:"normal",isEnemy:!0});i.vx=10*Math.cos(t),i.vy=10*Math.sin(t),k.push(i),B&&B.play("enemy_shoot")}draw(e,t,i,a){let l=this.x-t-this.facing*this.recoil,s=this.y-i;e.fillStyle="#2c3e50",ee(e,l,s+50,50,20,5),e.fillStyle="#7f8c8d";for(let t=0;t<3;t++){let i=l+10+15*t,n=s+60;e.save(),e.translate(i,n),0!==this.vx?e.rotate(.01*a):e.rotate(.2*Math.sin(.005*a)),e.beginPath(),e.arc(0,0,6,0,2*Math.PI),e.fill(),e.fillStyle="#333",e.fillRect(-1,-6,2,12),e.fillRect(-6,-1,12,2),e.restore(),e.fillStyle="#7f8c8d"}e.fillStyle="#27ae60",e.fillRect(l+5,s+10,40,40),e.fillStyle="#1e8449",e.fillRect(l+15,s,20,10),e.fillStyle="#f1c40f",e.fillRect(l+18,s+2,14,4),e.fillStyle="#333";let n=1===this.facing?l+40:l-20;e.fillRect(n-2*this.recoil,s+25,30,10);let h=2*Math.sin(.5*a);e.fillStyle="#111",e.fillRect(n-2*this.recoil+(1===this.facing?30:0),s+22+h,5,16)}}class Fe extends xe{constructor(e,t){super(e,t),this.hp=2,this.range=800,this.aimTimer=0,this.color="#3498db",this.speed=1,this.chaseSpeed=0,this.target=null}update(){this.vy+=l,this.y+=this.vy;let e=Math.floor((this.y+this.h)/a),t=Math.floor((this.x+this.w/2)/a);e>=0&&e<h&&t>=0&&t<n&&g[e]&&g[e][t]&&(1===g[e][t].type||2===g[e][t].type||3===g[e][t].type)&&(this.y=e*a-this.h,this.vy=0);let i=null,s=9999;if(v)for(let e of v)if(e.health>0){let t=Math.abs(e.x-this.x);t<s&&(s=t,i=e)}this.target=i,i&&(s<this.range?(this.facing=i.x<this.x?-1:1,this.aimTimer++,this.aimTimer>180&&(this.shoot(i),this.aimTimer=0)):(this.aimTimer=0,super.update()))}shoot(e){if(!e)return;let t=Math.atan2(e.y-this.y,e.x-this.x),i=new de(this.x+this.w/2,this.y+20,2,!1,{pColor:this.color,pType:"normal",isEnemy:!0});i.vx=20*Math.cos(t),i.vy=20*Math.sin(t),k.push(i),B&&B.play("enemy_shoot")}draw(e,t,i,a){let l=this.x-t,s=this.y-i;e.fillStyle="#34495e",e.fillRect(l+15,s+40,4,20),e.fillRect(l+25,s+40,4,20),e.fillStyle="#3498db",e.fillRect(l+15,s+15,14,25),e.fillStyle="#2c3e50",e.beginPath(),e.arc(l+22,s+10,8,0,2*Math.PI),e.fill(),e.fillStyle="#000";let n=l+22+4*this.facing;e.beginPath(),e.arc(n,s+10,4,0,2*Math.PI),e.fill(),e.fillStyle="red",e.beginPath(),e.arc(n,s+10,2,0,2*Math.PI),e.fill(),e.fillStyle="#111";1===this.facing?(e.fillRect(l+20,s+20,40,4),e.fillRect(l+20,s+22,10,6)):(e.fillRect(l+24-40,s+20,40,4),e.fillRect(l+14,s+22,10,6)),this.aimTimer>100&&this.target&&(e.strokeStyle="rgba(231, 76, 60, 0.5)",e.lineWidth=1,e.beginPath(),e.moveTo(l+this.w/2,s+22),e.lineTo(this.target.x-t+this.target.w/2,this.target.y-i+this.target.h/2),e.stroke())}}class Me extends xe{constructor(e,t){super(e,t),this.hp=8,this.shieldUp=!0,this.color="#7f8c8d",this.speed=1,this.chaseSpeed=1}update(){super.update();let e=null,t=9999;if(v)for(let i of v)if(i.health>0){let a=Math.abs(i.x-this.x);a<t&&(t=a,e=i)}e&&(this.shieldUp=e.x<this.x&&-1===this.facing||e.x>this.x&&1===this.facing)}takeDamage(e,t){if(this.hp<=0)return;let i=t<this.x&&-1===this.facing||t>this.x&&1===this.facing;this.shieldUp&&i?(j(this.x+20,this.y+20,"blue",1),X(this.x,this.y-20,"BLOCKED!","blue"),this.hp-=.1*e):(this.hp-=e,j(this.x+20,this.y+20,"red",2),X(this.x,this.y,10*e)),this.hp<=0&&(m.levelCompleteStats.kills++,this.x=-9999,j(this.x,this.y,"red",3),B&&B.play("explosion"))}draw(e,t,i,a){let l=this.x-t,s=this.y-i;e.fillStyle="#2c3e50",e.fillRect(l+5,s+40,10,20),e.fillRect(l+25,s+40,10,20),e.fillStyle="#95a5a6",e.fillRect(l+5,s+10,30,30),e.fillStyle="#2c3e50",ee(e,l+10,s-5,20,15,5),e.fillStyle="cyan",e.fillRect(l+12,s,16,2),e.fillStyle="rgba(52, 152, 219, 0.6)",e.strokeStyle="#fff",e.lineWidth=2;let n=1===this.facing?l+25:l-15;ee(e,n,s,30,60,5),e.stroke(),e.fillStyle="white",e.font="10px Arial",e.fillText("POLICE",n+2,s+30)}}class Ae extends xe{constructor(e,t){super(e,t),this.hp=15+2*m.currentLevel,this.w=50,this.h=70,this.color="#9b59b6"}update(){this.vy+=l,this.y+=this.vy;let e=Math.floor((this.y+this.h)/a),t=Math.floor((this.x+this.w/2)/a);e>=0&&e<h&&t>=0&&t<n&&g[e]&&g[e][t]&&(1===g[e][t].type||2===g[e][t].type||3===g[e][t].type)&&(this.y=e*a-this.h,this.vy=0);let i=null,s=9999;if(v)for(let e of v)if(e.health>0){let t=Math.abs(e.x-this.x);t<s&&(s=t,i=e)}i&&s<800&&(this.facing=i.x<this.x?-1:1)}shootBurst(e){if(e)for(let t=0;t<3;t++)setTimeout(()=>{if(this.hp<=0)return;if(e.health<=0)return;let t=Math.atan2(e.y-this.y,e.x-this.x),i=new de(this.x+this.w/2,this.y+20,1,!1,{pColor:this.color,pType:"normal",isEnemy:!0});i.vx=12*Math.cos(t),i.vy=12*Math.sin(t),i.color="gold",k.push(i),B&&B.play("enemy_shoot")},100*t)}takeDamage(e,t){if(!(this.hp<=0)&&(this.hp-=e,X(this.x,this.y,10*e,"gold"),this.hp<=0)){m.levelCompleteStats.kills++;let e=this.x,t=this.y;j(e+this.w/2,t+this.h/2,"gold",3),B&&B.play("explosion"),this.x=-9999,k.push(new ge(e,t-50,!1))}}draw(e,t,i,a){let l=this.x-t,s=this.y-i;e.fillStyle="#333",ee(e,l,s+10,50,50,10),e.fillStyle="#FFE4C4",ee(e,l+10,s-10,30,30,8),e.strokeStyle="#111",e.lineWidth=3,e.beginPath(),e.arc(l+25,s-5,18,Math.PI,0),e.stroke(),e.fillStyle="#222",e.fillRect(l+5,s-8,8,12),e.fillRect(l+37,s-8,8,12),e.strokeStyle="#333",e.lineWidth=2,e.beginPath(),e.moveTo(l+37,s),e.lineTo(l+42,s+5),e.lineTo(l+30,s+10),e.stroke(),e.fillStyle="#555",e.beginPath(),e.arc(l+30,s+10,2,0,2*Math.PI),e.fill(),e.fillStyle="#000",e.beginPath(),e.arc(l+20,s,2,0,2*Math.PI),e.fill(),e.beginPath(),e.arc(l+30,s,2,0,2*Math.PI),e.fill(),e.strokeStyle="rgba(0,0,0,0.2)",e.lineWidth=1,e.beginPath(),e.arc(l+20,s+2,3,0,Math.PI),e.stroke(),e.beginPath(),e.arc(l+30,s+2,3,0,Math.PI),e.stroke(),e.fillStyle="#222",e.save(),e.translate(l+25,s+40),e.fillStyle="#FFE4C4",e.beginPath(),e.arc(-10,0,5,0,2*Math.PI),e.fill(),e.beginPath(),e.arc(10,0,5,0,2*Math.PI),e.fill(),e.fillStyle="#444",ee(e,-12,-4,24,12,4),e.restore()}}class Pe{constructor(e,t){this.x=e,this.y=t,this.w=120,this.h=120,this.hp=50+15*m.currentLevel,this.maxHp=this.hp,this.state="idle",this.timer=0,this.dirY=1}update(){let e=null,t=9999;if(v)for(let i of v)if(i.health>0){let a=Math.abs(i.x-this.x);a<t&&(t=a,e=i)}if(!m.bossActive&&e&&t<800&&(m.bossActive=!0,document.getElementById("bossHealthContainer")&&(document.getElementById("bossHealthContainer").style.display="block")),!m.bossActive)return;this.y+=2*this.dirY,(this.y>2400-this.h-100||this.y<50)&&(this.dirY*=-1),this.timer++;let i=m.currentLevel,a=100;if(i>=5&&(a=80),i>=10&&(a=60),i>=15&&(a=40),this.timer>a){if(!e)return;let t=Math.atan2(e.y-this.y,e.x-this.x),l=8+.2*i,s=new de(this.x+60,this.y+60,2,!1,{pColor:"#c0392b",pType:"normal",isEnemy:!0});if(s.vx=Math.cos(t)*l,s.vy=Math.sin(t)*l,k.push(s),B&&B.play("enemy_shoot"),i>=3){let e=.2,i=new de(this.x+60,this.y+60,2,!1,{pColor:"#c0392b",pType:"normal",isEnemy:!0});i.vx=Math.cos(t-e)*l,i.vy=Math.sin(t-e)*l;let a=new de(this.x+60,this.y+60,2,!1,{pColor:"#c0392b",pType:"normal",isEnemy:!0});a.vx=Math.cos(t+e)*l,a.vy=Math.sin(t+e)*l,k.push(i),k.push(a),B&&B.play("enemy_shoot")}if(i>=6){let e=.4,i=new de(this.x+60,this.y+60,2,!1,{pColor:"#c0392b",pType:"normal",isEnemy:!0});i.vx=Math.cos(t-e)*l,i.vy=Math.sin(t-e)*l,k.push(i);let a=new de(this.x+60,this.y+60,2,!1,{pColor:"#c0392b",pType:"normal",isEnemy:!0});a.vx=Math.cos(t+e)*l,a.vy=Math.sin(t+e)*l,k.push(a),B&&B.play("enemy_shoot")}if(i>=10&&this.timer%(2*a)==0){let t=new pe(this.x+60,this.y+60);t.vx=.05*(e.x-this.x),t.vy=-5,k.push(t)}this.timer=0}}takeDamage(e,t){if(!m.bossActive)return;this.hp-=e,Z(2);let i=this.hp/this.maxHp*100;document.getElementById("bossHealthBar")&&(document.getElementById("bossHealthBar").style.width=i+"%"),X(this.x+60,this.y+60,10*e),this.hp<=0&&(m.levelCompleteStats.kills++,Z(50),j(this.x+60,this.y+60,"#ff00de",5),B&&B.play("explosion"),m.bossActive=!1,document.getElementById("bossHealthContainer")&&(document.getElementById("bossHealthContainer").style.display="none"),k.push(new ge(this.x,this.y,!1)),this.x=-9999,m.slowMo=.2,setTimeout(()=>m.slowMo=1,2e3))}draw(e,t,i,a){if(this.hp<=0)return;let l=this.x-t,s=this.y-i,n=0;this.hp<.5*this.maxHp&&(n=4*(Math.random()-.5)),e.save(),e.translate(l+this.w/2+n,s+this.h/2+n),e.fillStyle="#c0392b",ee(e,-40,-50,80,100,10),e.fillStyle="rgba(255,255,255,0.2)",e.fillRect(-30,-40,10,80),e.fillStyle="#222",e.beginPath(),e.arc(-45,45,15,0,2*Math.PI),e.fill(),e.beginPath(),e.arc(45,45,15,0,2*Math.PI),e.fill(),e.fillStyle="#555",e.beginPath(),e.arc(-45,45,5,0,2*Math.PI),e.fill(),e.beginPath(),e.arc(45,45,5,0,2*Math.PI),e.fill(),e.strokeStyle="#333",e.lineWidth=15,e.lineCap="round",e.lineJoin="round",e.beginPath(),e.moveTo(0,-50);let h=30*Math.sin(.005*a),o=30*Math.cos(.005*a);e.bezierCurveTo(0,-100,-80+h,-50+o,-60,0),e.stroke(),e.fillStyle="#222",e.save(),e.translate(-60,0),e.rotate(.5*Math.sin(.1*this.timer)),e.fillRect(-15,-10,30,40),e.fillStyle="#111",e.fillRect(-20,30,40,10),e.restore(),e.fillStyle="#000",e.beginPath(),e.moveTo(-20,-20),e.lineTo(-5,-10),e.lineTo(-20,0),e.fill(),e.beginPath(),e.moveTo(20,-20),e.lineTo(5,-10),e.lineTo(20,0),e.fill(),e.fillStyle="#222";for(let t=0;t<3;t++)e.fillRect(-15,20+8*t,30,4);e.fillStyle="#fff",e.font="bold 20px Arial",e.fillText("VACUUM KING",-70,-70),e.restore()}}class Re{constructor(e,t){this.x=e,this.y=t,this.w=150,this.h=80,this.hp=200+20*m.currentLevel,this.maxHp=this.hp,this.state="fly",this.timer=0,this.vx=2,this.vy=0,this.targetX=e}update(){let e=null,t=9999;if(v)for(let i of v)if(i.health>0){let a=Math.hypot(i.x-this.x,i.y-this.y);a<t&&(t=a,e=i)}if(!m.bossActive&&e&&t<800&&(m.bossActive=!0,document.getElementById("bossHealthContainer")&&(document.getElementById("bossHealthContainer").style.display="block")),!m.bossActive)return;this.timer++,this.y+=2*Math.sin(.05*this.timer),this.timer%60==0&&e&&(this.targetX=e.x),this.x+=.02*(this.targetX-this.x);let i=m.currentLevel;if(!e)return;if(this.timer%10==0){let t=Math.atan2(e.y-this.y,e.x-this.x);t+=.2*(Math.random()-.5);let i=new de(this.x+75,this.y+60,1,!1,{pColor:"#f1c40f",pType:"normal",isEnemy:!0});i.vx=15*Math.cos(t),i.vy=15*Math.sin(t),k.push(i),B&&B.play("enemy_shoot")}let a=180;if(i>=10&&(a=120),this.timer%a===0){let t=new pe(this.x+75,this.y+80);i>=5&&(t.vx=.05*(e.x-this.x)),k.push(t)}i>=15&&(this.x+=.01*(e.x-this.x))}takeDamage(e,t){if(!m.bossActive)return;this.hp-=e;let i=this.hp/this.maxHp*100;document.getElementById("bossHealthBar")&&(document.getElementById("bossHealthBar").style.width=i+"%"),X(this.x+75,this.y+40,10*e,"cyan"),Z(2),this.hp<=0&&(m.levelCompleteStats.kills++,Z(100),j(this.x+75,this.y+40,"orange",10),B&&B.play("explosion"),m.bossActive=!1,document.getElementById("bossHealthContainer")&&(document.getElementById("bossHealthContainer").style.display="none"),this.x=-9999,k.push(new ge(15400,320,!1)),m.slowMo=.1,setTimeout(()=>m.slowMo=1,3e3))}draw(e,t,i,a){if(this.hp<=0)return;let l=this.x-t,s=this.y-i;e.fillStyle="#2f4f4f",ee(e,l,s,140,70,20),e.fillStyle="#3498db",e.beginPath(),e.moveTo(l+10,s+20),e.lineTo(l+40,s+20),e.lineTo(l+40,s+50),e.lineTo(l+15,s+50),e.fill(),e.fillStyle="#000",e.save(),e.translate(l+60,s-10),e.scale(1,.1),e.beginPath(),e.arc(0,0,80,0,2*Math.PI),e.fill(),e.restore(),e.fillStyle="#111",e.fillRect(l+60,s+70,30,10),this.timer%10<5&&(e.fillStyle="yellow",e.beginPath(),e.arc(l+75,s+85,10,0,2*Math.PI),e.fill()),e.fillStyle="#111",e.fillRect(l+80,s+20,40,30)}}function Ie(){t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,e.width,e.height);var i=t.createLinearGradient(0,0,0,e.height);i.addColorStop(0,"#111"),i.addColorStop(1,"#333"),t.fillStyle=i,t.fillRect(0,0,e.width,e.height)}function Oe(){const i=Date.now();t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,e.width,e.height);var a=t.createLinearGradient(0,0,0,e.height);a.addColorStop(0,"#111"),a.addColorStop(1,"#333"),t.fillStyle=a,t.fillRect(0,0,e.width,e.height);let l=70,s=1260,n=Math.ceil(u.length/18)*l,h=1,o=1;s>e.width-50&&(h=(e.width-50)/s),n>e.height-150&&(o=(e.height-150)/n);let r=Math.min(h,o);t.font="30px 'Courier New'",t.fillStyle="#00ff41",t.textAlign="center",t.fillText("ROSTER STATUS: "+m.globalUnlocked+" / "+u.length+" HEROES UNLOCKED",e.width/2,50),t.save(),t.translate((e.width-s*r)/2,100),t.scale(r,r);for(let e=0;e<u.length;e++){let a=e%18*l+35,s=Math.floor(e/18)*l+35;if(t.fillStyle="rgba(255,255,255,0.1)",ee(t,a-30,s-30,60,60,10),e<m.globalUnlocked){t.save(),t.translate(a,s),t.scale(.8,.8);let l=i/100;ce(t,u[e],l),t.restore(),t.fillStyle="#aaa",t.font="8px Arial";let n=u[e].name.split(" ")[0];n.length>8&&(n=n.substring(0,8)),t.fillText(n,a,s+40)}else{t.fillStyle="#222",t.beginPath(),t.arc(a,s,15,0,2*Math.PI),t.fill();let i=(0===e?0:2*e-1)-m.rescues;i<0&&(i=0),t.fillStyle="#555",e===m.globalUnlocked?(t.font="10px Arial",t.fillText("NEXT",a,s-5),t.font="bold 16px Arial",t.fillStyle="#00ff41",t.fillText(i,a,s+12)):e<m.globalUnlocked+10?(t.font="10px Arial",t.fillText("NEED",a,s-5),t.font="16px Arial",t.fillText(i,a,s+12)):(t.font="20px Arial",t.fillText("?",a,s+8))}}t.restore()}function Be(e,t){t={...t},e.charData.trait||(t.damage&&(t.damage=Math.ceil(1.5*t.damage)),t.w&&(t.w*=1.3),t.h&&(t.h*=1.3),t.vx&&(t.vx*=1.3),t.vy&&(t.vy*=1.3),j(e.x+20*e.facing,e.y,e.charData.pColor||"white",1),Z(2)),t.owner=e;let i=new de(e.x+(e.facing>0?e.w:0),e.y+e.h/2-5,e.facing,!1,t);return k.push(i),i}function Ne(e,t,i,a=40,l=0){e.charData.trait||(i=Math.ceil(1.5*i),t*=1.3,a*=1.3,j(e.x+e.facing*t,e.y,"white",1),Z(3));let s=new fe(e.x+(1===e.facing?e.w+l:-t-l),e.y+(e.h-a)/2,t,a,e,i);return k.push(s),s}function Le(e){B&&B.play(e)}const qe=e=>t=>{Math.abs(t.vx)>1&&(t.vx*=e),t.x+=t.vx,t.y+=t.vy},_e=e=>e=>{if(0===e.returnState)e.x+=e.vx,e.vx*=.95,Math.abs(e.vx)<1&&(e.returnState=1);else{let t=e.owner;if(!t)return void(e.life=0);let i=t.x+t.w/2-e.x,a=t.y+t.h/2-e.y,l=Math.atan2(a,i);e.x+=15*Math.cos(l),e.y+=15*Math.sin(l),Math.hypot(i,a)<20&&(e.life=0)}},Ge=e=>t=>{let i=null,a=400;for(let e of k)if(e.hp&&e.hp>0&&e!==t.owner&&e!==t&&!e.dead){let l=Math.hypot(e.x-t.x,e.y-t.y);l<a&&(a=l,i=e)}if(i){let a=Math.atan2(i.y+i.h/2-t.y,i.x+i.w/2-t.x);Math.atan2(t.vy,t.vx),t.vx+=Math.cos(a)*e,t.vy+=Math.sin(a)*e;let l=Math.hypot(t.vx,t.vy),s=12;l>s&&(t.vx=t.vx/l*s,t.vy=t.vy/l*s)}t.x+=t.vx,t.y+=t.vy},He=(e,t)=>i=>{let a=i.owner;a&&!a.dead?(i.angle=(i.angle||0)+t,i.x=a.x+a.w/2+Math.cos(i.angle)*e,i.y=a.y+a.h/2+Math.sin(i.angle)*e):i.life=0},Ue={circle:(e,t)=>(i,a,l,s,n)=>{i.fillStyle=e,i.beginPath(),i.arc(l+a.w/2,s+a.h/2,t,0,2*Math.PI),i.fill()},rect:e=>(t,i,a,l,s)=>{t.fillStyle=e,t.fillRect(a,l,i.w,i.h)},laser:e=>(t,i,a,l,s)=>{t.fillStyle=e,t.shadowBlur=10,t.shadowColor=e,t.fillRect(a,l,i.w,i.h),t.shadowBlur=0},star:e=>(t,i,a,l,s)=>{t.save(),t.translate(a+i.w/2,l+i.h/2),t.rotate(.1*s),t.fillStyle=e,t.beginPath();for(let e=0;e<5;e++)t.lineTo(10*Math.cos((18+72*e)/180*Math.PI),10*-Math.sin((18+72*e)/180*Math.PI)),t.lineTo(5*Math.cos((54+72*e)/180*Math.PI),5*-Math.sin((54+72*e)/180*Math.PI));t.fill(),t.restore()},note:e=>(t,i,a,l,s)=>{t.fillStyle=e,t.font="20px Arial",t.fillText("‚ô™",a,l+15)},bone:(e,t,i,a,l)=>{e.save(),e.translate(i+t.w/2,a+t.h/2),e.rotate(.2*l),e.fillStyle="#eee",e.fillRect(-10,-3,20,6),e.beginPath(),e.arc(-12,-4,4,0,2*Math.PI),e.fill(),e.beginPath(),e.arc(-12,4,4,0,2*Math.PI),e.fill(),e.beginPath(),e.arc(12,-4,4,0,2*Math.PI),e.fill(),e.beginPath(),e.arc(12,4,4,0,2*Math.PI),e.fill(),e.restore()},shuriken:e=>(t,i,a,l,s)=>{t.save(),t.translate(a+i.w/2,l+i.h/2),t.rotate(.5*s),t.fillStyle=e,t.beginPath(),t.moveTo(0,-10),t.lineTo(3,-3),t.lineTo(10,0),t.lineTo(3,3),t.lineTo(0,10),t.lineTo(-3,3),t.lineTo(-10,0),t.lineTo(-3,-3),t.fill(),t.restore()}},We={pug:{shoot:e=>{Le("shoot"),Be(e,{pColor:"#f00",vx:25*e.facing,w:40,h:4,damage:2,renderer:Ue.laser("red")})},special:e=>{Le("shoot"),Be(e,{pColor:"#f00",vx:30*e.facing,w:400,h:20,damage:10,life:10,renderer:Ue.laser("#ffaaaa")}),Z(5)}},raccoon:{shoot:e=>{Le("throw"),Be(e,{vx:15*e.facing,w:20,h:20,life:100,damage:2,behavior:_e(1),renderer:(e,t,i,a,l)=>{e.save(),e.translate(i+10,a+10),e.rotate(.3*l),e.fillStyle="#888",e.beginPath(),e.arc(0,0,10,0,2*Math.PI),e.fill(),e.fillStyle="#555",e.beginPath(),e.arc(0,0,3,0,2*Math.PI),e.fill(),e.restore()}})},special:e=>{Be(e,{vx:5*e.facing,vy:-5,w:40,h:40,damage:10}).type="grenade"}},cat:{shoot:e=>{for(let t=-1;t<=1;t++)Be(e,{vx:15*e.facing,vy:2*t,w:15,h:10,damage:2,renderer:(e,t,i,a,l)=>{e.fillStyle="#000",e.beginPath(),e.arc(i+t.w/2,a+t.h/2,5,0,2*Math.PI),e.fill(),e.beginPath(),e.moveTo(i,a),e.lineTo(i-5,a-5),e.lineTo(i+5,a),e.stroke()}})},special:e=>{e.invincible=60,e.vx=25*e.facing,Ne(e,60,5),e.health<3&&e.health++,X(e.x,e.y-20,"DRAIN!","red")}},corgi:{shoot:e=>{Be(e,{vx:30*e.facing,w:40,h:4,damage:3,renderer:Ue.laser("cyan")})},special:e=>{for(let t=0;t<5;t++)Be(e,{x:e.x+(50*t-100),y:e.y-300,vx:0,vy:40,w:10,h:300,damage:8,renderer:Ue.laser("white")});Z(10)}},hulk:{shoot:e=>{Ne(e,60,4),Z(2)},special:e=>{Be(e,{vx:10*e.facing,vy:0,w:60,h:40,damage:6,life:30,renderer:Ue.rect("#00ff00")}),Be(e,{vx:10*-e.facing,vy:0,w:60,h:40,damage:6,life:30,renderer:Ue.rect("#00ff00")}),Z(10)}},spider:{shoot:e=>{Be(e,{vx:20*e.facing,w:10,h:10,damage:2,behavior:qe(.95),renderer:Ue.circle("white",5)})},special:e=>{Be(e,{vx:0,vy:0,w:60,h:60,damage:1,life:200,renderer:(e,t,i,a)=>{e.strokeStyle="white",e.lineWidth=1,e.beginPath(),e.moveTo(i,a),e.lineTo(i+60,a+60),e.moveTo(i+60,a),e.lineTo(i,a+60),e.stroke()}})}},wolvie:{shoot:e=>{Ne(e,40,3,30)},special:e=>{e.vx=20*e.facing;for(let t=0;t<5;t++)setTimeout(()=>Ne(e,60,3,40),100*t)}},dead:{shoot:e=>{Be(e,{vx:20*e.facing,w:5,h:5,damage:3,renderer:Ue.rect("yellow")})},special:e=>{for(let t=0;t<3;t++)Be(e,{vx:10*e.facing+2*t,vy:-8-t,w:15,h:15,damage:8,type:"grenade"})}},cap:{shoot:e=>{Be(e,{vx:18*e.facing,w:20,h:20,damage:3,behavior:_e(1.2),renderer:(e,t,i,a)=>{e.fillStyle="red",e.beginPath(),e.arc(i+10,a+10,10,0,2*Math.PI),e.fill(),e.fillStyle="white",e.beginPath(),e.arc(i+10,a+10,7,0,2*Math.PI),e.fill(),e.fillStyle="blue",e.beginPath(),e.arc(i+10,a+10,4,0,2*Math.PI),e.fill()}})},special:e=>{e.vy=-10,e.vx=15*e.facing,Ne(e,60,6)}},ironmouse:{shoot:e=>{Be(e,{vx:20*e.facing,w:10,h:4,damage:2,renderer:Ue.laser("cyan")})},special:e=>{for(let t=0;t<6;t++)Be(e,{vx:10*e.facing,vy:3*(t-2.5),w:8,h:8,damage:4,behavior:Ge(.5),renderer:Ue.rect("orange")})}},starlord:{shoot:e=>{Be(e,{vx:20*e.facing,vy:-1,w:8,h:8,damage:3,renderer:Ue.circle("cyan",4)}),Be(e,{vx:20*e.facing,vy:1,w:8,h:8,damage:3,renderer:Ue.circle("magenta",4)})},special:e=>{Be(e,{vx:8*e.facing,vy:0,w:40,h:40,damage:1,life:120,renderer:(e,t,i,a,l)=>{e.strokeStyle="purple",e.lineWidth=2,e.beginPath(),e.arc(i+20,a+20,20+5*Math.sin(.2*l),0,2*Math.PI),e.stroke()}})}},gamora:{shoot:e=>{Be(e,{vx:25*e.facing,w:10,h:2,damage:2,renderer:Ue.rect("lime")})},special:e=>{e.vx=30*e.facing,Ne(e,80,8)}},drax:{shoot:e=>{Be(e,{vx:15*e.facing,vy:-5,w:15,h:15,damage:5,type:"grenade",renderer:Ue.circle("grey",8)})},special:e=>{Be(e,{vx:10*e.facing,vy:0,w:40,h:40,damage:8,life:60,renderer:Ue.circle("#555",20)})}},vision:{shoot:e=>{Be(e,{vx:30*e.facing,w:40,h:6,damage:4,renderer:Ue.laser("#ff00ff")})},special:e=>{e.invincible=90,Be(e,{vx:0,vy:0,w:100,h:100,damage:5,life:10,renderer:Ue.circle("rgba(255,0,255,0.3)",50)})}},scarlet:{shoot:e=>{Be(e,{vx:12*e.facing,w:12,h:12,damage:3,behavior:Ge(.8),renderer:Ue.circle("red",6)})},special:e=>{for(let t=0;t<8;t++){let i=t*(Math.PI/4);Be(e,{vx:10*Math.cos(i),vy:10*Math.sin(i),w:15,h:15,damage:5,renderer:Ue.circle("red",8)})}}},ghost:{shoot:e=>{Be(e,{vx:20*e.facing,w:30,h:5,damage:4,renderer:Ue.rect("rgba(200,255,255,0.8)")})},special:e=>{for(let t=0;t<3;t++){Be(e,{vx:0,vy:0,w:15,h:15,damage:5,life:200,behavior:He(50,.1+2*t),renderer:Ue.circle("white",8)}).angle=t*(2*Math.PI/3)}}},galaxygod:{shoot:e=>{Be(e,{vx:18*e.facing,w:15,h:15,damage:5,renderer:Ue.star("gold")})},special:e=>{Be(e,{vx:0,vy:0,w:200,h:200,damage:20,life:10,renderer:Ue.circle("white",100)}),Z(15)}},skeletonram:{shoot:e=>{Be(e,{vx:15*e.facing,vy:-8,w:20,h:8,damage:4,type:"grenade",renderer:Ue.bone})},special:e=>{for(let t=0;t<5;t++)Be(e,{vx:10*e.facing+10*Math.random(),vy:-10-5*Math.random(),w:20,h:8,damage:5,type:"grenade",renderer:Ue.bone})}},robbereagle:{shoot:e=>{Be(e,{vx:20*e.facing,w:10,h:10,damage:2,renderer:Ue.circle("gold",5)})},special:e=>{Be(e,{vx:0,vy:5,w:30,h:30,damage:15,renderer:Ue.rect("brown")})}},policecroc:{shoot:e=>{Ne(e,50,5)},special:e=>{Be(e,{vx:15*e.facing,w:15,h:15,damage:2,behavior:_e(1),renderer:(e,t,i,a)=>{e.strokeStyle="pink",e.lineWidth=4,e.beginPath(),e.arc(i+8,a+8,6,0,2*Math.PI),e.stroke()}})}},homepumpkin:{shoot:e=>{Be(e,{vx:22*e.facing,w:6,h:4,damage:2,renderer:Ue.circle("orange",3)})},special:e=>{Be(e,{vx:0,vy:0,w:20,h:80,damage:5,life:100,renderer:Ue.rect("green")})}},default:{shoot:e=>{Be(e,{vx:20*e.facing,w:10,h:10,damage:3})}}};u.forEach(e=>{We[e.id]||(We[e.id]={shoot:t=>{let i={vx:20*t.facing,w:12,h:12,damage:3,pColor:e.pColor};if(e.pType.includes("grenade"))i.type="grenade",i.vy=-8;else if(e.pType.includes("boomerang"))i.behavior=_e(1);else if(e.pType.includes("laser"))i.renderer=Ue.laser(e.pColor),i.w=30,i.h=4;else{if(e.pType.includes("spread")){for(let e=-1;e<=1;e++)Be(t,{...i,vy:3*e});return}if(e.pType.includes("melee"))return void Ne(t,40,3)}Be(t,i)},special:t=>{let i={vx:15*t.facing,w:30,h:30,damage:8,pColor:e.pColor};e.pType.includes("grenade")?(i.type="grenade",i.vy=-10):e.pType.includes("laser")?(i.renderer=Ue.laser(e.pColor),i.w=200,i.h=10):i.type="rocket",Be(t,i)}})});class Ve{constructor(e=0){this.index=e,this.reset(),this.charData=u[e%u.length]}setCharacter(e){this.charData=u.find(t=>t.id===e)||u[0],this.w=this.charData.w||24,this.h=this.charData.h||30,0===this.index&&O()}reset(){this.x=m.spawnPoint.x+20*this.index,this.y=m.spawnPoint.y,this.w=24,this.h=30,this.vx=0,this.vy=0,this.speed=5,this.grounded=!1,this.facing=1,this.health=3,this.invincible=0,this.stretchX=1,this.stretchY=1,this.animFrame=0,this.lastY=this.y,this.secondaryCooldown=0,this.shootCooldown=0,this.specialCooldown=0,this.attackAnim={type:null,timer:0,max:0},this.wallJumpLocked=!1,this.stamina=100,this.maxStamina=100,this.staminaRecharge=1,this.dead=!1,this.inHamsterBall=!1,this.hamsterBall=null}respawn(){if(m.lives--,O(),m.lives<=0)return void L();let e=u.slice(0,m.globalUnlocked),t=Math.floor(G()*e.length);this.setCharacter(e[t].id),this.x=m.spawnPoint.x,this.y=m.spawnPoint.y-40,this.vx=0,this.vy=0,this.health=3,this.invincible=120,this.stamina=100,this.dead=!1,this.inHamsterBall=!1,this.hamsterBall=null,j(this.x,this.y,"#00ff41",2),B&&B.play("powerup")}checkWall(e){if(!g)return!1;let t=e>0?this.x+this.w+2:this.x-2,i=[this.y,this.y+this.h/2,this.y+this.h-1];for(let e of i){let i=Math.floor(e/a),l=Math.floor(t/a);if(i>=0&&i<h&&l>=0&&l<n&&g[i]&&g[i][l]&&(1===g[i][l].type||2===g[i][l].type||3===g[i][l].type))return!0}return!1}update(){if(this.dead)return;if(this.lastY=this.y,this.inHamsterBall&&this.hamsterBall)return this.hamsterBall.updateDriven(this),this.invincible>0&&this.invincible--,void(this.y>2600&&this.takeDamage(99));this.secondaryCooldown>0&&this.secondaryCooldown--,this.attackAnim.timer>0&&this.attackAnim.timer--,this.grounded&&this.stamina<this.maxStamina&&(this.stamina+=this.staminaRecharge);let e=E[this.index]||{};if(e.f)return this.vx=0,this.attackAnim={type:"flex",timer:10,max:10},m.frame%10==0&&(X(this.x,this.y-20,"FLEX!","gold"),Z(2)),this.vy+=l,this.y+=this.vy,void this.checkCollisions(!1);let t=Math.floor((this.x+this.w/2)/a),i=Math.floor((this.y+this.h/2)/a),o=i>=0&&i<h&&t>=0&&t<n&&g[i]&&g[i][t]&&6===g[i][t].type,r=0;(e.arrowleft||e.a)&&(r=-1),(e.arrowright||e.d)&&(r=1),(e.c||e.v)&&this.secondaryCooldown<=0&&(this.performSecondary(),this.secondaryCooldown=30);let d=e.shift;this.speed=d?9:5;let f=0;this.checkWall(-1)&&(f=-1),this.checkWall(1)&&(f=1);let p=!1,y=!1;if("climb"!==this.charData.trait||0===f||this.grounded?!this.grounded&&0!==f&&r===f&&this.vy>0&&(p=!0,this.vy>2&&(this.vy=2),e[" "]&&!this.wallJumpLocked&&(this.vy=s,B&&B.play("jump"),this.vx=5*-f,this.wallJumpLocked=!0,this.facing=-f,j(this.x+(f>0?this.w:0),this.y+this.h/2,c,.5),p=!1)):(y=!0,this.vx=0,this.vy=0,(e.arrowup||e.w)&&(this.vy=-4),(e.arrowdown||e.s)&&(this.vy=4),e[" "]&&!this.wallJumpLocked&&(this.vy=s,B&&B.play("jump"),this.vx=5*-f,this.wallJumpLocked=!0,this.facing=-f,j(this.x+(f>0?this.w:0),this.y+this.h/2,c,.5),y=!1)),e[" "]||(this.wallJumpLocked=!1),o){if(this.vy=0,0!==r)this.vx=3*r;else{let e=t*a+(a-this.w)/2;this.vx=.2*(e-this.x)}(e.arrowup||e.w)&&(this.vy=-3),(e.arrowdown||e.s)&&(this.vy=3),e[" "]&&(this.vy=s,B&&B.play("jump"))}else if(!y){if(!this.wallJumpLocked){if(0!==r){this.vx+=.8*r,this.facing=r,this.animFrame+=d?2:1;let e=d?5:10;this.grounded&&this.animFrame%e===0&&S.push(new Y(this.x+this.w/2,this.y+this.h,"#fff"))}else this.vx*=.85,this.animFrame=0;Math.abs(this.vx)>this.speed&&(this.vx=Math.sign(this.vx)*this.speed)}if(e[" "]&&this.grounded&&!p){this.vy=s,this.grounded=!1,this.stretchX=.7,this.stretchY=1.3,B&&B.play("jump");for(let e=0;e<3;e++)S.push(new Y(this.x+this.w/2+10*(Math.random()-.5),this.y+this.h,"#fff"))}"fly"===this.charData.trait&&e[" "]&&this.stamina>0&&(this.vy-=1.5,this.vy<-7&&(this.vy=-7),this.stamina-=1,this.grounded=!1,m.frame%3==0&&S.push(new W(this.x+this.w/2,this.y+this.h,"#fff",0,2))),this.vy+=l,this.vy>15&&(this.vy=15)}if((p||y)&&m.frame%5==0&&S.push(new W(this.x+(f>0?this.w:0),this.y+this.h,"#fff")),this.shootCooldown>0&&this.shootCooldown--,this.specialCooldown>0&&this.specialCooldown--,(e.z||e.j)&&this.shootCooldown<=0){let t=e.arrowdown||e.s,i=e.arrowup||e.w;this.shoot(!1,t,i),this.shootCooldown=this.charData.trait?15:10}(e.x||e.k)&&this.specialCooldown<=0&&(this.shoot(!0,!1),this.specialCooldown=120),this.x+=this.vx,this.checkCollisions(!0),this.checkEntityCollisions(!0),this.y+=this.vy,this.checkCollisions(!1),this.checkEntityCollisions(!1),this.stretchX+=.1*(1-this.stretchX),this.stretchY+=.1*(1-this.stretchY),this.invincible>0&&this.invincible--,this.y>2600&&this.takeDamage(99)}checkEntityCollisions(e){if(k)for(let t of k)t.solid&&U(this,t)&&(e?this.vx>0?(this.x=t.x-this.w,this.vx=0):this.vx<0&&(this.x=t.x+t.w,this.vx=0):this.vy>0?this.lastY+this.h<=t.y+15&&(this.y=t.y-this.h,this.vy=0,this.grounded=!0,t.vx&&(this.x+=t.vx)):this.vy<0&&(this.y=t.y+t.h,this.vy=0))}checkCollisions(e){if(!g)return;let t=Math.floor(this.x/a),i=Math.floor((this.x+this.w-.01)/a),l=Math.floor(this.y/a),s=Math.floor((this.y+this.h-.01)/a);for(let o=l;o<=s;o++)for(let l=t;l<=i;l++)if(o>=0&&o<h&&l>=0&&l<n&&g[o]&&g[o][l]&&0!==g[o][l].type){let t=g[o][l].type;if(6===t)continue;if(4===t)return void this.takeDamage();if(9===t)return void N();if(5===t){g[o][l].active||(g[o][l].active=!0,m.checkpointsHit++,m.spawnPoint={x:l*a,y:o*a-40},j(l*a+20,o*a+20,"#00ff41",2),this.health<3&&(this.health=3),v&&v.forEach(e=>{e.dead&&(e.dead=!1,e.health=3,e.x=m.spawnPoint.x,e.y=m.spawnPoint.y,e.vx=0,e.vy=0,e.invincible=120,j(e.x,e.y,"#00ff41",2),B&&B.play("powerup"))}),O());continue}if(1===t||2===t||3===t)if(e)this.vx>0?(this.x=l*a-this.w,this.vx=0):this.vx<0&&(this.x=l*a+a,this.vx=0);else if(this.vy>0){if(this.lastY+this.h<=o*a+15){if(this.y=o*a-this.h,this.vy=0,!this.grounded){this.stretchX=1.4,this.stretchY=.6;for(let e=0;e<5;e++)S.push(new Y(this.x+this.w/2+10*(Math.random()-.5),this.y+this.h,"#fff"))}return void(this.grounded=!0)}}else if(this.vy<0)return this.y=o*a+a,void(this.vy=0)}}takeDamage(e=1){if(!(this.invincible>0||this.dead)){if(this.health-=e,Z(15),this.invincible=60,j(this.x,this.y,"red"),B&&B.play("hurt"),this.health<=0)if(v&&v.length>1){this.dead=!0,this.inHamsterBall=!1,this.hamsterBall=null,this.inMech=!1,this.mech=null,this.x=-9999;let e=!0;for(let t of v)if(!t.dead&&t.health>0){e=!1;break}e?m.lives>1?(m.lives--,v.forEach(e=>{e.dead=!1,e.health=3,e.x=m.spawnPoint.x,e.y=m.spawnPoint.y-40,e.vx=0,e.vy=0,e.invincible=120,j(e.x,e.y,"#00ff41",2)}),X(m.spawnPoint.x,m.spawnPoint.y,"GROUP RESPAWN!","#00ff41"),B&&B.play("powerup")):L():X(m.spawnPoint.x,m.spawnPoint.y,"PLAYER DOWN!","red")}else this.respawn();O()}}performSecondary(){this.charData.melee?(k.push(new de(this.x+(this.facing>0?this.w:0),this.y+10,this.facing,!1,this.charData,!1,!0)),this.attackAnim={type:"shoot",timer:10,max:10},B&&B.play("shoot")):(k.push(new fe(this.x+(1===this.facing?0:-40),this.y,40,40,this,1)),S.push(new W(this.x+20*this.facing,this.y+10,"white")),this.attackAnim={type:"kick",timer:15,max:15})}shoot(e,t,i=!1){S.push(new W(this.x+30*this.facing,this.y+10,"yellow")),Z(2);let a=this.x+this.w/2+10*this.facing,l=this.y+15;if("back"===this.charData.mount?(l=this.y+5,a=this.x+this.w/2+5*this.facing):"mouth"===this.charData.mount&&(l=this.y+this.h-10,a=this.x+(1===this.facing?this.w:0)),!e){if(t)return k.push(new de(this.x+this.w/2-5,this.y+this.h,this.facing,e,{pColor:"#fff",pType:"normal"},!0)),void(this.vy=-2);if(i)return void k.push(new de(this.x+this.w/2-5,this.y-20,this.facing,e,{pColor:"#fff",pType:"normal"},!1,!1,!0))}let s=We[this.charData.id];s?e?s.special&&(s.special(this),this.attackAnim={type:"punch",timer:15,max:15}):s.shoot&&(s.shoot(this),this.attackAnim={type:"shoot",timer:10,max:10}):(k.push(new de(a,l,this.facing,e,this.charData)),this.attackAnim={type:"shoot",timer:10,max:10}),e||(this.vx-=2*this.facing)}draw(e,t,i,a){if(this.dead)return;if(this.inHamsterBall)return;if(this.invincible>0&&Math.floor(m.frame/4)%2==0)return;let l=this.x-t+this.w/2,s=this.y-i+this.h/2+this.h*(1-this.stretchY);e.save(),e.translate(l,s),e.scale(this.facing*this.stretchX,this.stretchY),e.fillStyle="rgba(0,0,0,0.5)",e.beginPath(),e.ellipse(0,this.h/2,this.w/1.5,5,0,0,2*Math.PI),e.fill(),e.translate(0,-this.h/2-7),ce(e,this.charData,this.animFrame,this.attackAnim,this.vy),e.restore(),"fly"===this.charData.trait&&(e.fillStyle="black",e.fillRect(l-15,s-60,30,6),e.fillStyle="#00ffff",e.fillRect(l-14,s-59,this.stamina/this.maxStamina*28,4))}}function Ye(){console.log("INIT() CALLED"),I(0),B&&B.stopMusic(),B.initialized,window.addEventListener("resize",Ke),Ke();const e=document.getElementById("soundToggle");if(e){let t=e.cloneNode(!0);e.parentNode.replaceChild(t,e),t.addEventListener("click",e=>{if(e.preventDefault(),e.stopPropagation(),B){const e=B.toggleMute();t.innerText=e?"üîá":"üîä",B.init()}}),B&&(t.innerText=B.muted?"üîá":"üîä")}m.screen="MENU",m.running=!1,m.currentLevel=1,document.getElementById("menuOverlay").style.display="flex",document.getElementById("rosterOverlay").style.display="none",document.getElementById("lobbyOverlay")&&(document.getElementById("lobbyOverlay").style.display="none"),document.getElementById("gameUI").style.display="none",document.getElementById("bossHealthContainer").style.display="none",document.getElementById("gameOverOverlay").style.display="none",document.getElementById("levelCompleteOverlay").style.display="none"}function Ke(){e&&(e.width=window.innerWidth,e.height=window.innerHeight,"MENU"===m.screen&&Ie(),"ROSTER"===m.screen&&Oe())}function ze(){let e=0;for(let t=0;t<4;t++){let i=document.getElementById("lobbyStatus"+(t+1));if(i)if(q[t]){let a="keyboard"===q[t].type?"KEYBOARD":`GAMEPAD ${q[t].index+1}`;i.innerText="READY\n("+a+")",i.style.color="#00ff41",e++}else i.innerText="PRESS A / SPACE",i.style.color="#777"}let t=document.getElementById("lobbyStartBtn");t&&(e>0?(t.style.display="block",document.getElementById("lobbyMessage").innerText=`${e} PLAYER(S) READY`):(t.style.display="none",document.getElementById("lobbyMessage").innerText="WAITING FOR PLAYERS..."))}window.enterLobby=function(){m.screen="LOBBY",document.getElementById("menuOverlay").style.display="none",document.getElementById("lobbyOverlay").style.display="flex";for(let e=0;e<4;e++)q[e]=null;ze()},window.lobbyLoop=function(){if("LOBBY"!==m.screen)return;(E[0][" "]||E[0].enter)&&(q[0]||(q[0]={type:"keyboard"}));const e=navigator.getGamepads?navigator.getGamepads():[];for(let t=0;t<e.length;t++){let i=e[t];if(i&&(i.buttons[0]&&i.buttons[0].pressed||i.buttons[9]&&i.buttons[9].pressed)){if(!q.find(e=>e&&"gamepad"===e.type&&e.index===i.index)){let e=q.findIndex(e=>null===e);-1!==e&&(q[e]={type:"gamepad",index:i.index})}}}ze()},window.startGame=function(){console.log("STARTGAME() CALLED");try{let i=function(){let e=[],t=[],i=[];function l(e,t,l){for(let s=0;s<2*l;s++)i.push(new we(e*a+20*s,t*a))}let s=m.currentLevel,n="forest";s>=3&&(n="city"),s>=5&&(n="volcano"),m.levelData.biome=n,m.levelData.difficulty=s;let o=200;s>=2&&(o=250),s>=3&&(o=300),s>=4&&(o=350),s>=5&&(o=400),m.levelData.width=o;let r=o,c=!1;function d(e,t,l=!1){let n=G();if(l&&!c)return i.push(new Ae(e*a,t*a)),c=!0,void(s>=5?(i.push(new Me((e-1)*a,t*a)),i.push(new Me((e+1)*a,t*a))):s>=3?(i.push(new Me((e-1)*a,t*a)),i.push(new xe((e+1)*a,t*a))):(i.push(new xe((e-1)*a,t*a)),i.push(new xe((e+1)*a,t*a))));s>=5&&n<.25?(i.push(new Me(e*a,t*a)),i.push(new xe((e-1)*a,t*a)),i.push(new xe((e+1)*a,t*a))):s>=7&&n<.35?(i.push(new De(e*a,(t-1)*a)),i.push(new Me((e+2)*a,t*a))):s>=3&&n<.45?(i.push(new Ee(e*a,t*a)),i.push(new Ee((e+1)*a,t*a)),i.push(new Ee((e-1)*a,t*a))):(i.push(new xe(e*a,t*a)),s>=2?(i.push(new xe((e+1)*a,t*a)),G()<.5&&i.push(new xe((e-1)*a,t*a))):G()<.3&&i.push(new xe((e+1)*a,t*a)))}for(let i=0;i<h;i++){const a=new Array(r),l=new Array(r);for(let e=0;e<r;e++)a[e]={type:0},l[e]={type:0};e[i]=a,t[i]=l}let f=35,p=Math.floor(r/6),y=0,u=0,g=-60,b=0,k=[];for(let o=0;o<r;o++){if(s>=20&&o>r-40){if(f=12,o===r-40)for(let t=0;t<15;t++)12-t>0&&(e[12-t][o]={type:2})}else if(o>15){let t=s<=2?.1:.2+.05*s;G()<t&&(f+=G()>.5?-1:1),f<6&&(f=6),f>50&&(f=50);let r=1===s?0:.005+.01*s;if(G()<r&&o>20){for(let t=0;t<h;t++)t>=0&&t<h&&(e[t][o]={type:0});e[59][o]="volcano"===n?{type:4,color:"#e74c3c"}:{type:4,color:"#999"},k[o]=70,G()<.5&&(s>=3&&G()<.2?i.push(new Se(o*a,(f-1)*a,60,"y")):l(o,f-1,1));continue}if(u<8&&o-g>30&&G()<.08){let e=f-1;e>0&&(i.push(new be(o*a,e*a)),u++,g=o,d(o+2,e))}}else f=35;k[o]=f;for(let i=0;i<h;i++)if(i>=f&&(t[i][o]={type:1}),i>=f){let t=1;(o<15||s>=20&&o>r-40||i>=58)&&(t=2),e[i][o]={type:t}}}for(let t=40;t<r-60;t+=40)if(G()<.7&&k[t]<45){let l=k[t],n=55;for(let i=l;i<n;i++)i>=0&&i<h&&(e[i][t]={type:6});let o=Math.floor(3*G())+2;for(let c=0;c<o;c++){let o=l+10+Math.floor(G()*(n-l-15)),c=10+Math.floor(15*G()),d=G()>.5?1:-1;for(let l=0;l<c;l++){let n=t+l*d;for(let t=o;t<o+3;t++)t>=0&&t<h&&n>=0&&n<r&&(e[t][n]={type:0});if(G()<.1&&l>5&&l%5==0){let e=G();s>=3&&e<.3?i.push(new Ee(n*a,(o+2)*a)):i.push(new xe(n*a,(o+2)*a))}if(s>=4&&G()<.05&&l>3&&i.push(new Te(n*a,(o+1)*a,80,"x")),u<8&&(n-g>30||g-n>30)&&G()<.05){let t=o;t>0&&0!==e[t-1][n].type&&(e[t-1][n]={type:1},i.push(new be(n*a,(t+1)*a,t-1,n)),u++,g=n,s>=5?i.push(new De((n+2)*a,(t+1)*a)):i.push(new xe((n+2)*a,(t+1)*a)))}}}}y=0,p=Math.floor(r/6),b=20;for(let t=20;t<r-40;t++){let l=k[t];if(l>=h)continue;let o=y<5;s>=5&&y>=3&&(o=!1),t>=p&&o?(e[l][t]={type:2},e[l-1][t]={type:5,active:!1,id:y},p+=Math.floor(r/(s>=5?4:6)),y++,s>=3&&G()<.3&&i.push(new ue((t+2)*a,(l-3)*a)),G()<.2&&i.push(new me((t+4)*a,(l-3)*a))):G()<.03+.01*s&&0===e[l-1][t].type&&i.push(new pe(t*a,(l-1)*a));let f=30-s;f<12&&(f=12);let u=t>r-60;if(t-b>f||u&&!c){let e=u&&!c?1:.4;G()<e&&(d(t,l-1,u&&!c),b=t)}G()<.02&&s>=3&&i.push(new Fe(t*a,(l-1)*a)),G()<.02&&s>=2&&i.push(new Ce(t*a,(l-5)*a)),l<58&&e[l][t]&&1===e[l][t].type&&G()<.03&&(e[l][t]={type:0},i.push(new ke(t*a,l*a)));let m=-1;for(let i=l-3;i>5;i--)if(e[i]&&e[i][t]&&0===e[i][t].type&&e[i-1]&&e[i-1][t]&&0!==e[i-1][t].type){m=i;break}if(m>0&&G()<.01&&i.push(new ye(t*a,m*a)),l<h){let e="grass";"city"===n&&(e="pipe"),"volcano"===n&&(e="rock"),"pipe"===e?G()<.05&&i.push(new ve(t*a+10,(l-1)*a+10,e)):"rock"===e?G()<.1&&i.push(new ve(t*a+20*G(),l*a-10,e)):G()<.4&&i.push(new ve(t*a+20*G(),l*a-15,e)),"forest"===n&&G()<.1&&m>0&&i.push(new ve(t*a+20*G(),m*a,"vine"))}}for(let t=0;t<h;t++)e[t][0]={type:2},e[t][r-1]={type:2};if(!c){let t=r-25,i=10;k[t]&&(i=k[t]);for(let a=0;a<10;a++)i-a>0&&(e[i-a][t]={type:3});e[i-10][t-1]={type:3},e[i-10][t+1]={type:3},d(t,i-11,!0)}if(s>=10&&s%5==0)if(s>=20)i.push(new Pe((r-20)*a,320)),i.push(new De((r-35)*a,320)),i.push(new De((r-5)*a,320));else{let e=Math.floor(.7*r),t=e+Math.floor(G()*(r-e-5)),l=10;k[t]&&(l=k[t]-5),l>55&&(l=10),"heli"==(s>=14&&s%2==0?"heli":"ground")?i.push(new Re(t*a,(l-10)*a)):i.push(new Pe(t*a,l*a)),d(t-5,l),d(t+5,l)}return D(i),{tiles:e,bgTiles:t}}();e=i.tiles,t=i.bgTiles,g=e,b=t||[],console.log("LEVEL GENERATED. TILES:",g.length),F([]),M([]),A([]),m.checkpointsHit=0,"MENU"!==m.screen&&"LOBBY"!==m.screen||(m.levelCompleteStats.kills=0,m.score=0,m.rescues=0,m.lives=3,m.currentLevel=1),m.bossActive=!1,m.screen="GAME",m.running=!0,P([]),R(null);let l=q.map((e,t)=>({config:e,slot:t})).filter(e=>null!==e.config);0===l.length&&(console.log("No inputs configured, defaulting P1 to Keyboard"),q[0]={type:"keyboard"},l=[{config:{type:"keyboard"},slot:0}]);let s=[],n=l.length,o=Math.min(m.globalUnlocked,u.length),r=[];for(let e=0;e<o;e++)r.push(e);if(r.length<n)for(let e=o;e<u.length&&r.length<n;e++)r.push(e);for(let e=r.length-1;e>0;e--){const t=Math.floor(G()*(e+1));[r[e],r[t]]=[r[t],r[e]]}l.forEach((e,t)=>{let i=new Ve(e.slot),a=r[t%r.length];i.setCharacter(u[a].id),s.push(i)}),P(s),R(v[0]);let c=80,d=80,f=new ge(c,d,!0);k.push(f),v.forEach((e,t)=>{e.x=c+20+10*t,e.y=d+60,e.vy=5,j(e.x,e.y,"#fff",1)}),m.spawnPoint={x:c+20,y:d+60},B&&B.playMusic(),document.getElementById("menuOverlay").style.display="none",document.getElementById("lobbyOverlay")&&(document.getElementById("lobbyOverlay").style.display="none"),document.getElementById("gameUI").style.display="flex",document.getElementById("levelCompleteOverlay").style.display="none",O(),I(0)}catch(e){console.error("Error starting game:",e),m.screen="MENU",document.getElementById("menuOverlay").style.display="flex",document.getElementById("gameUI").style.display="none"}var e,t},window.nextLevel=function(){m.currentLevel++,m.score+=1e3,window.startGame()},window.returnToBase=function(){Ye()},window.resetGame=function(){window.startGame()},window.viewRoster=function(){m.screen="ROSTER",document.getElementById("menuOverlay").style.display="none",document.getElementById("rosterOverlay").style.display="flex"},window.returnToMenu=function(){m.screen="MENU",document.getElementById("rosterOverlay").style.display="none",document.getElementById("menuOverlay").style.display="flex"},window.onerror=function(e,t,i,a,l){console.error("Global Error:",e,"at",i,":",a);const s=document.getElementById("errorOverlay");s&&(s.style.display="block",s.innerHTML+=`<div><strong>Error:</strong> ${e} <br><small>${t}:${i}</small></div><hr>`)},window.addEventListener("keydown",e=>{let t=q.findIndex(e=>e&&"keyboard"===e.type);-1===t?E[0][e.key.toLowerCase()]=!0:E[t][e.key.toLowerCase()]=!0}),window.addEventListener("keyup",e=>{let t=q.findIndex(e=>e&&"keyboard"===e.type);-1!==t?E[t][e.key.toLowerCase()]=!1:E[0][e.key.toLowerCase()]=!1}),function(){const e={btnJump:" ",btnShoot:"z",btnSpecial:"x",btnSecondary:"c",btnFlex:"f"};function t(e,t){E[0][e]!==t&&(E[0][e]=t)}const i=document.getElementById("joystick-area"),a=document.getElementById("joystick-stick");let l=null,s={x:0,y:0};const n=30;if(i&&a){const d=e=>{e.preventDefault();const t=e.changedTouches?e.changedTouches[0]:e;l=t.identifier;const a=i.getBoundingClientRect();s={x:a.left+a.width/2,y:a.top+a.height/2},y(t.clientX,t.clientY)},f=e=>{if(e.preventDefault(),null===l&&!e.changedTouches)return;let t,i;if(e.changedTouches){for(let a=0;a<e.changedTouches.length;a++)if(e.changedTouches[a].identifier===l){t=e.changedTouches[a].clientX,i=e.changedTouches[a].clientY;break}}else t=e.clientX,i=e.clientY;void 0!==t&&y(t,i)},p=e=>{e.preventDefault();let t=!1;if(e.changedTouches){for(let i=0;i<e.changedTouches.length;i++)if(e.changedTouches[i].identifier===l){t=!0;break}}else t=!0;t&&(l=null,u())};function y(e,i){let l=e-s.x,h=i-s.y;if(Math.sqrt(l*l+h*h)>n){let e=Math.atan2(h,l);l=Math.cos(e)*n,h=Math.sin(e)*n}a.style.transform=`translate(calc(-50% + ${l}px), calc(-50% + ${h}px))`;let o=l/n,r=h/n;const c=.3;t("arrowright",o>c),t("arrowleft",o<-c),t("arrowdown",r>c),t("arrowup",r<-c)}function u(){a.style.transform="translate(-50%, -50%)",t("arrowright",!1),t("arrowleft",!1),t("arrowdown",!1),t("arrowup",!1)}i.addEventListener("touchstart",d,{passive:!1}),i.addEventListener("touchmove",f,{passive:!1}),i.addEventListener("touchend",p,{passive:!1}),i.addEventListener("touchcancel",p,{passive:!1}),i.addEventListener("mousedown",d),window.addEventListener("mousemove",e=>{null===l||e.touches||f(e)}),window.addEventListener("mouseup",e=>{null===l||e.touches||p(e)})}function h(i,a){const l=document.getElementById(i);if(!l)return;if("btnSprint"===i)return void(a&&(E[0].shift=!E[0].shift,E[0].shift?l.classList.add("active"):l.classList.remove("active")));const s=e[i];s&&(t(s,a),a?l.classList.add("active"):l.classList.remove("active"))}Object.keys(e).concat(["btnSprint"]).forEach(e=>{const t=document.getElementById(e);if(!t)return;const i=t=>{t.preventDefault(),h(e,!0)},a=t=>{t.preventDefault(),h(e,!1)};t.addEventListener("touchstart",i,{passive:!1}),t.addEventListener("touchend",a,{passive:!1}),t.addEventListener("mousedown",i),t.addEventListener("mouseup",a),t.addEventListener("mouseleave",a)});const o=document.getElementById("controlsToggle"),r=document.getElementById("touchControls");function c(){"none"===r.style.display?o.style.opacity="0.5":o.style.opacity="1"}o&&r&&(o.addEventListener("click",e=>{e.preventDefault(),"none"===r.style.display?(r.style.display="flex",m.zoom=.5):(r.style.display="none",m.zoom=1),c()}),"ontouchstart"in window||navigator.maxTouchPoints>0?(r.style.display="flex",m.zoom=.5):(r.style.display="none",m.zoom=1),c())}(),Ye(),requestAnimationFrame(function l(s){C||I(s);const u=s-C;let x=o/m.slowMo;if(u<x)requestAnimationFrame(l);else{I(s-u%x),function(){const e=navigator.getGamepads?navigator.getGamepads():[];for(let t=0;t<e.length;t++){let i=e[t];if(!i)continue;let a=q.findIndex(e=>e&&"gamepad"===e.type&&e.index===i.index);if(-1===a)continue;let l=E[a],s=_[a];if(!l||!s)continue;const n=(e,t)=>{i.buttons[e]&&i.buttons[e].pressed?(l[t]=!0,s[t]=!0):s[t]&&(l[t]=!1,s[t]=!1)};n(0," "),n(1,"x"),n(2,"z"),n(3,"c"),n(4,"shift"),n(5,"shift"),n(12,"arrowup"),n(13,"arrowdown"),n(14,"arrowleft"),n(15,"arrowright");const h=.5;let o=i.axes[0],r=o<-h;o>h?(l.arrowright=!0,s.stick_x=1):r?(l.arrowleft=!0,s.stick_x=-1):s.stick_x&&(l.arrowright=!1,l.arrowleft=!1,s.stick_x=0);let c=i.axes[1],d=c<-h;c>h?(l.arrowdown=!0,s.stick_y=1):d?(l.arrowup=!0,s.stick_y=-1):s.stick_y&&(l.arrowdown=!1,l.arrowup=!1,s.stick_y=0),n(9,"f")}}();try{i&&(i.textContent=`State: ${m.screen}\nRun: ${m.running}\nLevel: ${m.currentLevel}\nBiome: ${m.levelData.biome}\nEnts: ${k.length}\nFPS: ${Math.round(1e3/u)}`)}catch(e){}try{if("MENU"===m.screen);else if("ROSTER"===m.screen);else if("LOBBY"===m.screen)window.lobbyLoop();else if(m.running){m.hitStop>0?m.hitStop--:(m.frame++,v&&v.forEach(e=>{e.health>0&&e.update()}),D(k.filter(e=>e.hp>0||e.life>0)),k.forEach(e=>e.update()),F(S.filter(e=>e.life>0)),S.forEach(e=>e.update()),M(T.filter(e=>e.life>0)),T.forEach(e=>{e.y+=e.vy,e.life--}),A(w.filter(e=>e.life>0)),w.forEach(e=>e.update()));let t=v.filter(e=>e.health>0);if(t.length>0){let i=0,a=0;t.forEach(e=>{i+=e.x,a+=e.y}),i/=t.length,a/=t.length;let l=m.zoom||1,s=e.width/l,n=e.height/l,h=i-.5*s;h<0&&(h=0),m.cameraX+=.1*(h-m.cameraX);let o=a-.5*n;o<0&&(o=0),m.cameraY+=.1*(o-m.cameraY)}m.shake*=.9}}catch(e){console.error("Game Loop Update Error:",e)}try{"MENU"===m.screen?Ie():"ROSTER"===m.screen?Oe():"LOBBY"!==m.screen&&("GAME"===m.screen||m.running)&&function(){const i=Date.now();let l=(G()-.5)*m.shake,s=(G()-.5)*m.shake,o=(G()-.5)*(.002*m.shake);t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,e.width,e.height),function(e){let t=e.createLinearGradient(0,0,0,e.canvas.height);t.addColorStop(0,"#87CEEB"),t.addColorStop(1,"#E0F7FA"),e.fillStyle=t,e.fillRect(0,0,e.canvas.width,e.canvas.height)}(t,m.cameraX,m.cameraY),t.save(),t.translate(e.width/2,e.height/2),t.rotate(o),t.translate(-e.width/2,-e.height/2);let u=m.zoom||1;t.scale(u,u),t.translate(-m.cameraX+l,-m.cameraY+s);let x=e.width/u,C=e.height/u,E=Math.floor(m.cameraX/a),D=E+x/a+4,F=Math.floor(m.cameraY/a),M=F+C/a+4;for(let e=F;e<M&&e<h;e++)for(let l=E;l<D&&l<n;l++){let s=l*a,n=e*a;if(b&&b[e]&&b[e][l]&&0!==b[e][l].type&&1===b[e][l].type&&(t.fillStyle="#4e342e",t.fillRect(s,n,a,a),t.fillStyle="rgba(0,0,0,0.2)",(e+l)%2==0&&t.fillRect(s+10,n+10,20,20)),g&&g[e]&&g[e][l]&&0!==g[e][l].type){let h=g[e][l];if(6===h.type){t.fillStyle=y,t.fillRect(s+10,n,5,a),t.fillRect(s+25,n,5,a);for(let e=0;e<4;e++)t.fillRect(s+10,n+10*e+2,20,4)}else if(5===h.type)t.fillStyle=h.active?"#00ff41":"#555",t.shadowBlur=20,t.shadowColor=t.fillStyle,t.fillRect(s+15,n+10,5,30),t.beginPath(),t.moveTo(s+20,n+10),t.lineTo(s+35,n+15),t.lineTo(s+20,n+20),t.fill(),t.shadowBlur=0,t.fillStyle="#333",t.fillRect(s+5,n+35,30,5);else if(4===h.type)if("#e74c3c"===h.color)t.fillStyle=h.color,t.fillRect(s,n+10,a,30),t.fillStyle="orange",t.beginPath(),t.arc(s+40*G(),n+10,5,0,2*Math.PI),t.fill();else{let e=t.createLinearGradient(s,n,s,n+a);e.addColorStop(0,"#ccc"),e.addColorStop(1,"#555"),t.fillStyle=e,t.beginPath(),t.moveTo(s,n+a),t.lineTo(s+10,n),t.lineTo(s+20,n+a),t.lineTo(s+30,n),t.lineTo(s+40,n+a),t.fill()}else if(1===h.type){let i=r;"city"===m.levelData.biome&&(i="#333"),"volcano"===m.levelData.biome&&(i="#422"),t.fillStyle=i,t.fillRect(s,n,a,a),t.fillStyle="rgba(0,0,0,0.1)";for(let i=0;i<4;i++){let h=s+(13*l+7*e+5*i)%a,o=n+(23*l+11*e+3*i)%a;t.fillRect(h,o,2,2)}"city"===m.levelData.biome?(t.fillStyle="#444",t.fillRect(s,n+35,40,5)):(t.fillStyle=c,t.fillRect(s+5,n+5,10,10),t.fillRect(s+25,n+20,8,8)),e>0&&0===g[e-1][l].type&&("city"===m.levelData.biome?t.fillStyle="#555":"volcano"===m.levelData.biome?t.fillStyle="#722":t.fillStyle=d,t.fillRect(s,n,a,8))}else if(2===h.type){let e=f;"city"===m.levelData.biome&&(e="#222"),t.fillStyle=e,t.fillRect(s,n,a,a),t.strokeStyle=p,t.lineWidth=2,t.beginPath(),t.moveTo(s,n+20),t.lineTo(s+a,n+20),t.stroke()}else 3===h.type?(t.fillStyle="#34495e",t.fillRect(s,n,a,a),t.fillStyle=(Math.floor(i/1e3)+l+e)%3==0?"yellow":"#2c3e50",t.fillRect(s+10,n+10,8,12),t.fillRect(s+22,n+10,8,12),t.strokeStyle="#2c3e50",t.lineWidth=2,t.strokeRect(s,n,a,a)):9===h.type&&(t.fillStyle="gold",t.shadowBlur=30,t.shadowColor="gold",t.fillRect(s,n,a,a),t.shadowBlur=0,t.fillStyle="#000",t.font="10px Arial",t.fillText("VAN",s+5,n+25))}}w.forEach(e=>e.draw(t,0,0,i)),k.forEach(e=>e.draw(t,0,0,i)),v&&v.forEach(e=>{e.health>0&&e.draw(t,0,0,i)}),S.forEach(e=>e.draw(t,0,0,i)),t.font="900 20px 'Segoe UI'",t.lineWidth=3,T.forEach(e=>{t.fillStyle=e.color,t.strokeStyle="black",t.strokeText(e.text,e.x,e.y),t.fillText(e.text,e.x,e.y)}),t.restore();var A=t.createRadialGradient(e.width/2,e.height/2,200,e.width/2,e.height/2,600);A.addColorStop(0,"transparent"),A.addColorStop(1,"rgba(0,0,0,0.6)"),t.fillStyle=A,t.fillRect(0,0,e.width,e.height)}()}catch(e){console.error("Game Loop Draw Error:",e)}requestAnimationFrame(l)}}),window.state={gameState:m,get players(){return v},get entities(){return k},get particles(){return S}},window.constants={CHARACTERS:u}}();
//# sourceMappingURL=game.bundle.js.map

</script>


</body>
</html>
