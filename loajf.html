<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="manifest" href="manifest.json">
    <title>League of Animal Justice Avenger Force: Operation Dumpster Fire</title>
    <style>
/* --- CSS --- */
body {
    background-color: #0d0d1a;
    color: #00ff41;
    font-family: 'Courier New', monospace;
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    overflow: hidden; /* Prevent scrolling */
    height: 100vh;
}
h1 {
    font-size: 24px;
    margin-bottom: 5px;
    text-shadow: 0 0 10px #00ff41;
    display: none; /* Hide title to save space, maybe overlay it on menu */
}
#gameContainer {
    position: relative;
    width: 100%;
    height: 100%;
    /* Keep aspect ratio? Or fill? "Fit device screen" usually means fill. */
    /* Let's make it fill. */
    border: 0;
    box-shadow: none;
    background: #000;
}
canvas {
    display: block;
    width: 100%;
    height: 100%;
}
.controls {
    position: absolute;
    bottom: 10px;
    width: 100%;
    text-align: center;
    color: #fff;
    font-size: 12px;
    opacity: 0.5;
    pointer-events: none;
    z-index: 20;
}
/* ... existing styles for HUD/Overlays ... */
#gameUI {
    display: none;
    position: absolute;
    top: 15px; left: 20px; right: 20px;
    font-family: 'Courier New', monospace;
    font-size: 16px;
    font-weight: bold;
    pointer-events: none;
    justify-content: space-between;
    flex-wrap: wrap;
    z-index: 5;
}
.stat-box {
    background: rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(4px);
    padding: 8px 15px;
    border: 1px solid rgba(255,255,255,0.2);
    border-radius: 20px;
    margin-bottom: 5px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.3);
    text-shadow: 1px 1px 0 #000;
    color: #fff;
}
#bossHealthContainer {
    display: none;
    position: absolute;
    bottom: 30px; left: 50%;
    transform: translateX(-50%);
    width: 600px; max-width: 90%; /* Responsive width */
    height: 20px;
    border: 2px solid #fff;
    background: #222;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 0 15px rgba(255, 0, 222, 0.5);
    z-index: 5;
}
#bossHealthBar {
    width: 100%; height: 100%;
    background: linear-gradient(90deg, #ff00de, #ff69b4);
    transition: width 0.2s;
}

.overlay-screen {
    display: none;
    position: absolute;
    top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.85);
    backdrop-filter: blur(5px);
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    z-index: 10;
}

#menuOverlay {
    background: rgba(10, 10, 20, 0.95);
    justify-content: center; /* Centered menu */
    padding-bottom: 30px;
    z-index: 15;
    display: none;
}

#rosterOverlay {
    background: rgba(0, 0, 0, 0);
    backdrop-filter: none;
    justify-content: center;
    padding-bottom: 30px;
    z-index: 15;
    display: flex;
}

#levelCompleteOverlay {
    background: rgba(20, 40, 20, 0.95);
    z-index: 20;
    display: none;
}

button {
    background: linear-gradient(45deg, #ff00de, #a020f0);
    border: 2px solid #fff;
    color: white;
    padding: 15px 40px;
    font-size: 20px;
    font-weight: bold;
    cursor: pointer;
    text-transform: uppercase;
    box-shadow: 0 0 15px rgba(255, 0, 222, 0.6);
    border-radius: 5px;
    transition: transform 0.1s, box-shadow 0.1s;
    margin-top: 20px;
    pointer-events: auto;
}
button:hover { transform: scale(1.05); box-shadow: 0 0 25px rgba(255, 0, 222, 0.8); }

#errorOverlay {
    display: none;
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(50, 0, 0, 0.9);
    color: #ffcccc;
    font-family: monospace;
    padding: 20px;
    box-sizing: border-box;
    white-space: pre-wrap;
    overflow: auto;
    z-index: 9999;
}
#debugHUD {
    position: absolute;
    top: 5px; right: 5px;
    color: lime;
    font-size: 10px;
    background: rgba(0,0,0,0.5);
    padding: 2px;
    pointer-events: none;
    display: none; /* Hide unless needed */
}

/* --- TOUCH CONTROLS --- */
.touch-toggle {
    position: absolute;
    top: 10px;
    right: 10px;
    z-index: 100;
    background: rgba(0, 0, 0, 0.5);
    color: white;
    border: 1px solid white;
    border-radius: 5px;
    padding: 10px;
    font-size: 24px;
    cursor: pointer;
    opacity: 0.7;
    margin-top: 0; /* Override generic button */
    box-shadow: none;
}

.touch-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none; /* Let clicks pass through empty space */
    z-index: 90;
    display: flex;
    justify-content: space-between;
    align-items: flex-end;
    padding: 20px;
    box-sizing: border-box;
}

.touch-btn {
    pointer-events: auto; /* Enable clicks on buttons */
    background: rgba(255, 255, 255, 0.15);
    border: 2px solid rgba(255, 255, 255, 0.5);
    color: white;
    border-radius: 50%;
    width: 60px;
    height: 60px;
    font-size: 20px;
    font-weight: bold;
    user-select: none;
    touch-action: manipulation;
    display: flex;
    justify-content: center;
    align-items: center;
    margin: 5px;
    padding: 0; /* Reset */
    backdrop-filter: blur(2px);
    transition: transform 0.1s, background 0.1s;
    box-shadow: none; /* Reset */
    text-shadow: 1px 1px 0 #000;
}

.touch-btn:active, .touch-btn.active {
    background: rgba(255, 255, 255, 0.4);
    transform: scale(0.95);
}

.touch-btn.toggle-btn.active {
    background: rgba(0, 255, 65, 0.5);
    border-color: #00ff41;
}

/* D-PAD */
.dpad-area {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-bottom: 20px;
    margin-left: 20px;
}
.dpad-row {
    display: flex;
}
.dpad-spacer {
    width: 60px;
    height: 60px;
    margin: 5px;
}

/* ACTIONS */
.action-area {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    margin-bottom: 20px;
    margin-right: 20px;
}

.action-group-main {
    display: flex;
    justify-content: flex-end;
    margin-bottom: 10px;
}
.action-group-sub {
    display: flex;
    justify-content: flex-end;
    flex-wrap: wrap;
    max-width: 280px; /* Force wrap if needed */
}

.action-btn.large {
    width: 80px;
    height: 80px;
    font-size: 24px;
    background: rgba(255, 0, 222, 0.2);
    border-color: rgba(255, 0, 222, 0.5);
}

/* Landscape adjustments for mobile */
@media (max-height: 500px) {
    .touch-btn {
        width: 50px;
        height: 50px;
        font-size: 16px;
    }
    .touch-btn.large {
        width: 70px;
        height: 70px;
    }
    .dpad-spacer {
        width: 50px;
        height: 50px;
    }
    .action-area {
        margin-right: 50px; /* Give thumb space */
    }
    .dpad-area {
        margin-left: 50px;
    }
}

</style>
</head>
<body>

    <div id="gameContainer">
        <!-- Canvas size will be set by JS -->
        <canvas id="gameCanvas"></canvas>
        <div id="errorOverlay"></div>
        <div id="debugHUD">Initializing...</div>

        <!-- HUD -->
        <div id="gameUI">
            <div class="stat-box">HERO: <span id="charName" style="color:#00ff41">IRON MUTT</span></div>
            <div class="stat-box">HP: <span id="healthDisplay" style="color:#ff00de">‚ù§‚ù§‚ù§</span></div>
            <div class="stat-box">LIVES: <span id="livesDisplay" style="color:yellow">3</span></div>
            <div class="stat-box">RESCUES: <span id="rescueDisplay">0</span></div>
            <div class="stat-box">SCORE: <span id="scoreDisplay">0</span></div>
            <div class="stat-box">LEVEL: <span id="levelDisplay">1</span></div>
        </div>

        <div id="bossHealthContainer">
            <div id="bossHealthBar"></div>
        </div>

        <!-- MAIN MENU -->
        <div id="menuOverlay" class="overlay-screen">
             <!-- Title in Menu -->
             <h1 style="font-size: 32px; color: #00ff41; margin-bottom: 40px; text-align: center; max-width: 80%;">
                LEAGUE OF ANIMAL JUSTICE<br>AVENGER FORCE
            </h1>
            <button onclick="window.enterLobby()">DEPLOY SQUAD</button>
            <button onclick="window.viewRoster()">VIEW TEAM</button>
        </div>

        <!-- ROSTER MENU -->
        <div id="rosterOverlay" class="overlay-screen">
            <button onclick="window.returnToMenu()" style="position: absolute; bottom: 30px;">BACK</button>
        </div>

        <!-- LOBBY MENU -->
        <div id="lobbyOverlay" class="overlay-screen" style="display: none;">
            <h2 style="color: #00ff41; margin-bottom: 20px;">SQUAD SETUP</h2>
            <div style="display: flex; gap: 20px; margin-bottom: 20px;">
                <div class="stat-box" style="width: 150px; height: 100px; display: flex; flex-direction: column; justify-content: center;">
                    <div>PLAYER 1</div>
                    <div id="lobbyStatus1" style="color: #777; margin-top: 10px;">PRESS A / SPACE</div>
                </div>
                <div class="stat-box" style="width: 150px; height: 100px; display: flex; flex-direction: column; justify-content: center;">
                    <div>PLAYER 2</div>
                    <div id="lobbyStatus2" style="color: #777; margin-top: 10px;">PRESS A</div>
                </div>
                <div class="stat-box" style="width: 150px; height: 100px; display: flex; flex-direction: column; justify-content: center;">
                    <div>PLAYER 3</div>
                    <div id="lobbyStatus3" style="color: #777; margin-top: 10px;">PRESS A</div>
                </div>
                <div class="stat-box" style="width: 150px; height: 100px; display: flex; flex-direction: column; justify-content: center;">
                    <div>PLAYER 4</div>
                    <div id="lobbyStatus4" style="color: #777; margin-top: 10px;">PRESS A</div>
                </div>
            </div>
            <p id="lobbyMessage" style="color: #aaa; margin-bottom: 20px;">WAITING FOR PLAYERS...</p>
            <button id="lobbyStartBtn" onclick="window.startGame()" style="display: none;">START MISSION</button>
        </div>

        <!-- LEVEL COMPLETE -->
        <div id="levelCompleteOverlay" class="overlay-screen">
            <h2 style="color: gold; font-size: 40px; margin-bottom: 20px;">AREA SECURED</h2>
            <div style="font-size: 20px; color: #fff; line-height: 1.6;">
                <p>KILLS: <span id="lcKills" style="color: red">0</span></p>
                <p>RESCUES: <span id="lcRescues" style="color: #00ff41">0</span></p>
                <p>TIME BONUS: <span id="lcTime" style="color: yellow">0</span></p>
            </div>
            <button onclick="window.nextLevel()">NEXT MISSION</button>
        </div>

        <!-- GAME OVER / WIN -->
        <div id="gameOverOverlay" class="overlay-screen">
            <h2 id="ovTitle" style="font-size: 50px; color: #00ff41; margin-bottom: 10px;">MISSION FAILED</h2>
            <p id="ovMsg" style="margin-bottom: 30px; font-size: 20px;">The HOA has won.</p>
            <button onclick="window.returnToBase()">RETURN TO BASE</button>
        </div>

        <div class="controls">
            ARROWS/WASD: Move | SPACE: Jump | SHIFT: Sprint | Z: Shoot | X: Special | C: 2nd Attack | DOWN+Z: Down Attack | F: Flex
        </div>

        <!-- Touch Controls -->
        <button id="controlsToggle" class="touch-toggle">üéÆ</button>
        <button id="soundToggle" class="touch-toggle" style="right: 70px;">üîä</button>

        <div id="touchControls" class="touch-overlay" style="display: none;">
            <div class="dpad-area">
                <div class="dpad-row">
                    <button id="btnUp" class="touch-btn dpad-btn">‚ñ≤</button>
                </div>
                <div class="dpad-row">
                    <button id="btnLeft" class="touch-btn dpad-btn">‚óÄ</button>
                    <div class="dpad-spacer"></div>
                    <button id="btnRight" class="touch-btn dpad-btn">‚ñ∂</button>
                </div>
                <div class="dpad-row">
                    <button id="btnDown" class="touch-btn dpad-btn">‚ñº</button>
                </div>
            </div>

            <div class="action-area">
                <div class="action-group-main">
                    <button id="btnShoot" class="touch-btn action-btn large">Z</button>
                    <button id="btnJump" class="touch-btn action-btn large">SPACE</button>
                </div>
                <div class="action-group-sub">
                    <button id="btnSpecial" class="touch-btn action-btn">X</button>
                    <button id="btnSecondary" class="touch-btn action-btn">C</button>
                    <button id="btnFlex" class="touch-btn action-btn">F</button>
                    <button id="btnSprint" class="touch-btn action-btn toggle-btn">RUN</button>
                </div>
            </div>
        </div>
    </div>


<script>
!function(){"use strict";const e=document.getElementById("gameCanvas"),t=e.getContext("2d"),i=document.getElementById("debugHUD"),a=40,l=.6,s=400,h=60,o=1e3/60,n="#5d4037",r="#8d6e63",c="#4caf50",p="#546e7a",y="#78909c",d="#1e3c72",f="#2a5298",g="#d35400",m=[{id:"pug",name:"IRON MUTT",type:"dog_flat",cSkin:"#f3cf98",cDark:"#3b302a",cSuit:"#b0c4de",pType:"laser",pColor:"#a020f0"},{id:"raccoon",name:"CPT TRASH",type:"raccoon",cSkin:"#888",cDark:"#444",cSuit:"#555",pType:"boomerang",pColor:"#aaa"},{id:"cat",name:"BAT CAT",type:"cat",cSkin:"#222",cDark:"#000",cSuit:"#111",pType:"boomerang",pColor:"#ff69b4"},{id:"corgi",name:"THOR-GI",type:"dog_pointy",cSkin:"#E3C099",cDark:"#FFF",cSuit:"#333",pType:"boomerang",pColor:"#00FFFF"},{id:"hulk",name:"HULK-POODLE",type:"poodle",cSkin:"#00FF00",cDark:"#006400",cSuit:"#800080",pType:"melee_smash",pColor:"#00FF00"},{id:"spider",name:"SPIDER-PIG",type:"pig",cSkin:"#FFC0CB",cDark:"#FF69B4",cSuit:"#FF0000",pType:"gun",pColor:"#FFF"},{id:"wolvie",name:"WOLVER-WEENIE",type:"dog_long",cSkin:"#8B4513",cDark:"#000",cSuit:"#FFFF00",pType:"melee_slash",pColor:"#C0C0C0"},{id:"dead",name:"DEAD-POODLE",type:"poodle",cSkin:"#FF0000",cDark:"#000",cSuit:"#333",pType:"gun",pColor:"#FF0000"},{id:"cap",name:"CAPTAIN EAGLE",type:"bird",cSkin:"#FFF",cDark:"#A52A2A",cSuit:"#0000FF",pType:"boomerang",pColor:"#FFF"},{id:"ironmouse",name:"IRON-MOUSE",type:"rodent",cSkin:"#808080",cDark:"#404040",cSuit:"#FF0000",pType:"laser",pColor:"#FFFF00"},{id:"widow",name:"BLACK WIDOW-PUG",type:"dog_flat",cSkin:"#000",cDark:"#111",cSuit:"#222",pType:"gun",pColor:"#00FFFF"},{id:"hawkeye",name:"HAWK-HEDGEHOG",type:"hedgehog",cSkin:"#D2B48C",cDark:"#8B4513",cSuit:"#800080",pType:"grenade",pColor:"#DDD"},{id:"strange",name:"DR STRANGE-CAT",type:"cat",cSkin:"#444",cDark:"#222",cSuit:"#0000FF",pType:"magic",pColor:"#FFA500"},{id:"panther",name:"BLACK PANTHER",type:"cat",cSkin:"#111",cDark:"#000",cSuit:"#222",pType:"melee_slash",pColor:"#800080"},{id:"ant",name:"ANT-EATER-MAN",type:"anteater",cSkin:"#808080",cDark:"#404040",cSuit:"#FF0000",pType:"melee_smash",pColor:"#FF0000"},{id:"starlord",name:"STAR-LORD-FOX",type:"fox",cSkin:"#FF8C00",cDark:"#8B0000",cSuit:"#8B4513",pType:"laser",pColor:"#FFFF00"},{id:"gamora",name:"GAMORA-GECKO",type:"lizard",cSkin:"#00FF00",cDark:"#006400",cSuit:"#000",pType:"melee_slash",pColor:"#00FF00"},{id:"drax",name:"DRAX-BULLDOG",type:"dog_flat",cSkin:"#008000",cDark:"#FF0000",cSuit:"#000080",pType:"melee_slash",pColor:"#CCC"},{id:"groot",name:"GROOT-BARK",type:"tree",cSkin:"#8B4513",cDark:"#A0522D",cSuit:"#654321",pType:"melee_smash",pColor:"#8B4513"},{id:"rocket",name:"ROCKET-RABBIT",type:"rabbit",cSkin:"#A9A9A9",cDark:"#696969",cSuit:"#FF4500",pType:"grenade",pColor:"#FF4500"},{id:"vision",name:"VISION-ZEBRA",type:"horse",cSkin:"#FFC0CB",cDark:"#008000",cSuit:"#FFFF00",pType:"laser",pColor:"#FFFF00"},{id:"scarlet",name:"SCARLET-SKUNK",type:"skunk",cSkin:"#000",cDark:"#FFF",cSuit:"#FF0000",pType:"magic",pColor:"#FF0000"},{id:"quick",name:"QUICK-CHEETAH",type:"cat",cSkin:"#D3D3D3",cDark:"#A9A9A9",cSuit:"#87CEEB",pType:"melee_slash",pColor:"#87CEEB"},{id:"winter",name:"WINTER-WOLF",type:"dog_pointy",cSkin:"#FFF",cDark:"#808080",cSuit:"#000",pType:"gun",pColor:"#C0C0C0"},{id:"falcon",name:"FALCON-PIGEON",type:"bird",cSkin:"#808080",cDark:"#696969",cSuit:"#FF0000",pType:"gun",pColor:"#CCC"},{id:"war",name:"WAR-RHINO",type:"rhino",cSkin:"#708090",cDark:"#2F4F4F",cSuit:"#000",pType:"grenade",pColor:"#999"},{id:"dare",name:"DAREDEVIL-DOG",type:"dog_pointy",cSkin:"#B22222",cDark:"#800000",cSuit:"#FF0000",pType:"melee_slash",pColor:"#FF0000"},{id:"punish",name:"PUNISHER-PENGUIN",type:"bird",cSkin:"#000",cDark:"#FFF",cSuit:"#000",pType:"spread",pColor:"#FFF"},{id:"shang",name:"SHANG-CHI-PANDA",type:"bear",cSkin:"#000",cDark:"#FFF",cSuit:"#FF0000",pType:"melee_smash",pColor:"#FFD700"},{id:"eternal",name:"ETERNAL-ELEPHANT",type:"elephant",cSkin:"#808080",cDark:"#696969",cSuit:"#FFD700",pType:"magic",pColor:"#FFD700"},{id:"moon",name:"MOON-OWL",type:"bird",cSkin:"#FFF",cDark:"#EEE",cSuit:"#DDD",pType:"boomerang",pColor:"#FFF"},{id:"shehulk",name:"SHE-HULK-HAMSTER",type:"rodent",cSkin:"#32CD32",cDark:"#006400",cSuit:"#800080",pType:"melee_smash",pColor:"#00FF00"},{id:"ghost",name:"GHOST-GOAT",type:"goat",cSkin:"#FFF",cDark:"#FF4500",cSuit:"#000",pType:"melee_slash",pColor:"#FF4500"},{id:"unicorncyborg",name:"UNICORN-CYBORG",type:"robot",cSkin:"#6495ED",cDark:"#FFEBCD",cSuit:"#2E8B57",pType:"lightning",pColor:"#FFE4C4"},{id:"creaturehedgehog",name:"CREATURE-HEDGEHOG",type:"hedgehog",cSkin:"#00FF00",cDark:"#DAA520",cSuit:"#008B8B",pType:"melee_smash",pColor:"#40E0D0"},{id:"storestump",name:"STORE-STUMP",type:"tree",cSkin:"#006400",cDark:"#6495ED",cSuit:"#000000",pType:"boomerang",pColor:"#FFDEAD"},{id:"galaxygod",name:"GALAXY-GOD",type:"human",cSkin:"#F0F8FF",cDark:"#BDB76B",cSuit:"#DAA520",pType:"shuriken",pColor:"#FAF0E6"},{id:"wraithhouse",name:"WRAITH-HOUSE",type:"stone",cSkin:"#800000",cDark:"#98FB98",cSuit:"#000080",pType:"acid_spit",pColor:"#5F9EA0"},{id:"ninjakangaroo",name:"NINJA-KANGAROO",type:"rabbit",cSkin:"#DCDCDC",cDark:"#F0FFF0",cSuit:"#8FBC8F",pType:"card_throw",pColor:"#808080"},{id:"devilcastle",name:"DEVIL-CASTLE",type:"stone",cSkin:"#48D1CC",cDark:"#008000",cSuit:"#0000FF",pType:"water_gun",pColor:"#7CFC00"},{id:"aquaalpaca",name:"AQUA-ALPACA",type:"horse",cSkin:"#FFE4E1",cDark:"#FFDEAD",cSuit:"#F5DEB3",pType:"rocket",pColor:"#FAFAD2"},{id:"makeupgate",name:"MAKEUP-GATE",type:"stone",cSkin:"#FFDEAD",cDark:"#F0F8FF",cSuit:"#D2B48C",pType:"fireball",pColor:"#008000"},{id:"alienboulder",name:"ALIEN-BOULDER",type:"stone",cSkin:"#808080",cDark:"#FAEBD7",cSuit:"#006400",pType:"ice_beam",pColor:"#00BFFF"},{id:"skeletonram",name:"SKELETON-RAM",type:"goat",cSkin:"#006400",cDark:"#800080",cSuit:"#00FA9A",pType:"gun",pColor:"#B0C4DE"},{id:"aquariumforest",name:"AQUARIUM-FOREST",type:"tree",cSkin:"#FFFAFA",cDark:"#1E90FF",cSuit:"#556B2F",pType:"laser",pColor:"#F5F5DC"},{id:"darklog",name:"DARK-LOG",type:"tree",cSkin:"#F0E68C",cDark:"#00FFFF",cSuit:"#00CED1",pType:"water_gun",pColor:"#FFFFFF"},{id:"factoryskeleton",name:"FACTORY-SKELETON",type:"skeleton",cSkin:"#FDF5E6",cDark:"#FFFACD",cSuit:"#556B2F",pType:"acid_spit",pColor:"#F5F5F5"},{id:"defenderroof",name:"DEFENDER-ROOF",type:"stone",cSkin:"#A52A2A",cDark:"#0000FF",cSuit:"#000000",pType:"boomerang",pColor:"#D2691E"},{id:"robbereagle",name:"ROBBER-EAGLE",type:"bird",cSkin:"#F8F8FF",cDark:"#4682B4",cSuit:"#3CB371",pType:"lightning",pColor:"#20B2AA"},{id:"professorskunk",name:"PROFESSOR-SKUNK",type:"skunk",cSkin:"#F4A460",cDark:"#800000",cSuit:"#2F4F4F",pType:"rocket",pColor:"#800000"},{id:"earthbuffalo",name:"EARTH-BUFFALO",type:"cow",cSkin:"#7FFF00",cDark:"#4169E1",cSuit:"#FFFF00",pType:"fireball",pColor:"#00FFFF"},{id:"ogreguinea",name:"OGRE-GUINEA",type:"rodent",cSkin:"#FFE4C4",cDark:"#708090",cSuit:"#2F4F4F",pType:"gun",pColor:"#00CED1"},{id:"artistalien",name:"ARTIST-ALIEN",type:"alien",cSkin:"#FFEBCD",cDark:"#ADFF2F",cSuit:"#0000CD",pType:"ice_beam",pColor:"#F5F5F5"},{id:"firedonkey",name:"FIRE-DONKEY",type:"horse",cSkin:"#191970",cDark:"#800000",cSuit:"#2F4F4F",pType:"water_gun",pColor:"#EEE8AA"},{id:"fighterhawk",name:"FIGHTER-HAWK",type:"bird",cSkin:"#F8F8FF",cDark:"#006400",cSuit:"#F0E68C",pType:"gun",pColor:"#F0FFFF"},{id:"trollpeacock",name:"TROLL-PEACOCK",type:"bird",cSkin:"#8FBC8F",cDark:"#40E0D0",cSuit:"#00FF7F",pType:"gun",pColor:"#FFF5EE"},{id:"detectivemonkey",name:"DETECTIVE-MONKEY",type:"monkey",cSkin:"#000080",cDark:"#F5F5F5",cSuit:"#F0FFFF",pType:"laser",pColor:"#FAEBD7"},{id:"homelizard",name:"HOME-LIZARD",type:"lizard",cSkin:"#808000",cDark:"#CD853F",cSuit:"#BC8F8F",pType:"melee_slash",pColor:"#FFF8DC"},{id:"headsmanshark",name:"HEADSMAN-SHARK",type:"fish",cSkin:"#4682B4",cDark:"#00FF7F",cSuit:"#FFE4C4",pType:"melee_slash",pColor:"#D3D3D3"},{id:"caferaven",name:"CAFE-RAVEN",type:"bird",cSkin:"#008B8B",cDark:"#90EE90",cSuit:"#90EE90",pType:"rocket",pColor:"#FFA500"},{id:"phoenixdemon",name:"PHOENIX-DEMON",type:"goat",cSkin:"#EEE8AA",cDark:"#7FFF00",cSuit:"#6B8E23",pType:"grenade",pColor:"#FFE4C4"},{id:"alienlion",name:"ALIEN-LION",type:"cat",cSkin:"#87CEFA",cDark:"#008B8B",cSuit:"#708090",pType:"melee_slash",pColor:"#00FF00"},{id:"paintervillain",name:"PAINTER-VILLAIN",type:"human",cSkin:"#F0E68C",cDark:"#3CB371",cSuit:"#66CDAA",pType:"laser",pColor:"#F0F8FF"},{id:"mageslime",name:"MAGE-SLIME",type:"alien",cSkin:"#00FA9A",cDark:"#BDB76B",cSuit:"#8FBC8F",pType:"melee_smash",pColor:"#008080"},{id:"journalistceiling",name:"JOURNALIST-CEILING",type:"stone",cSkin:"#FFDAB9",cDark:"#A0522D",cSuit:"#228B22",pType:"melee_slash",pColor:"#800000"},{id:"bakerhamster",name:"BAKER-HAMSTER",type:"rodent",cSkin:"#808000",cDark:"#00FFFF",cSuit:"#2E8B57",pType:"fireball",pColor:"#87CEEB"},{id:"zombiefish",name:"ZOMBIE-FISH",type:"fish",cSkin:"#F0F8FF",cDark:"#D2691E",cSuit:"#008000",pType:"ice_beam",pColor:"#F0FFFF"},{id:"chefdeer",name:"CHEF-DEER",type:"goat",cSkin:"#800000",cDark:"#EEE8AA",cSuit:"#FFE4C4",pType:"rocket",pColor:"#000080"},{id:"resortstone",name:"RESORT-STONE",type:"stone",cSkin:"#808080",cDark:"#FAFAD2",cSuit:"#8FBC8F",pType:"boomerang",pColor:"#00FF7F"},{id:"hospitalchipmunk",name:"HOSPITAL-CHIPMUNK",type:"rodent",cSkin:"#FFEFD5",cDark:"#FFFACD",cSuit:"#008B8B",pType:"card_throw",pColor:"#5F9EA0"},{id:"mutantkoala",name:"MUTANT-KOALA",type:"bear",cSkin:"#4682B4",cDark:"#DCDCDC",cSuit:"#008000",pType:"laser",pColor:"#696969"},{id:"directordirt",name:"DIRECTOR-DIRT",type:"stone",cSkin:"#00FA9A",cDark:"#F5FFFA",cSuit:"#FFFAFA",pType:"spread",pColor:"#008080"},{id:"spectrebison",name:"SPECTRE-BISON",type:"cow",cSkin:"#FFF0F5",cDark:"#FFFFF0",cSuit:"#9ACD32",pType:"card_throw",pColor:"#FFDEAD"},{id:"convictchicken",name:"CONVICT-CHICKEN",type:"duck",cSkin:"#D2691E",cDark:"#FFEBCD",cSuit:"#808080",pType:"grenade",pColor:"#FFFF00"},{id:"innmud",name:"INN-MUD",type:"stone",cSkin:"#FAF0E6",cDark:"#008080",cSuit:"#C0C0C0",pType:"card_throw",pColor:"#9ACD32"},{id:"killerdonkey",name:"KILLER-DONKEY",type:"horse",cSkin:"#7FFF00",cDark:"#F0FFFF",cSuit:"#FFFACD",pType:"grenade",pColor:"#708090"},{id:"professorkangaroo",name:"PROFESSOR-KANGAROO",type:"rabbit",cSkin:"#FFE4C4",cDark:"#C0C0C0",cSuit:"#000000",pType:"spread",pColor:"#40E0D0"},{id:"paramedicpeacock",name:"PARAMEDIC-PEACOCK",type:"bird",cSkin:"#00FF00",cDark:"#FFF0F5",cSuit:"#0000FF",pType:"laser",pColor:"#FDF5E6"},{id:"restaurantwolf",name:"RESTAURANT-WOLF",type:"wolf",cSkin:"#191970",cDark:"#FFE4C4",cSuit:"#B8860B",pType:"ice_beam",pColor:"#E6E6FA"},{id:"knightsheep",name:"KNIGHT-SHEEP",type:"goat",cSkin:"#D2691E",cDark:"#B8860B",cSuit:"#F0FFF0",pType:"acid_spit",pColor:"#000080"},{id:"ranchwombat",name:"RANCH-WOMBAT",type:"rodent",cSkin:"#708090",cDark:"#D3D3D3",cSuit:"#000080",pType:"melee_slash",pColor:"#FFE4C4"},{id:"murdererforest",name:"MURDERER-FOREST",type:"tree",cSkin:"#006400",cDark:"#F8F8FF",cSuit:"#4682B4",pType:"spread",pColor:"#008B8B"},{id:"nightllama",name:"NIGHT-LLAMA",type:"horse",cSkin:"#808000",cDark:"#008000",cSuit:"#FFFF00",pType:"melee_smash",pColor:"#FFFF00"},{id:"musicianturkey",name:"MUSICIAN-TURKEY",type:"duck",cSkin:"#228B22",cDark:"#DEB887",cSuit:"#FFFAF0",pType:"spread",pColor:"#FF0000"},{id:"oozecrow",name:"OOZE-CROW",type:"bird",cSkin:"#ADD8E6",cDark:"#228B22",cSuit:"#778899",pType:"lightning",pColor:"#9ACD32"},{id:"lordblob",name:"LORD-BLOB",type:"alien",cSkin:"#008B8B",cDark:"#F8F8FF",cSuit:"#F0E68C",pType:"water_gun",pColor:"#800080"},{id:"shadowpanda",name:"SHADOW-PANDA",type:"bear",cSkin:"#6495ED",cDark:"#008080",cSuit:"#808080",pType:"melee_smash",pColor:"#F0F8FF"},{id:"spyboulder",name:"SPY-BOULDER",type:"stone",cSkin:"#7FFFD4",cDark:"#ADD8E6",cSuit:"#E6E6FA",pType:"card_throw",pColor:"#98FB98"},{id:"stylistearth",name:"STYLIST-EARTH",type:"stone",cSkin:"#006400",cDark:"#F0E68C",cSuit:"#00CED1",pType:"card_throw",pColor:"#90EE90"},{id:"sparock",name:"SPA-ROCK",type:"stone",cSkin:"#000000",cDark:"#DEB887",cSuit:"#000080",pType:"lightning",pColor:"#0000FF"},{id:"farmpig",name:"FARM-PIG",type:"pig",cSkin:"#696969",cDark:"#696969",cSuit:"#FFF5EE",pType:"lightning",pColor:"#00FFFF"},{id:"guardbrick",name:"GUARD-BRICK",type:"stone",cSkin:"#66CDAA",cDark:"#C0C0C0",cSuit:"#40E0D0",pType:"shuriken",pColor:"#008B8B"},{id:"sunpegasus",name:"SUN-PEGASUS",type:"horse",cSkin:"#BDB76B",cDark:"#FFFAFA",cSuit:"#008000",pType:"lightning",pColor:"#0000CD"},{id:"shopstone",name:"SHOP-STONE",type:"stone",cSkin:"#F0FFFF",cDark:"#A0522D",cSuit:"#FFEFD5",pType:"fireball",pColor:"#E6E6FA"},{id:"princemonster",name:"PRINCE-MONSTER",type:"alien",cSkin:"#000080",cDark:"#808000",cSuit:"#FFDEAD",pType:"gun",pColor:"#FFDEAD"},{id:"directorreindeer",name:"DIRECTOR-REINDEER",type:"goat",cSkin:"#8FBC8F",cDark:"#A52A2A",cSuit:"#00FA9A",pType:"gun",pColor:"#B0C4DE"},{id:"policecroc",name:"POLICE-CROC",type:"croc",cSkin:"#228B22",cDark:"#006400",cSuit:"#A52A2A",pType:"shuriken",pColor:"#A0522D"},{id:"composerfrog",name:"COMPOSER-FROG",type:"frog",cSkin:"#32CD32",cDark:"#006400",cSuit:"#9ACD32",pType:"boomerang",pColor:"#FFDEAD"},{id:"nunturtle",name:"NUN-TURTLE",type:"turtle",cSkin:"#2E8B57",cDark:"#006400",cSuit:"#FFFAFA",pType:"melee_slash",pColor:"#FFE4E1"},{id:"homepumpkin",name:"HOME-PUMPKIN",type:"pumpkin",cSkin:"#FFA500",cDark:"#006400",cSuit:"#D3D3D3",pType:"ice_beam",pColor:"#ADFF2F"}],u={screen:"MENU",running:!1,score:0,cameraX:0,cameraY:0,shake:0,frame:0,checkpointsHit:0,rescues:0,lives:3,unlockedCount:1,globalUnlocked:1,spawnPoint:{x:100,y:0},bossActive:!1,hitStop:0,zoom:1,currentLevel:1,levelData:{biome:"forest",difficulty:1,width:400,height:60},slowMo:1,levelCompleteStats:{kills:0,rescues:0,time:0}};let v=[],x=[],w=[],S=[],k=[],F=[],b=null,T=0,E=[{},{},{},{}];function C(e){x=e}function M(e){w=e}function D(e){S=e}function A(e){k=e}function P(e){F=e}function I(e){b=e}function R(e){T=e}function B(){let e=F&&F[0];if(!e)return;let t="‚ù§".repeat(Math.max(0,e.health));if(F.length>1){t+=" | ";for(let e=1;e<F.length;e++)t+="P"+(e+1)+":"+"‚ù§".repeat(Math.max(0,F[e].health))+" "}document.getElementById("healthDisplay").innerText=t,document.getElementById("scoreDisplay").innerText=u.score,document.getElementById("rescueDisplay").innerText=u.rescues,document.getElementById("livesDisplay").innerText=u.lives,document.getElementById("levelDisplay").innerText=u.currentLevel;let i=e.charData?e.charData.name:"UNKNOWN";F.length>1&&(i+=" + TEAM"),document.getElementById("charName").innerText=i,e.charData&&(document.getElementById("charName").style.color=e.charData.cSkin)}function O(){u.running=!1,u.levelCompleteStats.kills=0;let e=Math.floor((u.score-500*u.rescues)/100);e<0&&(e=0),document.getElementById("lcKills").innerText=e,document.getElementById("lcRescues").innerText=u.rescues,document.getElementById("lcTime").innerText=Math.floor((1e4-u.frame)/60),document.getElementById("levelCompleteOverlay").style.display="flex"}const L=new class{constructor(){this.ctx=null,this.masterGain=null,this.muted=!1,this.volume=.3,this.initialized=!1}init(){if(!this.initialized)try{const e=window.AudioContext||window.webkitAudioContext;this.ctx=new e,this.masterGain=this.ctx.createGain(),this.masterGain.connect(this.ctx.destination),this.masterGain.gain.setValueAtTime(this.muted?0:this.volume,this.ctx.currentTime),this.initialized=!0,console.log("Audio Context Initialized")}catch(e){console.error("Web Audio API not supported",e)}}toggleMute(){return this.muted=!this.muted,this.masterGain&&this.ctx&&this.masterGain.gain.setValueAtTime(this.muted?0:this.volume,this.ctx.currentTime),this.muted}play(e){if(this.initialized||this.init(),this.muted||!this.ctx)return;"suspended"===this.ctx.state&&this.ctx.resume().catch(e=>console.error(e));const t=this.ctx.currentTime,i=this.ctx.createOscillator(),a=this.ctx.createGain();switch(i.connect(a),a.connect(this.masterGain),e){case"jump":i.type="square",i.frequency.setValueAtTime(150,t),i.frequency.exponentialRampToValueAtTime(600,t+.1),a.gain.setValueAtTime(.1,t),a.gain.exponentialRampToValueAtTime(.01,t+.1),i.start(t),i.stop(t+.1);break;case"shoot":i.type="square",i.frequency.setValueAtTime(800,t),i.frequency.exponentialRampToValueAtTime(100,t+.15),a.gain.setValueAtTime(.1,t),a.gain.exponentialRampToValueAtTime(.01,t+.15),i.start(t),i.stop(t+.15);break;case"enemy_shoot":i.type="triangle",i.frequency.setValueAtTime(400,t),i.frequency.exponentialRampToValueAtTime(100,t+.2),a.gain.setValueAtTime(.1,t),a.gain.exponentialRampToValueAtTime(.01,t+.2),i.start(t),i.stop(t+.2);break;case"explosion":i.type="sawtooth",i.frequency.setValueAtTime(100,t),i.frequency.exponentialRampToValueAtTime(10,t+.4);const e=this.ctx.createOscillator();e.type="square",e.frequency.setValueAtTime(80,t),e.frequency.exponentialRampToValueAtTime(5,t+.4),e.connect(a),e.start(t),e.stop(t+.4),a.gain.setValueAtTime(.3,t),a.gain.exponentialRampToValueAtTime(.01,t+.4),i.start(t),i.stop(t+.4);break;case"powerup":i.type="sine",i.frequency.setValueAtTime(440,t),i.frequency.setValueAtTime(554,t+.1),i.frequency.setValueAtTime(659,t+.2),i.frequency.setValueAtTime(880,t+.3),a.gain.setValueAtTime(.1,t),a.gain.linearRampToValueAtTime(.1,t+.3),a.gain.exponentialRampToValueAtTime(.01,t+.6),i.start(t),i.stop(t+.6);break;case"hurt":i.type="sawtooth",i.frequency.setValueAtTime(200,t),i.frequency.linearRampToValueAtTime(50,t+.2),a.gain.setValueAtTime(.1,t),a.gain.exponentialRampToValueAtTime(.01,t+.2),i.start(t),i.stop(t+.2);break;case"brick_break":i.type="square",i.frequency.setValueAtTime(100,t),i.frequency.exponentialRampToValueAtTime(20,t+.1),a.gain.setValueAtTime(.2,t),a.gain.exponentialRampToValueAtTime(.01,t+.1),i.start(t),i.stop(t+.1)}}},N=[null,null,null,null];let _=[{},{},{},{}];function U(){try{const e=new Uint32Array(1);let t=window.crypto||window.msCrypto;return t&&t.getRandomValues?(t.getRandomValues(e),e[0]/4294967296):Math.random()}catch(e){return Math.random()}}function H(e,t,i,a,l,s,h,o){return l<e+i&&l+h>e&&s<t+a&&s+o>t}function G(e,t){return!(!e||!t)&&H(e.x,e.y,e.w,e.h,t.x,t.y,t.w,t.h)}class V{constructor(e,t,i){this.x=e,this.y=t,this.color=i,this.life=1,this.vx=8*(U()-.5),this.vy=8*(U()-.5),this.size=6*U()+3}update(){this.x+=this.vx,this.y+=this.vy,this.vy+=.4,this.life-=.05}draw(e,t,i,a){e.save(),e.fillStyle=this.color,e.globalAlpha=Math.max(0,this.life),e.beginPath(),e.arc(this.x-t,this.y-i,this.size,0,2*Math.PI),e.fill(),e.restore()}}class W{constructor(e,t,i){this.x=e,this.y=t,this.color=i,this.vx=8*(U()-.5),this.vy=5*-U()-2,this.life=120,this.angle=U(),this.rotSpeed=.5*(U()-.5),this.size=8*U()+4}update(){this.x+=this.vx,this.y+=this.vy,this.vy+=.5,this.angle+=this.rotSpeed,this.life--;let e=Math.floor(this.y/a),t=Math.floor(this.x/a);e>=0&&e<h&&t>=0&&t<s&&v[e]&&v[e][t]&&0!==v[e][t].type&&(this.vy=0,this.vx*=.8,this.rotSpeed*=.8,this.y=e*a-2)}draw(e,t,i,a){e.save(),e.translate(this.x-t,this.y-i),e.rotate(this.angle),e.fillStyle=this.color,e.fillRect(-this.size/2,-this.size/2,this.size,this.size),e.restore()}}function K(e,t,i,a="white"){S.push({x:e,y:t,text:i,life:60,vy:-2,color:a})}function Y(e,t,i,a=1){for(let l=0;l<8*a;l++)w.push(new V(e,t,i))}function q(e,t,i){for(let a=0;a<6;a++){let a=new W(e+20*U(),t+20*U(),i);a.size=4*U()+2,k.push(a)}}function z(e,t,i){for(let l=t-i;l<=t+i;l++)for(let t=e-i;t<=e+i;t++)if(l>=0&&l<h&&t>=0&&t<s){let e=v[l][t];e&&(1===e.type?(q(t*a,l*a,r),v[l][t]={type:0},L&&L.play("brick_break")):3===e.type&&i>=2&&(q(t*a,l*a,"#7f8c8d"),v[l][t]={type:0},L&&L.play("brick_break")))}}function X(e){u.shake=e,e>10&&(u.hitStop=3)}function j(e,t,i,l){if(Y(e,t,"orange",i),L&&L.play("explosion"),z(Math.floor(e/a),Math.floor(t/a),i),F)for(let s of F)if(s.health>0){Math.sqrt(Math.pow(s.x-e,2)+Math.pow(s.y-t,2))<i*a+20&&s.takeDamage(l)}for(let s=0;s<x.length;s++){let h=x[s];if(h.hp>0){Math.sqrt(Math.pow(h.x-e,2)+Math.pow(h.y-t,2))<i*a+20&&h.takeDamage&&h.takeDamage(l,e)}}}function $(e,t,i,a,l,s){a<2*s&&(s=a/2),l<2*s&&(s=l/2),e.beginPath(),e.moveTo(t+s,i),e.arcTo(t+a,i,t+a,i+l,s),e.arcTo(t+a,i+l,t,i+l,s),e.arcTo(t,i+l,t,i,s),e.arcTo(t,i,t+a,i,s),e.closePath(),e.fill()}function J(e,t,i,a,l,s){e.fillStyle="#fff",e.beginPath(),e.arc(t,i,a,0,2*Math.PI),e.fill(),e.strokeStyle="#000",e.lineWidth=1,e.stroke();let h=.4*a,o=t+l*(.3*a),n=i+s*(.3*a);e.fillStyle="#000",e.beginPath(),e.arc(o,n,h,0,2*Math.PI),e.fill(),e.fillStyle="#fff",e.beginPath(),e.arc(o+.3*h,n-.3*h,.3*h,0,2*Math.PI),e.fill()}function Z(e,t,i,a=null){let l=t.cSkin,s=t.cDark,h=t.cSuit,o=2*Math.sin(.5*i),n=Math.sin(.5*i),r=.8*n,c=.8*-n,p=0,y=0;if(a&&a.timer>0){let e=a.timer/a.max,t=Math.sin(e*Math.PI);"kick"===a.type?(r=-Math.PI/2*t,y=10*t,c=Math.PI/4):"punch"===a.type||"shoot"===a.type?(c=-Math.PI/2,p=15*t):"slash"===a.type?c=-Math.PI/2+e*Math.PI-Math.PI/2:"smash_down"===a.type?(c=Math.PI,e<.5&&(c=0)):"throw"===a.type?c=-Math.PI/2+(1-e)*Math.PI:"flex"===a.type&&(c=.5-Math.PI,p=-5,o=3*Math.sin(1.5*i))}let d=["rhino","elephant","bear","poodle","tree"].includes(t.type),f=["rodent","hedgehog","rabbit","pig"].includes(t.type)?.8:d?1.2:1;e.save(),e.scale(f,f),(["dog_pointy","cat","bird"].includes(t.type)||t.name.includes("SUPER")||t.name.includes("THOR")||t.name.includes("STRANGE")||t.name.includes("SCARLET")||t.name.includes("VISION"))&&(e.fillStyle=t.pColor,e.beginPath(),e.moveTo(-10,5+o),e.lineTo(10,5+o),e.lineTo(15+5*Math.sin(.2*i),35+o),e.lineTo(5*Math.sin(.2*i+1)-15,35+o),e.fill()),["dog_pointy","dog_flat","dog_long","cat","fox","wolf","panther","raccoon","monkey","lizard","croc","cow","lion","fish"].includes(t.type)&&(e.strokeStyle=l,e.lineWidth=4,e.lineCap="round",e.beginPath(),e.moveTo(-5,25+o),"monkey"===t.type?e.quadraticCurveTo(-20,10+o,-5,5+o):"fish"===t.type?(e.moveTo(0,25+o),e.lineTo(0,35+o)):e.quadraticCurveTo(-15,20+o+5*Math.sin(.3*i),-20,15+o),e.stroke(),"raccoon"===t.type&&(e.strokeStyle="#333",e.lineWidth=4,e.setLineDash([4,4]),e.stroke(),e.setLineDash([]))),"turtle"===t.type&&(e.fillStyle=s,e.beginPath(),e.arc(0,15+o,14,0,2*Math.PI),e.fill()),e.fillStyle=s,e.save(),e.translate(-4,25+o),e.rotate(r),$(e,-3,0,6,12,3),e.restore(),e.fillStyle=h;let g=d?26:20;$(e,-g/2,8+o,g,d?22:18,5),e.fillStyle="rgba(255,255,255,0.3)",e.beginPath(),e.arc(0,16+o,4,0,2*Math.PI),e.fill(),e.fillStyle="#FFD700",e.fillRect(-g/2,22+o,g,4),e.save(),e.translate(0,0+o),function(e,t){let i=t.cSkin,a=t.cDark;e.fillStyle=i,["dog_pointy","wolf","fox","cat","monkey","bat"].includes(t.type)?($(e,-12,-12,24,20,8),"monkey"===t.type?(e.beginPath(),e.arc(-14,-5,5,0,2*Math.PI),e.fill(),e.beginPath(),e.arc(14,-5,5,0,2*Math.PI),e.fill()):"bat"===t.type?(e.beginPath(),e.moveTo(-8,-12),e.lineTo(-18,-25),e.lineTo(-2,-12),e.fill(),e.beginPath(),e.moveTo(8,-12),e.lineTo(18,-25),e.lineTo(2,-12),e.fill()):(e.beginPath(),e.moveTo(-8,-10),e.lineTo(-14,-22),e.lineTo(-2,-10),e.fill(),e.beginPath(),e.moveTo(8,-10),e.lineTo(14,-22),e.lineTo(2,-10),e.fill())):["dog_flat","pig","bear","poodle","dog_long","panda","koala","lion"].includes(t.type)?($(e,-12,-12,24,20,8),e.beginPath(),e.arc(-12,-6,6,0,2*Math.PI),e.fill(),e.beginPath(),e.arc(12,-6,6,0,2*Math.PI),e.fill()):"rabbit"===t.type||"kangaroo"===t.type?($(e,-10,-10,20,18,5),e.fillStyle=i,$(e,-8,-32,6,24,3),$(e,2,-32,6,24,3)):["rodent","hedgehog","skunk","anteater"].includes(t.type)?($(e,-10,-8,20,16,6),e.beginPath(),e.arc(-8,-6,4,0,2*Math.PI),e.fill(),e.beginPath(),e.arc(8,-6,4,0,2*Math.PI),e.fill()):["rhino","elephant","cow"].includes(t.type)?($(e,-14,-14,28,24,8),"cow"===t.type?(e.fillStyle="#fff",e.beginPath(),e.moveTo(-14,-10),e.quadraticCurveTo(-20,-20,-10,-15),e.fill(),e.beginPath(),e.moveTo(14,-10),e.quadraticCurveTo(20,-20,10,-15),e.fill(),e.fillStyle=i):(e.beginPath(),e.arc(-14,-4,8,0,2*Math.PI),e.fill())):["bird","duck","chicken","penguin"].includes(t.type)?(e.beginPath(),e.arc(0,-5,12,0,2*Math.PI),e.fill()):["raccoon","panda"].includes(t.type)?($(e,-11,-10,22,18,6),e.beginPath(),e.moveTo(-9,-8),e.lineTo(-13,-18),e.lineTo(-3,-8),e.fill(),e.beginPath(),e.moveTo(9,-8),e.lineTo(13,-18),e.lineTo(3,-8),e.fill()):["turtle","frog","fish","alien","skeleton","pumpkin","robot","stone"].includes(t.type)?"turtle"===t.type||"frog"===t.type?($(e,-12,-10,24,16,8),"frog"===t.type&&(e.beginPath(),e.arc(-8,-12,5,0,2*Math.PI),e.fill(),e.beginPath(),e.arc(8,-12,5,0,2*Math.PI),e.fill())):"fish"===t.type?(e.beginPath(),e.ellipse(0,-5,12,15,Math.PI/2,0,2*Math.PI),e.fill(),e.beginPath(),e.moveTo(0,-18),e.lineTo(-5,-5),e.lineTo(5,-5),e.fill()):"alien"===t.type?(e.beginPath(),e.moveTo(0,10),e.bezierCurveTo(20,0,20,-30,0,-30),e.bezierCurveTo(-20,-30,-20,0,0,10),e.fill()):"skeleton"===t.type?(e.fillStyle="#eee",$(e,-10,-15,20,20,8),e.fillRect(-6,5,12,6)):"pumpkin"===t.type?(e.fillStyle="#FFA500",e.beginPath(),e.arc(0,-5,14,0,2*Math.PI),e.fill(),e.fillStyle="#006400",e.fillRect(-2,-22,4,8)):"robot"===t.type?($(e,-12,-15,24,24,2),e.beginPath(),e.moveTo(0,-15),e.lineTo(0,-25),e.stroke(),e.beginPath(),e.arc(0,-25,3,0,2*Math.PI),e.fill()):"stone"===t.type&&(e.beginPath(),e.moveTo(-10,-15),e.lineTo(5,-20),e.lineTo(12,-10),e.lineTo(10,5),e.lineTo(-8,8),e.fill()):$(e,-11,-11,22,22,8),"raccoon"!==t.type&&"panda"!==t.type||(e.fillStyle="panda"===t.type?"#000":"#333",e.beginPath(),e.ellipse(-5,-4,4,5,.2,0,2*Math.PI),e.fill(),e.beginPath(),e.ellipse(5,-4,4,5,-.2,0,2*Math.PI),e.fill()),["dog_pointy","dog_flat","dog_long","wolf","fox","bear","pig","monkey","cow"].includes(t.type)?(e.fillStyle=a,"pig"===t.type?(e.fillStyle="#ffb6c1",$(e,-6,0,12,8,3),e.fillStyle="#d16d7e",e.beginPath(),e.arc(-3,4,2,0,2*Math.PI),e.fill(),e.beginPath(),e.arc(3,4,2,0,2*Math.PI),e.fill()):"monkey"===t.type?(e.fillStyle="#FFE4C4",e.beginPath(),e.ellipse(0,2,8,6,0,0,2*Math.PI),e.fill(),e.fillStyle="#000",e.beginPath(),e.moveTo(-2,0),e.lineTo(2,0),e.stroke()):"cow"===t.type?(e.fillStyle="#FFC0CB",$(e,-7,0,14,8,3)):($(e,-6,-1,12,9,4),e.fillStyle="#000",e.beginPath(),e.arc(0,-1,3,0,2*Math.PI),e.fill())):["cat","panther","raccoon","lion","bat"].includes(t.type)?(e.fillStyle="#000",e.beginPath(),e.moveTo(-2,2),e.lineTo(2,2),e.lineTo(0,5),e.fill(),e.strokeStyle="#000",e.lineWidth=1,e.beginPath(),e.moveTo(5,0),e.lineTo(15,-2),e.stroke(),e.beginPath(),e.moveTo(5,2),e.lineTo(15,4),e.stroke(),e.beginPath(),e.moveTo(-5,0),e.lineTo(-15,-2),e.stroke(),e.beginPath(),e.moveTo(-5,2),e.lineTo(-15,4),e.stroke()):"elephant"===t.type?(e.lineWidth=6,e.strokeStyle=i,e.lineCap="round",e.beginPath(),e.moveTo(0,0),e.quadraticCurveTo(0,15,10,10),e.stroke()):"rhino"===t.type?(e.fillStyle="#eee",e.beginPath(),e.moveTo(0,-5),e.lineTo(4,-15),e.lineTo(6,-5),e.fill()):["bird","duck","chicken","penguin"].includes(t.type)?(e.fillStyle="orange","duck"===t.type||"chicken"===t.type?(e.beginPath(),e.ellipse(0,-2,8,4,0,0,2*Math.PI),e.fill()):(e.beginPath(),e.moveTo(5,-5),e.lineTo(18,-2),e.lineTo(5,2),e.fill())):"anteater"===t.type?(e.fillStyle=a,e.beginPath(),e.moveTo(8,0),e.lineTo(20,2),e.lineTo(8,6),e.fill()):"croc"===t.type||"lizard"===t.type?(e.fillStyle=a,$(e,-8,0,16,12,4)):"skeleton"===t.type?(e.fillStyle="#000",e.beginPath(),e.arc(-5,-6,3,0,2*Math.PI),e.fill(),e.beginPath(),e.arc(5,-6,3,0,2*Math.PI),e.fill(),e.beginPath(),e.moveTo(0,2),e.lineTo(-2,6),e.lineTo(2,6),e.fill()):"pumpkin"===t.type?(e.fillStyle="#000",e.beginPath(),e.moveTo(-6,-6),e.lineTo(-2,-2),e.lineTo(-10,-2),e.fill(),e.beginPath(),e.moveTo(6,-6),e.lineTo(2,-2),e.lineTo(10,-2),e.fill(),e.beginPath(),e.moveTo(-8,5),e.lineTo(0,8),e.lineTo(8,5),e.fill()):"robot"===t.type&&(e.fillStyle="#00FF00",e.fillRect(-8,-10,5,5),e.fillRect(3,-10,5,5),e.fillRect(-6,2,12,2)),["skeleton","pumpkin","robot","alien"].includes(t.type)||(t.name.includes("DARE")?(e.fillStyle=t.cDark,e.fillRect(-12,-8,24,6)):t.name.includes("SPIDER")||t.name.includes("DEAD")||t.name.includes("PANTHER")||t.name.includes("IRON")?(e.fillStyle="#fff",e.beginPath(),e.ellipse(-5,-4,4,6,-.2,0,2*Math.PI),e.fill(),e.beginPath(),e.ellipse(5,-4,4,6,.2,0,2*Math.PI),e.fill(),e.strokeStyle="#000",e.lineWidth=1,e.stroke()):(J(e,-5,-4,4,.5,0),J(e,5,-4,4,.5,0))),(t.name.includes("CAP")||t.name.includes("TRASH"))&&(e.fillStyle=t.cSuit,e.beginPath(),e.arc(0,-11,12,Math.PI,0),e.fill(),e.fillRect(-12,-11,24,2)),"tree"===t.type&&(e.fillStyle="lime",e.beginPath(),e.arc(0,-15,8,0,2*Math.PI),e.fill())}(e,t),e.restore(),e.fillStyle=s,e.save(),e.translate(4+y,25+o+0),a&&"kick"===a.type&&a.timer>0?e.rotate(r):e.rotate(-r),$(e,-3,0,6,12,3),e.restore(),e.fillStyle=h,e.save(),e.translate(0+p,15+o+0),e.rotate(c),$(e,-3,0,6,12,3),e.fillStyle=l,e.beginPath(),e.arc(0,12,4,0,2*Math.PI),e.fill(),"boomerang"===t.pType&&(e.fillStyle=t.pColor,e.translate(0,12),e.rotate(Math.PI/2),e.fillRect(-2,-6,4,12)),e.restore(),e.restore()}class Q{constructor(e,t,i,a,l,s=!1,h=!1,o=!1){this.x=e,this.y=t,this.life=80,this.isSpecial=a,this.w=15,this.h=5,this.behavior=l.behavior||null,this.renderer=l.renderer||null,this.owner=l.owner||null,this.damage=l.damage||(a?5:1),this.color=l.pColor||"#fff",this.type=l.pType||"normal",this.isEnemy=l.isEnemy||!1,this.returnState=0,l.w&&(this.w=l.w),l.h&&(this.h=l.h),l.life&&(this.life=l.life),void 0!==l.vx?this.vx=l.vx:this.vx=15*i,void 0!==l.vy?this.vy=l.vy:this.vy=2*(U()-.5),s&&(this.vx=0,this.vy=15,this.w=8,this.h=20),o&&(this.vx=0,this.vy=-15,this.w=8,this.h=20),h&&(this.vx=12*i,this.vy=-5,this.w=12,this.h=12,this.color="#ccc"),this.behavior||s||h||o||("spread"===this.type&&(this.w=8,this.h=8,this.vx=15*i+5*(U()-.5),this.vy=10*(U()-.5)),"rocket"!==this.type&&"grenade"!==this.type||(this.w=12,this.h=12,this.vy=-5),"boomerang"===this.type&&(this.w=20,this.h=20,this.life=100),"bolt"===this.type&&(this.w=25,this.h=10),"laser"===this.type&&(this.w=40,this.h=5,this.vx=25*i),"magic"===this.type&&(this.w=10,this.h=10,this.baseY=t,this.timer=0),"fireball"===this.type&&(this.w=20,this.h=20,this.vx=12*i),"ice_beam"===this.type&&(this.w=30,this.h=6,this.vx=20*i),"sonic_wave"===this.type&&(this.w=10,this.h=40,this.vx=8*i,this.life=120),"lightning"===this.type&&(this.w=50,this.h=4,this.vx=40*i),"shuriken"===this.type&&(this.w=15,this.h=15,this.vx=18*i,this.rotation=0),"water_gun"===this.type&&(this.w=12,this.h=12,this.vx=14*i,this.vy=5*(U()-.5)),"acid_spit"===this.type&&(this.w=10,this.h=10,this.vx=10*i,this.vy=-8),"card_throw"===this.type&&(this.w=12,this.h=4,this.vx=22*i))}update(){if(this.behavior)return this.behavior(this),this.life--,void this.checkCollisions();if("grenade"===this.type||"rocket"===this.type||"acid_spit"===this.type)this.vy+=.3,this.x+=this.vx,this.y+=this.vy;else if("boomerang"===this.type&&0!==this.vx)if(0===this.returnState)this.x+=this.vx,this.vx*=.95,Math.abs(this.vx)<1&&(this.returnState=1);else{let e=b.x-this.x,t=b.y-this.y,i=Math.atan2(t,e);this.x+=15*Math.cos(i),this.y+=15*Math.sin(i),Math.abs(e)<20&&Math.abs(t)<20&&(this.life=0)}else"magic"===this.type&&0!==this.vx?(this.timer++,this.x+=this.vx,this.y=this.baseY+20*Math.sin(.2*this.timer)):"shuriken"===this.type?(this.x+=this.vx,this.y+=this.vy,this.rotation+=.5):"sonic_wave"===this.type?(this.x+=this.vx,this.w+=.5,this.h+=1,this.y-=.5):(this.x+=this.vx,this.y+=this.vy);this.life--,this.checkCollisions()}checkCollisions(){let e=Math.floor(this.x/a),t=Math.floor(this.y/a);if(t>=0&&t<h&&e>=0&&e<s&&v[t]&&v[t][e]&&0!==v[t][e].type){let i=v[t][e];"sonic_wave"===this.type||1!==i.type&&2!==i.type&&3!==i.type||("boomerang"===this.type&&0!==this.vx?(this.returnState=1,1===i.type&&(Y(this.x,this.y,r,1),v[t][e]={type:0},L&&L.play("brick_break"))):(Y(this.x,this.y,r,1),this.life=0,1===i.type&&(v[t][e]={type:0},L&&L.play("brick_break")),(this.isSpecial||"rocket"===this.type||"grenade"===this.type||"fireball"===this.type||this.vy>0)&&z(e,t,1)))}if(!this.isEnemy)for(let e=0;e<x.length;e++){let t=x[e];void 0!==t.hp&&t.hp>0&&H(this.x,this.y,this.w,this.h,t.x,t.y,t.w,t.h)&&(t.takeDamage&&t.takeDamage(this.damage),"boomerang"!==this.type?this.life=0:this.returnState=1)}this.isEnemy&&b&&H(this.x,this.y,this.w,this.h,b.x,b.y,b.w,b.h)&&(b.takeDamage(this.isSpecial?2:1),"boomerang"!==this.type?this.life=0:this.returnState=1)}draw(e,t,i,a){let l=this.x-t,s=this.y-i;if(this.renderer)this.renderer(e,this,l,s,a);else if("boomerang"===this.type)e.save(),e.translate(l,s),e.rotate(.2*a),e.fillStyle=this.color,e.beginPath(),e.moveTo(0,0),e.lineTo(15,-10),e.lineTo(10,0),e.lineTo(15,10),e.fill(),e.restore();else if("grenade"===this.type||"rocket"===this.type)e.fillStyle="#2ecc71",e.beginPath(),e.arc(l+this.w/2,s+this.h/2,6,0,2*Math.PI),e.fill(),e.fillStyle="#27ae60",e.fillRect(l+this.w/2-2,s-2,4,4);else if("bolt"===this.type||"laser"===this.type||"ice_beam"===this.type||"lightning"===this.type)e.fillStyle=this.color,e.shadowBlur=10,e.shadowColor=this.color,$(e,l,s,this.w,this.h,2),e.shadowBlur=0;else if("fireball"===this.type)e.fillStyle="#FF4500",e.beginPath(),e.arc(l+this.w/2,s+this.h/2,10,0,2*Math.PI),e.fill(),e.fillStyle="#FFFF00",e.beginPath(),e.arc(l+this.w/2,s+this.h/2,6,0,2*Math.PI),e.fill();else if("shuriken"===this.type){e.save(),e.translate(l+this.w/2,s+this.h/2),e.rotate(this.rotation||0),e.fillStyle="#C0C0C0",e.beginPath();for(let t=0;t<4;t++)e.rotate(Math.PI/2),e.moveTo(0,0),e.lineTo(8,0),e.lineTo(2,2),e.lineTo(0,0);e.fill(),e.restore()}else"sonic_wave"===this.type?(e.strokeStyle=this.color,e.lineWidth=2,e.beginPath(),e.arc(l,s+this.h/2,this.h,-Math.PI/4,Math.PI/4),e.stroke(),e.beginPath(),e.arc(l-10,s+this.h/2,this.h-10,-Math.PI/4,Math.PI/4),e.stroke()):"card_throw"===this.type?(e.fillStyle="#fff",e.fillRect(l,s,this.w,this.h),e.fillStyle="red",e.beginPath(),e.arc(l+this.w/2,s+this.h/2,2,0,2*Math.PI),e.fill()):(e.fillStyle=this.color,e.beginPath(),e.arc(l+this.w/2,s+this.h/2,5,0,2*Math.PI),e.fill())}}class ee{constructor(e,t,i,a,l,s=1){this.x=e,this.y=t,this.w=i,this.h=a,this.life=15,this.power=s,this.hp=1,Y(e+i/2,t+a/2,"#fff",.5)}update(){this.life--,this.life<=0&&(this.hp=0),z(Math.floor((this.x+this.w/2)/a),Math.floor((this.y+this.h/2)/a),1);for(let e=0;e<x.length;e++){let t=x[e];t!==this&&void 0!==t.hp&&t.hp>0&&H(this.x,this.y,this.w,this.h,t.x,t.y,t.w,t.h)&&t.takeDamage&&t.takeDamage(2*this.power)}}draw(e,t,i,a){}takeDamage(){}}class te{constructor(e,t){this.x=e,this.y=t,this.w=a,this.h=a,this.hp=10,this.vx=0,this.vy=0,this.type="prop",this.burning=!1,this.burnTimer=0}update(){this.vy+=l,this.y+=this.vy;let e=Math.floor((this.y+this.h)/a),t=Math.floor((this.x+this.w/2)/a),i=v&&v[0]?v[0].length:s,o=v?v.length:h;e>=0&&e<o&&t>=0&&t<i&&v[e]&&v[e][t]&&0!==v[e][t].type&&(this.y=e*a-this.h,this.vy=0,this.vx=0),this.x+=this.vx,this.burning&&(this.burnTimer--,Math.random()<.3&&(Y(this.x+this.w/2+10*(Math.random()-.5),this.y+this.h/2+10*(Math.random()-.5),"orange",.2),Y(this.x+this.w/2+10*(Math.random()-.5),this.y+10*(Math.random()-.5),"grey",.1)),this.burnTimer<=0&&(this.hp=0,j(this.x+this.w/2,this.y+this.h/2,2,50),this.x=-9999))}takeDamage(e,t){this.vx=0,this.vy=0,this.burning?(this.burnTimer-=20,this.hp-=e):(this.burning=!0,this.burnTimer=60,K(this.x,this.y,"WARNING!","orange")),this.hp<=0&&(j(this.x+this.w/2,this.y+this.h/2,2,50),this.x=-9999)}draw(e,t,i,a){let l=this.x-t,s=this.y-i;this.burning&&Math.floor(a/100)%2==0?e.fillStyle="#e67e22":e.fillStyle="#e74c3c",$(e,l+5,s+5,this.w-10,this.h-5,5),e.fillStyle="#bdc3c7",e.fillRect(l+12,s,16,5),e.fillStyle="white",e.font="10px Arial",e.fillText("GAS",l+10,s+25)}}class ie{constructor(e,t){this.x=e,this.y=t,this.w=a,this.h=a,this.hp=20}update(){}takeDamage(e){this.hp-=e,this.hp<=0&&(this.x=-9999,Y(this.x,this.y,"grey",1))}draw(e,t,i,a){e.fillStyle="#8e44ad",e.fillRect(this.x-t,this.y-i,this.w,this.h),e.beginPath(),e.moveTo(this.x-t,this.y-i),e.lineTo(this.x-t+this.w,this.y-i+this.h),e.stroke()}}class ae{constructor(e,t){this.x=e,this.y=t,this.w=60,this.h=80,this.occupied=!1,this.hp=500}update(){if(!this.occupied){this.y+=5;let e=Math.floor((this.y+this.h)/a),t=Math.floor((this.x+this.w/2)/a);if(e>=0&&e<h&&t>=0&&t<s&&v[e]&&v[e][t]&&0!==v[e][t].type&&(this.y=e*a-this.h),F)for(let e of F)if(Math.abs(e.x-this.x)<50&&Math.abs(e.y-this.y)<50&&E[e.index].e){this.enter(e);break}}}enter(e){this.occupied=!0,e.inMech=!0,e.mech=this,Y(this.x+30,this.y+40,"cyan",2)}eject(e){this.occupied=!1,e.inMech=!1,e.mech=null,this.x=e.x,this.y=e.y,this.hp=0,Y(this.x+30,this.y+40,"cyan",5),this.x=-9999}draw(e,t,i,a){if(this.occupied)return;let l=this.x-t,s=this.y-i;e.fillStyle="#34495e",$(e,l,s,this.w,this.h,10),e.fillStyle="#f1c40f",e.fillRect(l+15,s+10,30,20),e.fillStyle="#2c3e50",e.fillRect(l+10,s+60,15,20),e.fillRect(l+35,s+60,15,20),e.fillRect(l-10,s+20,10,30),e.fillRect(l+60,s+20,10,30)}}class le{constructor(e,t){this.x=e,this.y=t,this.w=120,this.h=60,this.timer=0,this.isIntro=e<1e3,this.hp=1e3}update(){if(this.timer++,this.y+=2*Math.sin(.1*this.timer),!this.isIntro&&F)for(let e of F)if(e.health>0&&G(this,e)){u.levelComplete=!0,O();break}this.isIntro&&this.timer>100&&(this.y-=2,this.x-=2,this.y<-200&&(this.x=-9999))}draw(e,t,i,a){let l=this.x-t,s=this.y-i;e.fillStyle="#27ae60",$(e,l,s,100,50,10),e.fillStyle="rgba(0,0,0,0.5)",e.fillRect(l-20,s-10,140,5),e.fillStyle="#27ae60",e.fillRect(l-40,s+10,40,10),e.fillRect(l-50,s,10,30),e.strokeStyle="#fff",e.beginPath(),e.moveTo(l+50,s+50),e.lineTo(l+50,s+100),e.stroke()}}class se{constructor(e,t){this.x=e,this.y=t,this.w=40,this.h=40,this.freed=!1,this.hp=100}update(){let e=null;if(!this.freed&&F)for(let t of F)if(t.health>0&&G(this,t)){e=t;break}if(e){this.freed=!0,Y(this.x,this.y,"green",2),function(e){let t=e?e.x:0,i=e?e.y:0,a=u.rescues+1,l=0===u.globalUnlocked?0:2*u.globalUnlocked-1;a>=l?u.globalUnlocked<m.length?(u.globalUnlocked++,u.unlockedCount=u.globalUnlocked,K(t,i-40,"NEW HERO!","gold"),Y(t,i,"gold",2),L&&L.play("powerup")):K(t,i-40,"MAX ROSTER!","gold"):K(t,i-40,l-a+" MORE","cyan")}(e),u.rescues++,u.lives++,K(this.x,this.y-40,"1 UP!","gold"),"undefined"!=typeof soundManager&&soundManager&&soundManager.play("powerup");try{B()}catch(e){}if(e){let t=m.slice(0,u.globalUnlocked),i=Math.floor(U()*t.length),a=t[i].id;t.length>1&&a===e.charData.id&&(i=(i+1)%t.length,a=t[i].id),e.setCharacter(a),e.health=3,B(),Y(e.x,e.y,"white",2),K(e.x,e.y-60,"SWITCH!","cyan")}}}draw(e,t,i,a){if(this.freed)return;let l=this.x-t,s=this.y-i;e.strokeStyle="#bdc3c7",e.lineWidth=2,e.strokeRect(l,s,this.w,this.h);for(let t=10;t<this.w;t+=10)e.beginPath(),e.moveTo(l+t,s),e.lineTo(l+t,s+this.h),e.stroke();e.fillStyle="#e67e22",e.beginPath(),e.arc(l+20,s+20,10,0,2*Math.PI),e.fill()}}class he{constructor(e,t){this.x=e,this.y=t,this.w=40,this.h=60,this.vx=0,this.vy=0,this.hp=3,this.facing=1,this.state="patrol",this.timer=0,this.shootTimer=0,this.color="#e74c3c",this.blockedTimer=0,this.speed=2,this.chaseSpeed=3}update(){this.vy+=l,this.y+=this.vy;let e=Math.floor((this.y+this.h)/a),t=Math.floor((this.x+this.w/2)/a);if(e>=0&&e<h&&t>=0&&t<s&&v[e]&&v[e][t]&&(1===v[e][t].type||2===v[e][t].type||3===v[e][t].type)&&(this.y=e*a-this.h,this.vy=0),this.blockedTimer>0)this.blockedTimer--,this.vx=this.facing*this.speed;else{let e=null,t=9999;if(F)for(let i of F)if(i.health>0){let a=Math.hypot(i.x-this.x,i.y-this.y);a<t&&(t=a,e=i)}e&&(this.state=t<400?"chase":"patrol","patrol"===this.state?(this.timer<=0&&(this.timer=60+60*Math.random(),this.facing=Math.random()<.5?-1:1,this.vx=this.facing*this.speed),this.timer--,this.vx=this.facing*this.speed):"chase"===this.state&&(this.facing=e.x<this.x?-1:1,this.vx=this.facing*this.chaseSpeed,this.shootTimer++,this.shootTimer>60&&(this.shoot(e),this.shootTimer=0)))}let i=this.x+this.vx,o=Math.floor(this.y/a),n=Math.floor((this.y+this.h-1)/a),r=Math.floor((i+(this.vx>0?this.w:0))/a),c=!1;if(r>=0&&r<s){let e=v[o]&&v[o][r],t=v[n]&&v[n][r];(e&&(1===e.type||2===e.type||3===e.type)||t&&(1===t.type||2===t.type||3===t.type))&&(c=!0)}else c=!0;let p=Math.floor((i+(this.vx>0?this.w:0))/a),y=Math.floor((this.y+this.h+2)/a),d=!1;if(y<h&&p>=0&&p<s){let e=v[y][p];e&&0!==e.type&&4!==e.type&&6!==e.type||(d=!0)}else d=!0;c||d?(this.vx=0,this.facing*=-1,this.blockedTimer=60):this.x+=this.vx}shoot(e){if(!e)return;let t=Math.atan2(e.y-this.y,e.x-this.x);t+=.2*(Math.random()-.5);let i=new Q(this.x+this.w/2,this.y+20,1,!1,{pColor:this.color,pType:"normal",isEnemy:!0});i.vx=8*Math.cos(t),i.vy=8*Math.sin(t),x.push(i),L&&L.play("enemy_shoot")}takeDamage(e,t){this.hp-=e,K(this.x,this.y,10*e),this.vx=this.x-t>0?5:-5,this.vy=-3,this.blockedTimer=10,this.hp<=0&&(Y(this.x+this.w/2,this.y+this.h/2,"red",1),L&&L.play("explosion"),this.x=-9999)}draw(e,t,i,a){let l=this.x-t,s=this.y-i,h="#7f8c8d";e.fillStyle="#2c3e50",e.fillRect(l+5,s+40,10,20),e.fillRect(l+25,s+40,10,20),e.fillStyle="#c0392b",e.fillRect(l,s+10,40,30),e.strokeStyle="#000",e.lineWidth=2,e.strokeRect(l,s+10,40,30),e.fillStyle="#fff",e.fillRect(l+2,s+12,2,2),e.fillRect(l+36,s+12,2,2),e.fillRect(l+2,s+36,2,2),e.fillRect(l+36,s+36,2,2),e.fillStyle=h,e.fillRect(l+10,s-5,20,15),e.strokeRect(l+10,s-5,20,15),e.fillStyle="#e74c3c",e.beginPath(),e.arc(l+20+2*this.facing,s+2,4,0,2*Math.PI),e.fill(),e.fillStyle="#fff",e.fillRect(l+20+2*this.facing-1,s+1,2,2),e.fillStyle=h;let o=1===this.facing?l+30:l-10;e.fillRect(o,s+15,20,8),e.fillStyle="#222",e.fillRect(o+(1===this.facing?20:-5),s+12,5,14)}}class oe extends he{constructor(e,t){super(e,t),this.type="fly",this.hp=2,this.w=40,this.h=40}update(){let e=null,t=9999;if(F)for(let i of F)if(i.health>0){let a=Math.hypot(i.x-this.x,i.y-this.y);a<t&&(t=a,e=i)}if(!e)return;let i=0,l=0;t<500?(i=.02*(e.x-this.x),l=.02*(e.y-this.y-100),this.shootTimer++,this.shootTimer>100&&(this.shoot(e),this.shootTimer=0)):(i*=.9,l=1*Math.sin(.005*Date.now()));let o=this.x+i,n=this.y+l,r=Math.floor((n+this.h/2)/a),c=Math.floor((o+this.w/2)/a);r>=0&&r<h&&c>=0&&c<s&&v[r]&&v[r][c]&&(1===v[r][c].type||2===v[r][c].type||3===v[r][c].type)&&(i*=-1.5,l*=-1.5),this.vx+=.1*(i-this.vx),this.vy+=.1*(l-this.vy),this.x+=this.vx,this.y+=this.vy}draw(e,t,i,a){let l=this.x-t,s=this.y-i;e.fillStyle="rgba(142, 68, 173, 0.6)",e.beginPath(),e.arc(l+20,s+15,15,Math.PI,0),e.fill(),e.strokeStyle="#fff",e.lineWidth=1,e.stroke(),e.fillStyle="#8e44ad",e.beginPath(),e.arc(l+20,s+12,6,0,2*Math.PI),e.fill(),e.fillStyle="#bdc3c7",e.beginPath(),e.ellipse(l+20,s+20,20,8,0,0,2*Math.PI),e.fill(),e.strokeStyle="#7f8c8d",e.stroke();let h=a;for(let t=0;t<3;t++)e.fillStyle=Math.floor(h/200)%3===t?"red":"#550000",e.beginPath(),e.arc(l+10+10*t,s+20,2,0,2*Math.PI),e.fill();e.fillStyle="#333",e.fillRect(l+15,s+25,10,5),Math.random()<.5&&(e.fillStyle="cyan",e.beginPath(),e.moveTo(l+15,s+30),e.lineTo(l+20,s+40),e.lineTo(l+25,s+30),e.fill())}}class ne extends he{constructor(e,t){super(e,t),this.hp=1,this.speed=4,this.chaseSpeed=5,this.color="#d35400"}update(){super.update();let e=null,t=9999;if(F)for(let i of F)if(i.health>0){let a=Math.hypot(i.x-this.x,i.y-this.y);a<t&&(t=a,e=i)}e&&t<50&&this.explode()}explode(){let e=this.x,t=this.y;this.x=-9999,j(e+20,t+30,2,50)}takeDamage(e,t){super.takeDamage(e,t),this.hp<=0&&this.explode()}draw(e,t,i,a){let l=this.x-t,s=this.y-i;e.fillStyle="#333",e.fillRect(l+10,s+40,5,20),e.fillRect(l+25,s+40,5,20),e.fillStyle="#2c3e50",e.beginPath(),e.arc(l+20,s+25,18,0,2*Math.PI),e.fill(),e.fillStyle="#7f8c8d",e.fillRect(l+18,s,4,10),Math.random()<.5&&(e.fillStyle="yellow",e.beginPath(),e.arc(l+20,s,4,0,2*Math.PI),e.fill()),e.fillStyle="#000",e.fillRect(l+10,s+20,20,10),e.fillStyle="red",e.font="10px monospace";let h=Math.floor(a/100)%2==0;e.fillText(h?":(":"X(",l+12,s+28),e.fillStyle=h?"red":"#500",e.beginPath(),e.arc(l+20,s+35,3,0,2*Math.PI),e.fill()}}class re extends he{constructor(e,t){super(e,t),this.hp=10,this.w=50,this.h=70,this.color="#27ae60",this.speed=0,this.chaseSpeed=0}update(){this.vy+=l,this.y+=this.vy;let e=Math.floor((this.y+this.h)/a),t=Math.floor((this.x+this.w/2)/a);e>=0&&e<h&&t>=0&&t<s&&v[e]&&v[e][t]&&(1===v[e][t].type||2===v[e][t].type||3===v[e][t].type)&&(this.y=e*a-this.h,this.vy=0);let i=null,o=9999;if(F)for(let e of F)if(e.health>0){let t=Math.hypot(e.x-this.x,e.y-this.y);t<o&&(o=t,i=e)}i&&o<500&&(this.facing=i.x<this.x?-1:1,this.shootTimer++,this.shootTimer>10&&(this.shoot(i),this.shootTimer=0))}shoot(e){if(!e)return;let t=Math.atan2(e.y-this.y,e.x-this.x);t+=.4*(Math.random()-.5);let i=new Q(this.x+this.w/2,this.y+30,1,!1,{pColor:this.color,pType:"normal",isEnemy:!0});i.vx=10*Math.cos(t),i.vy=10*Math.sin(t),x.push(i),L&&L.play("enemy_shoot")}draw(e,t,i,a){let l=this.x-t,s=this.y-i;e.fillStyle="#2c3e50",$(e,l,s+50,50,20,5),e.fillStyle="#7f8c8d";for(let t=0;t<3;t++)e.beginPath(),e.arc(l+10+15*t,s+60,6,0,2*Math.PI),e.fill();e.fillStyle="#27ae60",e.fillRect(l+5,s+10,40,40),e.fillStyle="#1e8449",e.fillRect(l+15,s,20,10),e.fillStyle="#f1c40f",e.fillRect(l+18,s+2,14,4),e.fillStyle="#333";let h=1===this.facing?l+40:l-20;e.fillRect(h,s+25,30,10);let o=2*Math.sin(.5*a);e.fillStyle="#111",e.fillRect(h+(1===this.facing?30:0),s+22+o,5,16)}}class ce extends he{constructor(e,t){super(e,t),this.hp=2,this.range=800,this.aimTimer=0,this.color="#3498db",this.speed=1,this.chaseSpeed=0,this.target=null}update(){this.vy+=l,this.y+=this.vy;let e=Math.floor((this.y+this.h)/a),t=Math.floor((this.x+this.w/2)/a);e>=0&&e<h&&t>=0&&t<s&&v[e]&&v[e][t]&&(1===v[e][t].type||2===v[e][t].type||3===v[e][t].type)&&(this.y=e*a-this.h,this.vy=0);let i=null,o=9999;if(F)for(let e of F)if(e.health>0){let t=Math.abs(e.x-this.x);t<o&&(o=t,i=e)}this.target=i,i&&(o<this.range?(this.facing=i.x<this.x?-1:1,this.aimTimer++,this.aimTimer>180&&(this.shoot(i),this.aimTimer=0)):(this.aimTimer=0,super.update()))}shoot(e){if(!e)return;let t=Math.atan2(e.y-this.y,e.x-this.x),i=new Q(this.x+this.w/2,this.y+20,2,!1,{pColor:this.color,pType:"normal",isEnemy:!0});i.vx=20*Math.cos(t),i.vy=20*Math.sin(t),x.push(i),L&&L.play("enemy_shoot")}draw(e,t,i,a){let l=this.x-t,s=this.y-i;e.fillStyle="#34495e",e.fillRect(l+15,s+40,4,20),e.fillRect(l+25,s+40,4,20),e.fillStyle="#3498db",e.fillRect(l+15,s+15,14,25),e.fillStyle="#2c3e50",e.beginPath(),e.arc(l+22,s+10,8,0,2*Math.PI),e.fill(),e.fillStyle="#000";let h=l+22+4*this.facing;e.beginPath(),e.arc(h,s+10,4,0,2*Math.PI),e.fill(),e.fillStyle="red",e.beginPath(),e.arc(h,s+10,2,0,2*Math.PI),e.fill(),e.fillStyle="#111";1===this.facing?(e.fillRect(l+20,s+20,40,4),e.fillRect(l+20,s+22,10,6)):(e.fillRect(l+24-40,s+20,40,4),e.fillRect(l+14,s+22,10,6)),this.aimTimer>100&&this.target&&(e.strokeStyle="rgba(231, 76, 60, 0.5)",e.lineWidth=1,e.beginPath(),e.moveTo(l+this.w/2,s+22),e.lineTo(this.target.x-t+this.target.w/2,this.target.y-i+this.target.h/2),e.stroke())}}class pe extends he{constructor(e,t){super(e,t),this.hp=8,this.shieldUp=!0,this.color="#7f8c8d",this.speed=1,this.chaseSpeed=1}update(){super.update();let e=null,t=9999;if(F)for(let i of F)if(i.health>0){let a=Math.abs(i.x-this.x);a<t&&(t=a,e=i)}e&&(this.shieldUp=e.x<this.x&&-1===this.facing||e.x>this.x&&1===this.facing)}takeDamage(e,t){let i=t<this.x&&-1===this.facing||t>this.x&&1===this.facing;this.shieldUp&&i?(Y(this.x+20,this.y+20,"blue",1),K(this.x,this.y-20,"BLOCKED!","blue"),this.hp-=.1*e):(this.hp-=e,Y(this.x+20,this.y+20,"red",2),K(this.x,this.y,10*e)),this.hp<=0&&(this.x=-9999,Y(this.x,this.y,"red",3),L&&L.play("explosion"))}draw(e,t,i,a){let l=this.x-t,s=this.y-i;e.fillStyle="#2c3e50",e.fillRect(l+5,s+40,10,20),e.fillRect(l+25,s+40,10,20),e.fillStyle="#95a5a6",e.fillRect(l+5,s+10,30,30),e.fillStyle="#2c3e50",$(e,l+10,s-5,20,15,5),e.fillStyle="cyan",e.fillRect(l+12,s,16,2),e.fillStyle="rgba(52, 152, 219, 0.6)",e.strokeStyle="#fff",e.lineWidth=2;let h=1===this.facing?l+25:l-15;$(e,h,s,30,60,5),e.stroke(),e.fillStyle="white",e.font="10px Arial",e.fillText("POLICE",h+2,s+30)}}class ye extends he{constructor(e,t){super(e,t),this.hp=15+2*u.currentLevel,this.w=50,this.h=70,this.color="#9b59b6"}update(){this.vy+=l,this.y+=this.vy;let e=Math.floor((this.y+this.h)/a),t=Math.floor((this.x+this.w/2)/a);e>=0&&e<h&&t>=0&&t<s&&v[e]&&v[e][t]&&(1===v[e][t].type||2===v[e][t].type||3===v[e][t].type)&&(this.y=e*a-this.h,this.vy=0);let i=null,o=9999;if(F)for(let e of F)if(e.health>0){let t=Math.abs(e.x-this.x);t<o&&(o=t,i=e)}i&&o<600&&(this.facing=i.x<this.x?-1:1)}shootBurst(e){if(e)for(let t=0;t<3;t++)setTimeout(()=>{if(this.hp<=0)return;if(e.health<=0)return;let t=Math.atan2(e.y-this.y,e.x-this.x),i=new Q(this.x+this.w/2,this.y+20,1,!1,{pColor:this.color,pType:"normal",isEnemy:!0});i.vx=12*Math.cos(t),i.vy=12*Math.sin(t),i.color="gold",x.push(i),L&&L.play("enemy_shoot")},100*t)}takeDamage(e,t){if(this.hp-=e,K(this.x,this.y,10*e,"gold"),this.hp<=0){let e=this.x,t=this.y;Y(e+this.w/2,t+this.h/2,"gold",3),L&&L.play("explosion"),this.x=-9999,x.push(new le(e,t-50))}}draw(e,t,i,a){let l=this.x-t,s=this.y-i;e.fillStyle="#333",$(e,l,s+10,50,50,10),e.fillStyle="#FFE4C4",$(e,l+10,s-10,30,30,8),e.strokeStyle="#111",e.lineWidth=3,e.beginPath(),e.arc(l+25,s-5,18,Math.PI,0),e.stroke(),e.fillStyle="#222",e.fillRect(l+5,s-8,8,12),e.fillRect(l+37,s-8,8,12),e.strokeStyle="#333",e.lineWidth=2,e.beginPath(),e.moveTo(l+37,s),e.lineTo(l+42,s+5),e.lineTo(l+30,s+10),e.stroke(),e.fillStyle="#555",e.beginPath(),e.arc(l+30,s+10,2,0,2*Math.PI),e.fill(),e.fillStyle="#000",e.beginPath(),e.arc(l+20,s,2,0,2*Math.PI),e.fill(),e.beginPath(),e.arc(l+30,s,2,0,2*Math.PI),e.fill(),e.strokeStyle="rgba(0,0,0,0.2)",e.lineWidth=1,e.beginPath(),e.arc(l+20,s+2,3,0,Math.PI),e.stroke(),e.beginPath(),e.arc(l+30,s+2,3,0,Math.PI),e.stroke(),e.fillStyle="#222",e.save(),e.translate(l+25,s+40),e.fillStyle="#FFE4C4",e.beginPath(),e.arc(-10,0,5,0,2*Math.PI),e.fill(),e.beginPath(),e.arc(10,0,5,0,2*Math.PI),e.fill(),e.fillStyle="#444",$(e,-12,-4,24,12,4),e.restore()}}class de{constructor(e,t){this.x=e,this.y=t,this.w=120,this.h=120,this.hp=50+15*u.currentLevel,this.maxHp=this.hp,this.state="idle",this.timer=0,this.dirY=1}update(){let e=null,t=9999;if(F)for(let i of F)if(i.health>0){let a=Math.abs(i.x-this.x);a<t&&(t=a,e=i)}if(!u.bossActive&&e&&t<800&&(u.bossActive=!0,document.getElementById("bossHealthContainer")&&(document.getElementById("bossHealthContainer").style.display="block")),!u.bossActive)return;this.y+=2*this.dirY,(this.y>2400-this.h-100||this.y<50)&&(this.dirY*=-1),this.timer++;let i=u.currentLevel,a=100;if(i>=5&&(a=80),i>=10&&(a=60),i>=15&&(a=40),this.timer>a){if(!e)return;let t=Math.atan2(e.y-this.y,e.x-this.x),l=8+.2*i,s=new Q(this.x+60,this.y+60,2,!1,{pColor:"#c0392b",pType:"normal",isEnemy:!0});if(s.vx=Math.cos(t)*l,s.vy=Math.sin(t)*l,x.push(s),L&&L.play("enemy_shoot"),i>=3){let e=.2,i=new Q(this.x+60,this.y+60,2,!1,{pColor:"#c0392b",pType:"normal",isEnemy:!0});i.vx=Math.cos(t-e)*l,i.vy=Math.sin(t-e)*l;let a=new Q(this.x+60,this.y+60,2,!1,{pColor:"#c0392b",pType:"normal",isEnemy:!0});a.vx=Math.cos(t+e)*l,a.vy=Math.sin(t+e)*l,x.push(i),x.push(a),L&&L.play("enemy_shoot")}if(i>=6){let e=.4,i=new Q(this.x+60,this.y+60,2,!1,{pColor:"#c0392b",pType:"normal",isEnemy:!0});i.vx=Math.cos(t-e)*l,i.vy=Math.sin(t-e)*l,x.push(i);let a=new Q(this.x+60,this.y+60,2,!1,{pColor:"#c0392b",pType:"normal",isEnemy:!0});a.vx=Math.cos(t+e)*l,a.vy=Math.sin(t+e)*l,x.push(a),L&&L.play("enemy_shoot")}if(i>=10&&this.timer%(2*a)==0){let t=new te(this.x+60,this.y+60);t.vx=.05*(e.x-this.x),t.vy=-5,x.push(t)}this.timer=0}}takeDamage(e,t){if(!u.bossActive)return;this.hp-=e,X(2);let i=this.hp/this.maxHp*100;document.getElementById("bossHealthBar")&&(document.getElementById("bossHealthBar").style.width=i+"%"),K(this.x+60,this.y+60,10*e),this.hp<=0&&(X(50),Y(this.x+60,this.y+60,"#ff00de",5),L&&L.play("explosion"),u.bossActive=!1,document.getElementById("bossHealthContainer")&&(document.getElementById("bossHealthContainer").style.display="none"),x.push(new le(this.x,this.y)),this.x=-9999,u.slowMo=.2,setTimeout(()=>u.slowMo=1,2e3))}draw(e,t,i,a){if(this.hp<=0)return;let l=this.x-t,s=this.y-i,h=0;this.hp<.5*this.maxHp&&(h=4*(Math.random()-.5)),e.save(),e.translate(l+this.w/2+h,s+this.h/2+h),e.fillStyle="#c0392b",$(e,-40,-50,80,100,10),e.fillStyle="rgba(255,255,255,0.2)",e.fillRect(-30,-40,10,80),e.fillStyle="#222",e.beginPath(),e.arc(-45,45,15,0,2*Math.PI),e.fill(),e.beginPath(),e.arc(45,45,15,0,2*Math.PI),e.fill(),e.fillStyle="#555",e.beginPath(),e.arc(-45,45,5,0,2*Math.PI),e.fill(),e.beginPath(),e.arc(45,45,5,0,2*Math.PI),e.fill(),e.strokeStyle="#333",e.lineWidth=15,e.lineCap="round",e.lineJoin="round",e.beginPath(),e.moveTo(0,-50),e.bezierCurveTo(0,-100,-80,-50,-60,0),e.stroke(),e.fillStyle="#222",e.save(),e.translate(-60,0),e.rotate(.5*Math.sin(.1*this.timer)),e.fillRect(-15,-10,30,40),e.fillStyle="#111",e.fillRect(-20,30,40,10),e.restore(),e.fillStyle="#000",e.beginPath(),e.moveTo(-20,-20),e.lineTo(-5,-10),e.lineTo(-20,0),e.fill(),e.beginPath(),e.moveTo(20,-20),e.lineTo(5,-10),e.lineTo(20,0),e.fill(),e.fillStyle="#222";for(let t=0;t<3;t++)e.fillRect(-15,20+8*t,30,4);e.fillStyle="#fff",e.font="bold 20px Arial",e.fillText("VACUUM KING",-70,-70),e.restore()}}class fe{constructor(e,t){this.x=e,this.y=t,this.w=150,this.h=80,this.hp=200+20*u.currentLevel,this.maxHp=this.hp,this.state="fly",this.timer=0,this.vx=2,this.vy=0,this.targetX=e}update(){let e=null,t=9999;if(F)for(let i of F)if(i.health>0){let a=Math.hypot(i.x-this.x,i.y-this.y);a<t&&(t=a,e=i)}if(!u.bossActive&&e&&t<800&&(u.bossActive=!0,document.getElementById("bossHealthContainer")&&(document.getElementById("bossHealthContainer").style.display="block")),!u.bossActive)return;this.timer++,this.y+=2*Math.sin(.05*this.timer),this.timer%60==0&&e&&(this.targetX=e.x),this.x+=.02*(this.targetX-this.x);let i=u.currentLevel;if(!e)return;if(this.timer%10==0){let t=Math.atan2(e.y-this.y,e.x-this.x);t+=.2*(Math.random()-.5);let i=new Q(this.x+75,this.y+60,1,!1,{pColor:"#f1c40f",pType:"normal",isEnemy:!0});i.vx=15*Math.cos(t),i.vy=15*Math.sin(t),x.push(i),L&&L.play("enemy_shoot")}let a=180;if(i>=10&&(a=120),this.timer%a===0){let t=new te(this.x+75,this.y+80);i>=5&&(t.vx=.05*(e.x-this.x)),x.push(t)}i>=15&&(this.x+=.01*(e.x-this.x))}takeDamage(e,t){if(!u.bossActive)return;this.hp-=e;let i=this.hp/this.maxHp*100;document.getElementById("bossHealthBar")&&(document.getElementById("bossHealthBar").style.width=i+"%"),K(this.x+75,this.y+40,10*e,"cyan"),X(2),this.hp<=0&&(X(100),Y(this.x+75,this.y+40,"orange",10),L&&L.play("explosion"),u.bossActive=!1,document.getElementById("bossHealthContainer")&&(document.getElementById("bossHealthContainer").style.display="none"),this.x=-9999,x.push(new le(15400,320)),u.slowMo=.1,setTimeout(()=>u.slowMo=1,3e3))}draw(e,t,i,a){if(this.hp<=0)return;let l=this.x-t,s=this.y-i;e.fillStyle="#2f4f4f",$(e,l,s,140,70,20),e.fillStyle="#3498db",e.beginPath(),e.moveTo(l+10,s+20),e.lineTo(l+40,s+20),e.lineTo(l+40,s+50),e.lineTo(l+15,s+50),e.fill(),e.fillStyle="#000",e.fillRect(l+60,s-10,20,10),e.fillStyle="rgba(0,0,0,0.5)",e.fillRect(l-20,s-15,180,5),e.fillStyle="#111",e.fillRect(l+60,s+70,30,10),this.timer%10<5&&(e.fillStyle="yellow",e.beginPath(),e.arc(l+75,s+85,10,0,2*Math.PI),e.fill()),e.fillStyle="#111",e.fillRect(l+80,s+20,40,30)}}function ge(){t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,e.width,e.height);var i=t.createLinearGradient(0,0,0,e.height);i.addColorStop(0,"#111"),i.addColorStop(1,"#333"),t.fillStyle=i,t.fillRect(0,0,e.width,e.height)}function me(){const i=Date.now();t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,e.width,e.height);var a=t.createLinearGradient(0,0,0,e.height);a.addColorStop(0,"#111"),a.addColorStop(1,"#333"),t.fillStyle=a,t.fillRect(0,0,e.width,e.height);let l=840,s=(e.width-l)/2+35,h=1;l>e.width&&(h=e.width/890),t.save(),t.scale(h,h),h<1&&(s=(e.width/h-l)/2+35),t.font="30px 'Courier New'",t.fillStyle="#00ff41",t.textAlign="center",t.fillText("ROSTER STATUS: "+u.globalUnlocked+" / "+m.length+" HEROES UNLOCKED",e.width/h/2,50);for(let e=0;e<m.length;e++){let a=s+70*(e%12),l=100+70*Math.floor(e/12);if(t.fillStyle="rgba(255,255,255,0.1)",$(t,a-30,l-30,60,60,10),e<u.globalUnlocked){t.save(),t.translate(a,l),t.scale(.8,.8);let s=i/100;Z(t,m[e],s),t.restore(),t.fillStyle="#aaa",t.font="8px Arial",t.fillText(m[e].name.split(" ")[0],a,l+40)}else{t.fillStyle="#222",t.beginPath(),t.arc(a,l,15,0,2*Math.PI),t.fill();let i=(0===e?0:2*e-1)-u.rescues;i<0&&(i=0),t.fillStyle="#555",e===u.globalUnlocked?(t.font="10px Arial",t.fillText("NEXT",a,l-5),t.font="bold 16px Arial",t.fillStyle="#00ff41",t.fillText(i,a,l+12)):(t.font="10px Arial",t.fillText("NEED",a,l-5),t.font="16px Arial",t.fillText(i,a,l+12))}}t.restore()}function ue(){const i=Date.now();let l=(U()-.5)*u.shake,o=(U()-.5)*u.shake;t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,e.width,e.height),function(e){let t=e.createLinearGradient(0,0,0,e.canvas.height);t.addColorStop(0,d),t.addColorStop(1,f),e.fillStyle=t,e.fillRect(0,0,e.canvas.width,e.canvas.height),e.fillStyle="rgba(255, 255, 255, 0.1)",e.beginPath(),e.arc(e.canvas.width-100,100,50,0,2*Math.PI),e.fill()}(t),t.save();let m=u.zoom||1;t.scale(m,m),t.translate(-u.cameraX+l,-u.cameraY+o);let b=e.width/m,T=e.height/m,E=Math.floor(u.cameraX/a),C=E+b/a+4,M=Math.floor(u.cameraY/a),D=M+T/a+4;for(let e=M;e<D&&e<h;e++)for(let l=E;l<C&&l<s;l++)if(v&&v[e]&&v[e][l]&&0!==v[e][l].type){let s=v[e][l],h=l*a,o=e*a;if(6===s.type){t.fillStyle=g,t.fillRect(h+10,o,5,a),t.fillRect(h+25,o,5,a);for(let e=0;e<4;e++)t.fillRect(h+10,o+10*e+2,20,4)}else if(5===s.type)t.fillStyle=s.active?"#00ff41":"#555",t.shadowBlur=20,t.shadowColor=t.fillStyle,t.fillRect(h+15,o+10,5,30),t.beginPath(),t.moveTo(h+20,o+10),t.lineTo(h+35,o+15),t.lineTo(h+20,o+20),t.fill(),t.shadowBlur=0,t.fillStyle="#333",t.fillRect(h+5,o+35,30,5);else if(4===s.type)if("#e74c3c"===s.color)t.fillStyle=s.color,t.fillRect(h,o+10,a,30),t.fillStyle="orange",t.beginPath(),t.arc(h+40*U(),o+10,5,0,2*Math.PI),t.fill();else{let e=t.createLinearGradient(h,o,h,o+a);e.addColorStop(0,"#ccc"),e.addColorStop(1,"#555"),t.fillStyle=e,t.beginPath(),t.moveTo(h,o+a),t.lineTo(h+10,o),t.lineTo(h+20,o+a),t.lineTo(h+30,o),t.lineTo(h+40,o+a),t.fill()}else if(1===s.type){let i=n;"city"===u.levelData.biome&&(i="#333"),"volcano"===u.levelData.biome&&(i="#422"),t.fillStyle=i,t.fillRect(h,o,a,a),"city"===u.levelData.biome?(t.fillStyle="#444",t.fillRect(h,o+35,40,5)):(t.fillStyle=r,t.fillRect(h+5,o+5,10,10),t.fillRect(h+25,o+20,8,8)),e>0&&0===v[e-1][l].type&&("city"===u.levelData.biome?t.fillStyle="#555":"volcano"===u.levelData.biome?t.fillStyle="#722":t.fillStyle=c,t.fillRect(h,o,a,8))}else if(2===s.type){let e=p;"city"===u.levelData.biome&&(e="#222"),t.fillStyle=e,t.fillRect(h,o,a,a),t.strokeStyle=y,t.lineWidth=2,t.beginPath(),t.moveTo(h,o+20),t.lineTo(h+a,o+20),t.stroke()}else 3===s.type?(t.fillStyle="#34495e",t.fillRect(h,o,a,a),t.fillStyle=(Math.floor(i/1e3)+l+e)%3==0?"yellow":"#2c3e50",t.fillRect(h+10,o+10,8,12),t.fillRect(h+22,o+10,8,12),t.strokeStyle="#2c3e50",t.lineWidth=2,t.strokeRect(h,o,a,a)):9===s.type&&(t.fillStyle="gold",t.shadowBlur=30,t.shadowColor="gold",t.fillRect(h,o,a,a),t.shadowBlur=0,t.fillStyle="#000",t.font="10px Arial",t.fillText("VAN",h+5,o+25))}k.forEach(e=>e.draw(t,0,0,i)),x.forEach(e=>e.draw(t,0,0,i)),F&&F.forEach(e=>{e.health>0&&e.draw(t,0,0,i)}),w.forEach(e=>e.draw(t,0,0,i)),t.font="900 20px 'Segoe UI'",t.lineWidth=3,S.forEach(e=>{t.fillStyle=e.color,t.strokeStyle="black",t.strokeText(e.text,e.x,e.y),t.fillText(e.text,e.x,e.y)}),t.restore();var A=t.createRadialGradient(e.width/2,e.height/2,200,e.width/2,e.height/2,600);A.addColorStop(0,"transparent"),A.addColorStop(1,"rgba(0,0,0,0.6)"),t.fillStyle=A,t.fillRect(0,0,e.width,e.height)}function ve(e,t){t.owner=e;let i=new Q(e.x+(e.facing>0?e.w:0),e.y+e.h/2-5,e.facing,!1,t);return x.push(i),i}function xe(e,t,i,a=40,l=0){let s=new ee(e.x+(1===e.facing?e.w+l:-t-l),e.y+(e.h-a)/2,t,a,e,i);return x.push(s),s}function we(e){L&&L.play(e)}const Se=(e,t)=>i=>{i.x+=i.vx,i.y+=Math.sin(i.x*e)*t},ke=e=>e=>{if(0===e.returnState)e.x+=e.vx,e.vx*=.95,Math.abs(e.vx)<1&&(e.returnState=1);else{let t=e.owner;if(!t)return void(e.life=0);let i=t.x+t.w/2-e.x,a=t.y+t.h/2-e.y,l=Math.atan2(a,i);e.x+=15*Math.cos(l),e.y+=15*Math.sin(l),Math.hypot(i,a)<20&&(e.life=0)}},Fe=e=>t=>{let i=null,a=300;for(let e of x)if(e.hp&&e.hp>0&&e!==t.owner&&e!==t){let l=Math.hypot(e.x-t.x,e.y-t.y);l<a&&(a=l,i=e)}if(i){let a=Math.atan2(i.y-t.y,i.x-t.x);t.vx+=Math.cos(a)*e,t.vy+=Math.sin(a)*e;let l=Math.hypot(t.vx,t.vy);l>15&&(t.vx=t.vx/l*15,t.vy=t.vy/l*15)}t.x+=t.vx,t.y+=t.vy},be=(e,t)=>(i,a,l,s,h)=>{i.fillStyle=e,i.beginPath(),i.arc(l+a.w/2,s+a.h/2,t,0,2*Math.PI),i.fill()},Te=e=>(t,i,a,l,s)=>{t.fillStyle=e,t.fillRect(a,l,i.w,i.h)},Ee=e=>(t,i,a,l,s)=>{t.fillStyle=e,t.shadowBlur=10,t.shadowColor=e,t.fillRect(a,l,i.w,i.h),t.shadowBlur=0},Ce=e=>(t,i,a,l,s)=>{t.save(),t.translate(a+i.w/2,l+i.h/2),t.rotate(.1*s),t.fillStyle=e,t.beginPath();for(let e=0;e<5;e++)t.lineTo(10*Math.cos((18+72*e)/180*Math.PI),10*-Math.sin((18+72*e)/180*Math.PI)),t.lineTo(5*Math.cos((54+72*e)/180*Math.PI),5*-Math.sin((54+72*e)/180*Math.PI));t.fill(),t.restore()},Me=e=>(t,i,a,l,s)=>{t.fillStyle=e,t.font="20px Arial",t.fillText("‚ô™",a,l+15)},De={pug:{shoot:e=>{we("shoot"),ve(e,{pColor:"#f00",vx:25*e.facing,w:40,h:4,damage:2,renderer:Ee("red")})},special:e=>{we("shoot"),ve(e,{pColor:"#f00",vx:30*e.facing,w:400,h:20,damage:10,life:10,renderer:Ee("#ffaaaa")}),X(5)}},raccoon:{shoot:e=>{we("throw"),ve(e,{vx:15*e.facing,w:20,h:20,life:100,damage:2,behavior:ke(1),renderer:(e,t,i,a,l)=>{e.save(),e.translate(i+10,a+10),e.rotate(.3*l),e.fillStyle="#888",e.beginPath(),e.arc(0,0,10,0,2*Math.PI),e.fill(),e.fillStyle="#555",e.beginPath(),e.arc(0,0,3,0,2*Math.PI),e.fill(),e.restore()}})},special:e=>{ve(e,{vx:5*e.facing,vy:-5,w:40,h:40,damage:10}).type="grenade"}},cat:{shoot:e=>{xe(e,50,2),we("hit")},special:e=>{ve(e,{vx:10*e.facing,vy:-2,w:30,h:30,damage:5,type:"grenade",renderer:be("#5d4037",15)})}},corgi:{shoot:e=>{ve(e,{vx:18*e.facing,w:20,h:20,damage:3,behavior:ke(1),renderer:(e,t,i,a,l)=>{e.fillStyle="#ccc",e.fillRect(i,a,15,10),e.fillStyle="#855e42",e.fillRect(i+5,a+10,5,10)}})},special:e=>{for(let t=0;t<5;t++)ve(e,{x:e.x+(40*t-80),y:e.y-200,vx:0,vy:30,w:10,h:200,damage:8,renderer:Ee("cyan")});X(10)}},hulk:{shoot:e=>{xe(e,60,4),X(2)},special:e=>{ve(e,{vx:10*e.facing,w:100,h:100,damage:5,life:20,renderer:be("rgba(0,255,0,0.5)",50)}).vx=5*e.facing,X(10)}},spider:{shoot:e=>{ve(e,{vx:20*e.facing,w:10,h:10,damage:1,renderer:be("white",5)})},special:e=>{for(let t=-2;t<=2;t++)ve(e,{vx:15*e.facing,vy:2*t,w:10,h:10,damage:2,renderer:be("white",5)})}},wolvie:{shoot:e=>{xe(e,40,3,20)},special:e=>{e.vx=15*e.facing,xe(e,80,5,40)}},dead:{shoot:e=>{ve(e,{vx:20*e.facing,w:5,h:5,damage:2,renderer:Te("yellow")}),setTimeout(()=>ve(e,{vx:20*e.facing,w:5,h:5,damage:2,renderer:Te("yellow")}),100)},special:e=>{ve(e,{vx:10*e.facing,vy:-8,w:15,h:15,damage:10,type:"grenade"})}},cap:{shoot:e=>{ve(e,{vx:15*e.facing,w:20,h:20,damage:3,behavior:ke(1),renderer:be("blue",10)})},special:e=>{e.invincible=60,e.vx=20*e.facing,xe(e,60,5)}},ironmouse:{shoot:e=>{ve(e,{vx:20*e.facing,w:10,h:4,damage:2,renderer:Ee("yellow")})},special:e=>{ve(e,{vx:30*e.facing,w:200,h:30,damage:15,renderer:Ee("white")})}},widow:{shoot:e=>{xe(e,40,2)},special:e=>{ve(e,{vx:25*e.facing,w:50,h:50,damage:6,renderer:be("cyan",20)})}},hawkeye:{shoot:e=>{ve(e,{vx:25*e.facing,w:20,h:3,damage:3,renderer:Te("purple")})},special:e=>{ve(e,{vx:20*e.facing,w:20,h:5,damage:10,type:"rocket"})}},strange:{shoot:e=>{ve(e,{vx:10*e.facing,w:15,h:15,damage:3,behavior:Se(.1,5),renderer:Ce("orange")})},special:e=>{ve(e,{vx:5*e.facing,w:60,h:60,damage:8,life:100,renderer:be("orange",30)})}},panther:{shoot:e=>{xe(e,40,3)},special:e=>{ve(e,{vx:0,vy:0,w:100,h:100,damage:10,life:10,renderer:be("purple",50)})}},ant:{shoot:e=>{xe(e,30,2)},special:e=>{e.invincible=60,X(5),xe(e,100,10)}},starlord:{shoot:e=>{let t=Math.random()<.5?"red":"yellow";ve(e,{vx:20*e.facing,w:8,h:8,damage:3,renderer:be(t,4)})},special:e=>{ve(e,{vx:10*e.facing,vy:-5,w:20,h:20,damage:8,type:"grenade",renderer:be("purple",10)})}},gamora:{shoot:e=>{xe(e,50,4)},special:e=>{e.x+=100*e.facing,xe(e,60,8)}},drax:{shoot:e=>{xe(e,40,4)},special:e=>{ve(e,{vx:20*e.facing,vy:-2,w:15,h:5,damage:5,renderer:Te("grey")}),ve(e,{vx:20*e.facing,vy:2,w:15,h:5,damage:5,renderer:Te("grey")})}},groot:{shoot:e=>{xe(e,60,3)},special:e=>{ve(e,{vx:15*e.facing,w:100,h:10,damage:6,life:20,renderer:Te("brown")})}},rocket:{shoot:e=>{ve(e,{vx:20*e.facing,w:10,h:10,damage:4,renderer:Ee("orange")})},special:e=>{ve(e,{vx:15*e.facing,w:20,h:10,damage:15,type:"rocket"})}},vision:{shoot:e=>{ve(e,{vx:25*e.facing,w:30,h:5,damage:4,renderer:Ee("yellow")})},special:e=>{e.invincible=60,xe(e,50,8)}},scarlet:{shoot:e=>{ve(e,{vx:12*e.facing,w:15,h:15,damage:4,behavior:Fe(1),renderer:be("red",8)})},special:e=>{for(let t=0;t<10;t++)ve(e,{vx:20*(Math.random()-.5),vy:20*(Math.random()-.5),w:20,h:20,damage:5,renderer:be("red",10)})}},quick:{shoot:e=>{xe(e,30,1),setTimeout(()=>xe(e,30,1),100)},special:e=>{e.vx=30*e.facing,xe(e,100,5)}},winter:{shoot:e=>{ve(e,{vx:25*e.facing,w:10,h:5,damage:4,renderer:Te("grey")})},special:e=>{xe(e,50,10),X(5)}},falcon:{shoot:e=>{ve(e,{vx:20*e.facing,w:8,h:8,damage:3,renderer:Te("red")})},special:e=>{ve(e,{x:e.x+100*e.facing,y:e.y-100,vx:0,vy:10,w:20,h:20,damage:8,renderer:be("grey",10)})}},war:{shoot:e=>{ve(e,{vx:20*e.facing,w:12,h:12,damage:5,renderer:Te("grey")})},special:e=>{ve(e,{vx:15*e.facing,vy:-2,w:15,h:15,damage:12,type:"rocket"})}},dare:{shoot:e=>{xe(e,40,3)},special:e=>{ve(e,{vx:0,vy:0,w:100,h:100,damage:5,life:5,renderer:be("red",50)})}},punish:{shoot:e=>{ve(e,{vx:22*e.facing,w:6,h:6,damage:3,renderer:Te("white")})},special:e=>{ve(e,{vx:12*e.facing,vy:-5,w:12,h:12,damage:10,type:"grenade"})}},shang:{shoot:e=>{xe(e,40,3)},special:e=>{ve(e,{vx:20*e.facing,w:30,h:30,damage:8,renderer:be("gold",15)})}},eternal:{shoot:e=>{ve(e,{vx:18*e.facing,w:15,h:15,damage:4,renderer:be("gold",8)})},special:e=>{xe(e,80,8),X(5)}},moon:{shoot:e=>{ve(e,{vx:15*e.facing,w:15,h:15,damage:3,behavior:ke(1),renderer:be("white",8)})},special:e=>{e.vy=-5,xe(e,50,5)}},shehulk:{shoot:e=>{xe(e,50,4)},special:e=>{e.vy=20,ve(e,{vx:0,vy:0,w:100,h:40,damage:8,life:10,renderer:Te("green")})}},ghost:{shoot:e=>{ve(e,{vx:20*e.facing,w:40,h:5,damage:4,renderer:Te("orange")})},special:e=>{for(let t=0;t<3;t++)ve(e,{vx:15*e.facing,vy:5*(t-1),w:20,h:20,damage:6,renderer:be("orange",10)})}},unicorncyborg:{shoot:e=>{ve(e,{vx:30*e.facing,w:40,h:5,damage:5,renderer:Ee("pink")})},special:e=>{for(let t=0;t<5;t++)ve(e,{vx:20*e.facing,vy:3*(t-2),w:10,h:10,damage:4,renderer:Te(["red","orange","yellow","green","blue"][t])})}},creaturehedgehog:{shoot:e=>{ve(e,{vx:20*e.facing,w:10,h:4,damage:3,renderer:Te("green")})},special:e=>{for(let t=0;t<8;t++){let i=t*(Math.PI/4);ve(e,{vx:15*Math.cos(i),vy:15*Math.sin(i),w:10,h:4,damage:4,renderer:Te("green")})}}},storestump:{shoot:e=>{ve(e,{vx:10*e.facing,vy:0,w:20,h:20,damage:4,type:"grenade",renderer:be("brown",10)})},special:e=>{ve(e,{vx:12*e.facing,w:40,h:20,damage:10,renderer:Te("brown")})}},galaxygod:{shoot:e=>{ve(e,{vx:20*e.facing,w:15,h:15,damage:5,renderer:Ce("yellow")})},special:e=>{ve(e,{vx:5*e.facing,w:40,h:40,damage:1,life:100,renderer:be("black",20)})}},wraithhouse:{shoot:e=>{ve(e,{vx:15*e.facing,w:20,h:20,damage:4,renderer:be("rgba(255,255,255,0.5)",10)})},special:e=>{ve(e,{vx:10*e.facing,w:10,h:40,damage:8,life:30,renderer:Te("white"),type:"sonic_wave"})}},ninjakangaroo:{shoot:e=>{xe(e,50,4)},special:e=>{for(let t=0;t<3;t++)ve(e,{vx:20*e.facing,vy:5*(t-1),w:15,h:15,damage:3,type:"shuriken"})}},devilcastle:{shoot:e=>{ve(e,{vx:15*e.facing,w:20,h:20,damage:4,type:"fireball"})},special:e=>{ve(e,{vx:0,vy:10,w:40,h:60,damage:10,renderer:Te("grey")})}},aquaalpaca:{shoot:e=>{ve(e,{vx:15*e.facing,w:10,h:10,damage:3,renderer:be("cyan",5)})},special:e=>{ve(e,{vx:10*e.facing,w:40,h:40,damage:8,life:40,renderer:be("blue",20)})}},makeupgate:{shoot:e=>{ve(e,{vx:12*e.facing,w:20,h:20,damage:2,renderer:be("pink",10)})},special:e=>{xe(e,60,5)}},alienboulder:{shoot:e=>{ve(e,{vx:15*e.facing,w:20,h:20,damage:5,renderer:be("grey",10)})},special:e=>{ve(e,{vx:10*e.facing,vy:10,w:30,h:30,damage:10,renderer:be("green",15)})}},skeletonram:{shoot:e=>{ve(e,{vx:15*e.facing,vy:-5,w:20,h:10,damage:3,type:"grenade",renderer:Te("white")})},special:e=>{e.vx=20*e.facing,xe(e,60,8)}},aquariumforest:{shoot:e=>{ve(e,{vx:20*e.facing,w:10,h:10,damage:3,renderer:be("blue",5)})},special:e=>{ve(e,{vx:15*e.facing,vy:5*(Math.random()-.5),w:20,h:10,damage:6,renderer:Te("orange")})}},darklog:{shoot:e=>{ve(e,{vx:15*e.facing,w:20,h:10,damage:4,renderer:Te("black")})},special:e=>{ve(e,{vx:5*e.facing,w:60,h:60,damage:2,life:60,renderer:be("rgba(0,0,0,0.5)",30)})}},factoryskeleton:{shoot:e=>{ve(e,{vx:15*e.facing,w:20,h:10,damage:4,behavior:ke(1),renderer:Te("grey")})},special:e=>{ve(e,{vx:10*e.facing,w:30,h:30,damage:8,life:40,renderer:be("grey",15)})}},defenderroof:{shoot:e=>{ve(e,{vx:20*e.facing,w:15,h:5,damage:3,renderer:Te("brown")})},special:e=>{ve(e,{vx:0,vy:10,w:80,h:20,damage:10,renderer:Te("brown")})}},robbereagle:{shoot:e=>{ve(e,{vx:15*e.facing,w:15,h:15,damage:3,renderer:be("gold",8)})},special:e=>{e.vy=20,xe(e,40,8)}},professorskunk:{shoot:e=>{ve(e,{vx:12*e.facing,vy:-5,w:10,h:10,damage:5,type:"grenade",renderer:be("green",5)})},special:e=>{ve(e,{vx:0,vy:0,w:100,h:50,damage:1,life:100,renderer:be("rgba(0,255,0,0.3)",40)})}},earthbuffalo:{shoot:e=>{ve(e,{vx:15*e.facing,w:20,h:20,damage:5,renderer:be("brown",10)})},special:e=>{X(10),xe(e,100,5)}},ogreguinea:{shoot:e=>{xe(e,50,4)},special:e=>{ve(e,{vx:12*e.facing,vy:-5,w:30,h:30,damage:8,type:"grenade",renderer:be("grey",15)})}},artistalien:{shoot:e=>{ve(e,{vx:20*e.facing,w:10,h:10,damage:3,renderer:be(["red","blue","green"][Math.floor(3*Math.random())],5)})},special:e=>{for(let t=0;t<5;t++)ve(e,{vx:15*e.facing,vy:10*(Math.random()-.5),w:15,h:15,damage:4,renderer:be("purple",8)})}},firedonkey:{shoot:e=>{xe(e,40,3)},special:e=>{for(let t=0;t<3;t++)ve(e,{vx:15*e.facing,vy:2*(t-1),w:20,h:20,damage:5,type:"fireball"})}},fighterhawk:{shoot:e=>{ve(e,{vx:25*e.facing,w:15,h:5,damage:4,renderer:Te("grey")})},special:e=>{ve(e,{vx:10*e.facing,vy:5,w:20,h:10,damage:10,type:"rocket"})}},trollpeacock:{shoot:e=>{for(let t=-1;t<=1;t++)ve(e,{vx:15*e.facing,vy:5*t,w:10,h:10,damage:2,renderer:be("purple",5)})},special:e=>{ve(e,{vx:10*e.facing,w:50,h:50,damage:1,life:60,renderer:be("pink",25)})}},detectivemonkey:{shoot:e=>{xe(e,40,3)},special:e=>{ve(e,{vx:30*e.facing,w:50,h:5,damage:6,renderer:Ee("yellow")})}},homelizard:{shoot:e=>{ve(e,{vx:20*e.facing,w:30,h:5,damage:3,life:10,renderer:Te("pink")})},special:e=>{e.invincible=60}},headsmanshark:{shoot:e=>{xe(e,50,5)},special:e=>{ve(e,{vx:15*e.facing,w:30,h:30,damage:8,behavior:ke(1),renderer:Te("grey")})}},caferaven:{shoot:e=>{ve(e,{vx:15*e.facing,w:15,h:15,damage:3,renderer:Te("black")})},special:e=>{for(let t=0;t<5;t++)ve(e,{vx:10*e.facing+5*Math.random(),vy:-5,w:5,h:5,damage:2,type:"grenade",renderer:be("brown",3)})}},phoenixdemon:{shoot:e=>{ve(e,{vx:18*e.facing,w:20,h:10,damage:4,type:"fireball"})},special:e=>{ve(e,{vx:0,vy:0,w:100,h:100,damage:10,life:20,renderer:be("orange",50)}),e.health=Math.min(e.health+1,3)}},alienlion:{shoot:e=>{ve(e,{vx:15*e.facing,w:15,h:40,damage:3,type:"sonic_wave"})},special:e=>{ve(e,{vx:25*e.facing,w:100,h:20,damage:8,renderer:Ee("cyan")})}},paintervillain:{shoot:e=>{xe(e,50,3)},special:e=>{ve(e,{vx:10*e.facing,w:30,h:30,damage:5,life:100,renderer:be("red",15)})}},mageslime:{shoot:e=>{ve(e,{vx:15*e.facing,w:15,h:15,damage:3,renderer:be("green",8)})},special:e=>{ve(e,{vx:15*e.facing,vy:-5,w:10,h:10,damage:4,type:"acid_spit"}),ve(e,{vx:15*e.facing,vy:5,w:10,h:10,damage:4,type:"acid_spit"})}},journalistceiling:{shoot:e=>{ve(e,{vx:15*e.facing,w:10,h:20,damage:3,renderer:Te("black")})},special:e=>{X(5),ve(e,{vx:20*e.facing,w:60,h:40,damage:6,renderer:Te("white")})}},bakerhamster:{shoot:e=>{xe(e,50,3)},special:e=>{ve(e,{vx:15*e.facing,vy:-5,w:20,h:10,damage:8,type:"grenade",renderer:be("orange",10)})}},zombiefish:{shoot:e=>{xe(e,30,4)},special:e=>{ve(e,{vx:5*e.facing,w:50,h:50,damage:1,life:60,renderer:be("green",25)})}},chefdeer:{shoot:e=>{ve(e,{vx:20*e.facing,w:15,h:5,damage:3,renderer:Te("silver")})},special:e=>{xe(e,60,8)}},resortstone:{shoot:e=>{xe(e,50,3)},special:e=>{ve(e,{vx:10*e.facing,vy:-5,w:30,h:30,damage:5,type:"grenade",renderer:be("red",15)})}},hospitalchipmunk:{shoot:e=>{xe(e,30,3)},special:e=>{e.health=Math.min(e.health+1,3),K(e.x,e.y-20,"HEAL","green")}},mutantkoala:{shoot:e=>{xe(e,40,4)},special:e=>{ve(e,{vx:15*e.facing,w:15,h:15,damage:6,renderer:be("lime",8)})}},directordirt:{shoot:e=>{ve(e,{vx:15*e.facing,w:20,h:30,damage:3,type:"sonic_wave"})},special:e=>{X(10),ve(e,{vx:0,vy:0,w:200,h:200,damage:2,life:10,renderer:Te("rgba(0,0,0,0.5)")})}},spectrebison:{shoot:e=>{ve(e,{vx:15*e.facing,w:20,h:20,damage:4,renderer:be("white",10)})},special:e=>{e.invincible=60,e.vx=20*e.facing,xe(e,80,6)}},convictchicken:{shoot:e=>{ve(e,{vx:15*e.facing,vy:5,w:10,h:10,damage:3,renderer:be("white",5)})},special:e=>{for(let t=0;t<5;t++)ve(e,{vx:20*(Math.random()-.5),vy:-10,w:10,h:10,damage:3,type:"grenade"})}},innmud:{shoot:e=>{ve(e,{vx:12*e.facing,w:20,h:20,damage:3,renderer:be("brown",10)})},special:e=>{ve(e,{vx:10*e.facing,w:60,h:20,damage:5,life:60,renderer:Te("brown")})}},killerdonkey:{shoot:e=>{xe(e,50,4)},special:e=>{e.vx=25*e.facing,xe(e,60,8)}},professorkangaroo:{shoot:e=>{ve(e,{vx:15*e.facing,w:15,h:15,damage:3,renderer:Te("blue")})},special:e=>{ve(e,{vx:10*e.facing,vy:-5,w:30,h:30,damage:10,type:"grenade",renderer:Te("blue")})}},paramedicpeacock:{shoot:e=>{xe(e,30,4)},special:e=>{ve(e,{vx:15*e.facing,w:40,h:40,damage:5,type:"sonic_wave"})}},restaurantwolf:{shoot:e=>{ve(e,{vx:20*e.facing,w:15,h:5,damage:3,renderer:Te("white")})},special:e=>{e.vx=20*e.facing,xe(e,60,5)}},knightsheep:{shoot:e=>{xe(e,60,4)},special:e=>{e.vx=25*e.facing,xe(e,80,8)}},ranchwombat:{shoot:e=>{xe(e,40,3)},special:e=>{ve(e,{vx:15*e.facing,vy:-10,w:20,h:20,damage:6,type:"grenade",renderer:be("grey",10)})}},murdererforest:{shoot:e=>{xe(e,50,4)},special:e=>{for(let t=0;t<3;t++)ve(e,{vx:15*e.facing,vy:5*(t-1),w:15,h:5,damage:4,renderer:Te("green")})}},nightllama:{shoot:e=>{ve(e,{vx:18*e.facing,w:10,h:10,damage:3,renderer:be("white",5)})},special:e=>{ve(e,{vx:10*e.facing,w:60,h:60,damage:5,life:60,renderer:be("black",30)})}},musicianturkey:{shoot:e=>{ve(e,{vx:15*e.facing,w:15,h:15,damage:3,renderer:Me("black")})},special:e=>{ve(e,{vx:20*e.facing,w:50,h:50,damage:8,type:"sonic_wave"})}},oozecrow:{shoot:e=>{ve(e,{vx:15*e.facing,w:15,h:15,damage:3,renderer:be("purple",8)})},special:e=>{for(let t=0;t<5;t++)ve(e,{vx:10*(Math.random()-.5),vy:-10,w:10,h:10,damage:3,type:"grenade",renderer:be("green",5)})}},lordblob:{shoot:e=>{xe(e,40,5)},special:e=>{e.vy=-10,setTimeout(()=>{e.vy=20,xe(e,80,10)},200)}},shadowpanda:{shoot:e=>{xe(e,40,4)},special:e=>{ve(e,{vx:20*e.facing,w:30,h:30,damage:6,renderer:Te("black")})}},spyboulder:{shoot:e=>{ve(e,{vx:25*e.facing,w:5,h:5,damage:4,renderer:Te("black")})},special:e=>{ve(e,{vx:15*e.facing,w:10,h:10,damage:10,type:"grenade",renderer:be("red",5)})}},stylistearth:{shoot:e=>{xe(e,30,3)},special:e=>{ve(e,{vx:20*e.facing,w:40,h:40,damage:2,life:30,renderer:be("white",20)})}},sparock:{shoot:e=>{ve(e,{vx:15*e.facing,w:20,h:10,damage:3,renderer:be("grey",10)})},special:e=>{ve(e,{vx:0,vy:-2,w:80,h:80,damage:1,life:100,renderer:be("rgba(255,255,255,0.3)",40)})}},farmpig:{shoot:e=>{ve(e,{vx:15*e.facing,w:15,h:15,damage:3,renderer:be("brown",8)})},special:e=>{e.vx=20*e.facing,xe(e,60,6)}},guardbrick:{shoot:e=>{xe(e,30,3)},special:e=>{ve(e,{vx:0,vy:0,w:20,h:60,damage:5,life:100,renderer:Te("grey")})}},sunpegasus:{shoot:e=>{ve(e,{vx:25*e.facing,w:20,h:5,damage:4,renderer:Ee("gold")})},special:e=>{ve(e,{vx:0,vy:0,w:200,h:200,damage:10,life:5,renderer:be("white",100)})}},shopstone:{shoot:e=>{ve(e,{vx:15*e.facing,w:10,h:10,damage:2,renderer:Te("white")})},special:e=>{for(let t=0;t<5;t++)ve(e,{vx:15*e.facing,vy:10*(Math.random()-.5),w:10,h:10,damage:3,renderer:be("gold",5)})}},princemonster:{shoot:e=>{ve(e,{vx:18*e.facing,w:15,h:5,damage:4,renderer:Ee("purple")})},special:e=>{ve(e,{vx:10*e.facing,w:20,h:40,damage:6,life:60,renderer:Te("grey")})}},directorreindeer:{shoot:e=>{ve(e,{vx:20*e.facing,w:20,h:15,damage:3,renderer:Te("black")})},special:e=>{ve(e,{vx:15*e.facing,w:60,h:60,damage:8,type:"rocket"})}},policecroc:{shoot:e=>{xe(e,50,5)},special:e=>{ve(e,{vx:20*e.facing,w:20,h:10,damage:2,renderer:be("silver",10)})}},composerfrog:{shoot:e=>{ve(e,{vx:15*e.facing,w:15,h:15,damage:3,renderer:Me("green")})},special:e=>{for(let t=0;t<3;t++)ve(e,{vx:15*e.facing,vy:3*(t-1),w:15,h:15,damage:4,renderer:Me("green")})}},nunturtle:{shoot:e=>{xe(e,40,3)},special:e=>{ve(e,{vx:20*e.facing,w:30,h:30,damage:6,renderer:be("yellow",15)})}},homepumpkin:{shoot:e=>{ve(e,{vx:15*e.facing,w:8,h:8,damage:3,renderer:be("orange",4)})},special:e=>{ve(e,{vx:10*e.facing,w:80,h:20,damage:5,life:40,renderer:Te("green")})}}};class Ae{constructor(e=0){this.index=e,this.reset(),this.charData=m[e%m.length]}setCharacter(e){this.charData=m.find(t=>t.id===e)||m[0],0===this.index&&B()}reset(){this.x=u.spawnPoint.x+20*this.index,this.y=u.spawnPoint.y,this.w=24,this.h=30,this.vx=0,this.vy=0,this.speed=5,this.grounded=!1,this.facing=1,this.health=3,this.invincible=0,this.stretchX=1,this.stretchY=1,this.animFrame=0,this.lastY=this.y,this.secondaryCooldown=0,this.shootCooldown=0,this.specialCooldown=0,this.attackAnim={type:null,timer:0,max:0},this.wallJumpLocked=!1}respawn(){if(u.lives--,B(),u.lives<=0)return u.running=!1,document.getElementById("ovTitle").innerText="MISSION FAILED",document.getElementById("ovTitle").style.color="red",document.getElementById("ovMsg").innerText="Out of lives. The pound awaits.",void(document.getElementById("gameOverOverlay").style.display="flex");let e=m.slice(0,u.globalUnlocked),t=Math.floor(U()*e.length);this.setCharacter(e[t].id),this.x=u.spawnPoint.x,this.y=u.spawnPoint.y-40,this.vx=0,this.vy=0,this.health=3,this.invincible=120,Y(this.x,this.y,"#00ff41",2),L&&L.play("powerup")}checkWall(e){if(!v)return!1;let t=e>0?this.x+this.w+2:this.x-2,i=[this.y,this.y+this.h/2,this.y+this.h-1];for(let e of i){let i=Math.floor(e/a),l=Math.floor(t/a);if(i>=0&&i<h&&l>=0&&l<s&&v[i]&&v[i][l]&&(1===v[i][l].type||2===v[i][l].type||3===v[i][l].type))return!0}return!1}update(){this.lastY=this.y,this.secondaryCooldown>0&&this.secondaryCooldown--,this.attackAnim.timer>0&&this.attackAnim.timer--;let e=E[this.index]||{};if(e.f)return this.vx=0,this.attackAnim={type:"flex",timer:10,max:10},u.frame%10==0&&(K(this.x,this.y-20,"FLEX!","gold"),X(2)),this.vy+=l,this.y+=this.vy,void this.checkCollisions(!1);let t=Math.floor((this.x+this.w/2)/a),i=Math.floor((this.y+this.h/2)/a),o=i>=0&&i<h&&t>=0&&t<s&&v[i]&&v[i][t]&&6===v[i][t].type,n=0;(e.arrowleft||e.a)&&(n=-1),(e.arrowright||e.d)&&(n=1),(e.c||e.v)&&this.secondaryCooldown<=0&&(this.performSecondary(),this.secondaryCooldown=30);let c=e.shift;this.speed=c?9:5;let p=0;this.checkWall(-1)&&(p=-1),this.checkWall(1)&&(p=1);let y=!1;if(!this.grounded&&0!==p&&n===p&&this.vy>0&&(y=!0,this.vy>2&&(this.vy=2),e[" "]&&!this.wallJumpLocked&&(this.vy=-13,L&&L.play("jump"),this.vx=10*-p,this.wallJumpLocked=!0,this.facing=-p,Y(this.x+(p>0?this.w:0),this.y+this.h/2,r,.5),y=!1)),e[" "]||(this.wallJumpLocked=!1),o){if(this.vy=0,0!==n)this.vx=3*n;else{let e=t*a+(a-this.w)/2;this.vx=.2*(e-this.x)}(e.arrowup||e.w)&&(this.vy=-3),(e.arrowdown||e.s)&&(this.vy=3),e[" "]&&(this.vy=-13,L&&L.play("jump"))}else{if(!this.wallJumpLocked){if(0!==n){this.vx+=.8*n,this.facing=n,this.animFrame+=c?2:1;let e=c?5:10;this.grounded&&this.animFrame%e===0&&w.push(new V(this.x+15,this.y+30,"#d2b48c"))}else this.vx*=.85,this.animFrame=0;Math.abs(this.vx)>this.speed&&(this.vx=Math.sign(this.vx)*this.speed)}e[" "]&&this.grounded&&!y&&(this.vy=-13,this.grounded=!1,this.stretchX=.7,this.stretchY=1.3,L&&L.play("jump")),this.vy+=l,this.vy>15&&(this.vy=15)}if(y&&u.frame%5==0&&w.push(new V(this.x+(p>0?this.w:0),this.y+this.h,"#fff")),this.shootCooldown>0&&this.shootCooldown--,this.specialCooldown>0&&this.specialCooldown--,(e.z||e.j)&&this.shootCooldown<=0){let t=e.arrowdown||e.s,i=e.arrowup||e.w;this.shoot(!1,t,i),this.shootCooldown=15}(e.x||e.k)&&this.specialCooldown<=0&&(this.shoot(!0,!1),this.specialCooldown=120),this.x+=this.vx,this.checkCollisions(!0),this.y+=this.vy,this.checkCollisions(!1),this.stretchX+=.1*(1-this.stretchX),this.stretchY+=.1*(1-this.stretchY),this.invincible>0&&this.invincible--,this.y>2600&&this.takeDamage(99)}checkCollisions(e){if(!v)return;let t=Math.floor(this.x/a),i=Math.floor((this.x+this.w-.01)/a),l=Math.floor(this.y/a),o=Math.floor((this.y+this.h-.01)/a);for(let n=l;n<=o;n++)for(let l=t;l<=i;l++)if(n>=0&&n<h&&l>=0&&l<s&&v[n]&&v[n][l]&&0!==v[n][l].type){let t=v[n][l].type;if(6===t)continue;if(4===t)return void this.takeDamage();if(9===t)return void O();if(5===t){v[n][l].active||(v[n][l].active=!0,u.checkpointsHit++,u.spawnPoint={x:l*a,y:n*a-40},Y(l*a+20,n*a+20,"#00ff41",2),this.health<3&&(this.health=3),B());continue}if(1===t||2===t||3===t)if(e)this.vx>0?(this.x=l*a-this.w,this.vx=0):this.vx<0&&(this.x=l*a+a,this.vx=0);else if(this.vy>0){if(this.lastY+this.h<=n*a+15)return this.y=n*a-this.h,this.vy=0,this.grounded||(this.stretchX=1.4,this.stretchY=.6),void(this.grounded=!0)}else if(this.vy<0)return this.y=n*a+a,void(this.vy=0)}}takeDamage(e=1){this.invincible>0||(this.health-=e,X(15),this.invincible=60,Y(this.x,this.y,"red"),L&&L.play("hurt"),this.health<=0&&this.respawn(),B())}performSecondary(){x.push(new ee(this.x+(1===this.facing?0:-40),this.y,40,40,this,1)),w.push(new V(this.x+20*this.facing,this.y+10,"white")),this.attackAnim={type:"kick",timer:15,max:15}}shoot(e,t,i=!1){if(w.push(new V(this.x+30*this.facing,this.y+10,"yellow")),X(2),!e){if(t)return x.push(new Q(this.x+this.w/2-5,this.y+this.h,this.facing,e,{pColor:"#fff",pType:"normal"},!0)),void(this.vy=-2);if(i)return void x.push(new Q(this.x+this.w/2-5,this.y-20,this.facing,e,{pColor:"#fff",pType:"normal"},!1,!1,!0))}let a=De[this.charData.id];a?e?a.special&&(a.special(this),this.attackAnim={type:"punch",timer:15,max:15}):a.shoot&&(a.shoot(this),this.attackAnim={type:"shoot",timer:10,max:10}):(x.push(new Q(this.x+15+15*this.facing,this.y+15,this.facing,e,this.charData)),this.attackAnim={type:"shoot",timer:10,max:10}),e||(this.vx-=2*this.facing)}draw(e,t,i,a){if(this.invincible>0&&Math.floor(u.frame/4)%2==0)return;let l=this.x-t+this.w/2,s=this.y-i+this.h/2+this.h*(1-this.stretchY);e.save(),e.translate(l,s),e.scale(this.facing*this.stretchX,this.stretchY),e.fillStyle="rgba(0,0,0,0.5)",e.beginPath(),e.ellipse(0,15,20,5,0,0,2*Math.PI),e.fill(),e.translate(0,-22),Z(e,this.charData,this.animFrame,this.attackAnim),e.restore()}}function Pe(){console.log("INIT() CALLED"),R(0),L.initialized,window.addEventListener("resize",Ie),Ie();const e=document.getElementById("soundToggle");if(e){let t=e.cloneNode(!0);e.parentNode.replaceChild(t,e),t.addEventListener("click",e=>{if(e.preventDefault(),e.stopPropagation(),L){const e=L.toggleMute();t.innerText=e?"üîá":"üîä",L.init()}}),L&&(t.innerText=L.muted?"üîá":"üîä")}u.screen="MENU",u.running=!1,u.currentLevel=1,document.getElementById("menuOverlay").style.display="flex",document.getElementById("rosterOverlay").style.display="none",document.getElementById("lobbyOverlay")&&(document.getElementById("lobbyOverlay").style.display="none"),document.getElementById("gameUI").style.display="none",document.getElementById("bossHealthContainer").style.display="none",document.getElementById("gameOverOverlay").style.display="none",document.getElementById("levelCompleteOverlay").style.display="none"}function Ie(){e&&(e.width=window.innerWidth,e.height=window.innerHeight,"MENU"===u.screen&&ge(),"ROSTER"===u.screen&&me())}function Re(){let e=0;for(let t=0;t<4;t++){let i=document.getElementById("lobbyStatus"+(t+1));if(i)if(N[t]){let a="keyboard"===N[t].type?"KEYBOARD":`GAMEPAD ${N[t].index+1}`;i.innerText="READY\n("+a+")",i.style.color="#00ff41",e++}else i.innerText="PRESS A / SPACE",i.style.color="#777"}let t=document.getElementById("lobbyStartBtn");t&&(e>0?(t.style.display="block",document.getElementById("lobbyMessage").innerText=`${e} PLAYER(S) READY`):(t.style.display="none",document.getElementById("lobbyMessage").innerText="WAITING FOR PLAYERS..."))}window.enterLobby=function(){u.screen="LOBBY",document.getElementById("menuOverlay").style.display="none",document.getElementById("lobbyOverlay").style.display="flex";for(let e=0;e<4;e++)N[e]=null;Re()},window.lobbyLoop=function(){if("LOBBY"!==u.screen)return;(E[0][" "]||E[0].enter)&&(N[0]||(N[0]={type:"keyboard"}));const e=navigator.getGamepads?navigator.getGamepads():[];for(let t=0;t<e.length;t++){let i=e[t];if(i&&(i.buttons[0]&&i.buttons[0].pressed||i.buttons[9]&&i.buttons[9].pressed)){if(!N.find(e=>e&&"gamepad"===e.type&&e.index===i.index)){let e=N.findIndex(e=>null===e);-1!==e&&(N[e]={type:"gamepad",index:i.index})}}}Re()},window.startGame=function(){console.log("STARTGAME() CALLED");try{e=function(){let e=[],t=[],i=u.currentLevel,l="forest";i>=3&&(l="city"),i>=5&&(l="volcano"),u.levelData.biome=l,u.levelData.difficulty=i;let s=200;i>=2&&(s=250),i>=3&&(s=300),i>=4&&(s=350),i>=5&&(s=400),u.levelData.width=s;let o=s,n=!1;function r(e,l,s=!1){let h=U();if(s&&!n&&!(l>20))return t.push(new ye(e*a,l*a)),n=!0,void(i>=5?(t.push(new pe((e-1)*a,l*a)),t.push(new pe((e+1)*a,l*a))):i>=3?(t.push(new pe((e-1)*a,l*a)),t.push(new he((e+1)*a,l*a))):(t.push(new he((e-1)*a,l*a)),t.push(new he((e+1)*a,l*a))));i>=5&&h<.25?(t.push(new pe(e*a,l*a)),t.push(new he((e-1)*a,l*a)),t.push(new he((e+1)*a,l*a))):i>=7&&h<.35?(t.push(new re(e*a,(l-1)*a)),t.push(new pe((e+2)*a,l*a))):i>=3&&h<.45?(t.push(new ne(e*a,l*a)),t.push(new ne((e+1)*a,l*a)),t.push(new ne((e-1)*a,l*a))):(t.push(new he(e*a,l*a)),i>=2?(t.push(new he((e+1)*a,l*a)),U()<.5&&t.push(new he((e-1)*a,l*a))):U()<.3&&t.push(new he((e+1)*a,l*a)))}for(let t=0;t<h;t++)e[t]=new Array(o).fill(null).map(()=>({type:0}));let c=10,p=Math.floor(o/6),y=0,d=0,f=-60,g=0,m=[];for(let s=0;s<o;s++){if(i>=20&&s>o-40){if(c=12,s===o-40)for(let t=0;t<15;t++)12-t>0&&(e[12-t][s]={type:2})}else if(s>15){let o=i<=2?.1:.2+.05*i;U()<o&&(c+=U()>.5?-1:1),c<6&&(c=6),c>50&&(c=50);let n=1===i?0:.005+.01*i;if(U()<n&&s>20){for(let t=0;t<h;t++)t>=0&&t<h&&(e[t][s]={type:0});e[59][s]="volcano"===l?{type:4,color:"#e74c3c"}:{type:4,color:"#999"},m[s]=70,U()<.5&&t.push(new ie(s*a,(c-1)*a));continue}if(d<8&&s-f>30&&U()<.08){let e=c-1;e>0&&(t.push(new se(s*a,e*a)),d++,f=s,r(s+2,e))}}else c=10;m[s]=c;for(let t=0;t<h;t++)if(t>=c){let a=1;(s<15||i>=20&&s>o-40||t>=58)&&(a=2),e[t][s]={type:a}}}for(let l=40;l<o-60;l+=40)if(U()<.7&&m[l]<45){let s=m[l],n=55;for(let t=s;t<n;t++)t>=0&&t<h&&(e[t][l]={type:6});let r=Math.floor(3*U())+2;for(let c=0;c<r;c++){let r=s+10+Math.floor(U()*(n-s-15)),c=10+Math.floor(15*U()),p=U()>.5?1:-1;for(let s=0;s<c;s++){let n=l+s*p;for(let t=r;t<r+3;t++)t>=0&&t<h&&n>=0&&n<o&&(e[t][n]={type:0});if(U()<.1&&s>5&&s%5==0){let e=U();i>=3&&e<.3?t.push(new ne(n*a,(r+2)*a)):t.push(new he(n*a,(r+2)*a))}if(d<8&&(n-f>30||f-n>30)&&U()<.05){let l=r;l>0&&0!==e[l-1][n].type&&(e[l-1][n]={type:1},t.push(new se(n*a,(l+1)*a,l-1,n)),d++,f=n,i>=5?t.push(new re((n+2)*a,(l+1)*a)):t.push(new he((n+2)*a,(l+1)*a)))}}}}y=0,p=Math.floor(o/6),g=20;for(let l=20;l<o-40;l++){let s=m[l];if(s>=h)continue;let c=y<5;i>=5&&y>=3&&(c=!1),l>=p&&c?(e[s][l]={type:2},e[s-1][l]={type:5,active:!1,id:y},p+=Math.floor(o/(i>=5?4:6)),y++,i>=3&&U()<.3&&t.push(new ae((l+2)*a,(s-3)*a))):U()<.03+.01*i&&0===e[s-1][l].type&&t.push(new te(l*a,(s-1)*a));let d=30-i;d<12&&(d=12);let f=l>o-60;if(l-g>d||f&&!n){let e=f&&!n?1:.4;U()<e&&(r(l,s-1,f&&!n),g=l)}U()<.02&&i>=3&&t.push(new ce(l*a,(s-1)*a)),U()<.02&&i>=2&&t.push(new oe(l*a,(s-5)*a))}for(let t=0;t<h;t++)e[t][0]={type:2},e[t][o-1]={type:2};if(!n){let t=o-25,i=10;m[t]&&(i=m[t]);for(let a=0;a<10;a++)i-a>0&&(e[i-a][t]={type:3});e[i-10][t-1]={type:3},e[i-10][t+1]={type:3},r(t,i-11,!0)}if(i>=10&&i%5==0)if(i>=20)t.push(new de((o-20)*a,320)),t.push(new re((o-35)*a,320)),t.push(new re((o-5)*a,320));else{let e=Math.floor(.7*o),l=e+Math.floor(U()*(o-e-5)),s=10;m[l]&&(s=m[l]-5),s>55&&(s=10),"heli"==(i>=14&&i%2==0?"heli":"ground")?t.push(new fe(l*a,(s-10)*a)):t.push(new de(l*a,s*a)),r(l-5,s),r(l+5,s)}return C(t),e}(),v=e,console.log("LEVEL GENERATED. TILES:",v.length),M([]),D([]),A([]),u.checkpointsHit=0,"MENU"!==u.screen&&"LOBBY"!==u.screen||(u.score=0,u.rescues=0,u.lives=3,u.currentLevel=1),u.bossActive=!1,u.screen="GAME",u.running=!0,P([]),I(null);let t=N.map((e,t)=>({config:e,slot:t})).filter(e=>null!==e.config);0===t.length&&(console.log("No inputs configured, defaulting P1 to Keyboard"),N[0]={type:"keyboard"},t=[{config:{type:"keyboard"},slot:0}]);let i=[];t.forEach((e,t)=>{let a=new Ae(e.slot),l=Math.min(u.globalUnlocked,m.length),s=(Math.floor(U()*l)+t)%l;a.setCharacter(m[s].id),i.push(a)}),P(i),I(F[0]);let l=80,s=80,o=new le(l,s);x.push(o),F.forEach((e,t)=>{e.x=l+20+10*t,e.y=s+60,e.vy=5,Y(e.x,e.y,"#fff",1)}),u.spawnPoint={x:l+20,y:s+60},document.getElementById("menuOverlay").style.display="none",document.getElementById("lobbyOverlay")&&(document.getElementById("lobbyOverlay").style.display="none"),document.getElementById("gameUI").style.display="flex",document.getElementById("levelCompleteOverlay").style.display="none",B(),R(0)}catch(e){console.error("Error starting game:",e),u.screen="MENU",document.getElementById("menuOverlay").style.display="flex",document.getElementById("gameUI").style.display="none"}var e},window.nextLevel=function(){u.currentLevel++,u.score+=1e3,window.startGame()},window.returnToBase=function(){Pe()},window.resetGame=function(){window.startGame()},window.viewRoster=function(){u.screen="ROSTER",document.getElementById("menuOverlay").style.display="none",document.getElementById("rosterOverlay").style.display="flex"},window.returnToMenu=function(){u.screen="MENU",document.getElementById("rosterOverlay").style.display="none",document.getElementById("menuOverlay").style.display="flex"},window.onerror=function(e,t,i,a,l){console.error("Global Error:",e,"at",i,":",a);const s=document.getElementById("errorOverlay");s&&(s.style.display="block",s.innerHTML+=`<div><strong>Error:</strong> ${e} <br><small>${t}:${i}</small></div><hr>`)},window.addEventListener("keydown",e=>{let t=N.findIndex(e=>e&&"keyboard"===e.type);-1===t?E[0][e.key.toLowerCase()]=!0:E[t][e.key.toLowerCase()]=!0}),window.addEventListener("keyup",e=>{let t=N.findIndex(e=>e&&"keyboard"===e.type);-1!==t?E[t][e.key.toLowerCase()]=!1:E[0][e.key.toLowerCase()]=!1}),function(){const e={btnUp:"arrowup",btnDown:"arrowdown",btnLeft:"arrowleft",btnRight:"arrowright",btnJump:" ",btnShoot:"z",btnSpecial:"x",btnSecondary:"c",btnFlex:"f"};function t(e,t){E[0][e]!==t&&(E[0][e]=t)}function i(i,a){const l=document.getElementById(i);if(!l)return;if("btnSprint"===i)return void(a&&(E[0].shift=!E[0].shift,E[0].shift?l.classList.add("active"):l.classList.remove("active")));const s=e[i];s&&(t(s,a),a?l.classList.add("active"):l.classList.remove("active"))}Object.keys(e).concat(["btnSprint"]).forEach(e=>{const t=document.getElementById(e);if(!t)return;const a=t=>{t.preventDefault(),i(e,!0)},l=t=>{t.preventDefault(),i(e,!1)};t.addEventListener("touchstart",a,{passive:!1}),t.addEventListener("touchend",l,{passive:!1}),t.addEventListener("mousedown",a),t.addEventListener("mouseup",l),t.addEventListener("mouseleave",l)});const a=document.getElementById("controlsToggle"),l=document.getElementById("touchControls");function s(){"none"===l.style.display?a.style.opacity="0.5":a.style.opacity="1"}a&&l&&(a.addEventListener("click",e=>{e.preventDefault(),"none"===l.style.display?(l.style.display="flex",u.zoom=.5):(l.style.display="none",u.zoom=1),s()}),"ontouchstart"in window||navigator.maxTouchPoints>0?(l.style.display="flex",u.zoom=.5):(l.style.display="none",u.zoom=1),s())}(),Pe(),requestAnimationFrame(function t(a){T||R(a);const l=a-T;let s=o/u.slowMo;if(l<s)requestAnimationFrame(t);else{R(a-l%s),function(){const e=navigator.getGamepads?navigator.getGamepads():[];for(let t=0;t<e.length;t++){let i=e[t];if(!i)continue;let a=N.findIndex(e=>e&&"gamepad"===e.type&&e.index===i.index);if(-1===a)continue;let l=E[a],s=_[a];if(!l||!s)continue;const h=(e,t)=>{i.buttons[e]&&i.buttons[e].pressed?(l[t]=!0,s[t]=!0):s[t]&&(l[t]=!1,s[t]=!1)};h(0," "),h(1,"x"),h(2,"z"),h(3,"c"),h(4,"shift"),h(5,"shift"),h(12,"arrowup"),h(13,"arrowdown"),h(14,"arrowleft"),h(15,"arrowright");const o=.5;let n=i.axes[0],r=n<-o;n>o?(l.arrowright=!0,s.stick_x=1):r?(l.arrowleft=!0,s.stick_x=-1):s.stick_x&&(l.arrowright=!1,l.arrowleft=!1,s.stick_x=0);let c=i.axes[1],p=c<-o;c>o?(l.arrowdown=!0,s.stick_y=1):p?(l.arrowup=!0,s.stick_y=-1):s.stick_y&&(l.arrowdown=!1,l.arrowup=!1,s.stick_y=0),h(9,"f")}}();try{i&&(i.textContent=`State: ${u.screen}\nRun: ${u.running}\nLevel: ${u.currentLevel}\nBiome: ${u.levelData.biome}\nEnts: ${x.length}\nFPS: ${Math.round(1e3/l)}`)}catch(e){}try{if("MENU"===u.screen);else if("ROSTER"===u.screen);else if("LOBBY"===u.screen)window.lobbyLoop();else if(u.running){u.hitStop>0?u.hitStop--:(u.frame++,F&&F.forEach(e=>{e.health>0&&e.update()}),C(x.filter(e=>e.hp>0||e.life>0)),x.forEach(e=>e.update()),M(w.filter(e=>e.life>0)),w.forEach(e=>e.update()),D(S.filter(e=>e.life>0)),S.forEach(e=>{e.y+=e.vy,e.life--}),A(k.filter(e=>e.life>0)),k.forEach(e=>e.update()));let t=F.filter(e=>e.health>0);if(t.length>0){let i=0,a=0;t.forEach(e=>{i+=e.x,a+=e.y}),i/=t.length,a/=t.length;let l=u.zoom||1,s=e.width/l,h=e.height/l,o=i-.5*s;o<0&&(o=0),u.cameraX+=.1*(o-u.cameraX);let n=a-.5*h;n<0&&(n=0),u.cameraY+=.1*(n-u.cameraY)}U(),u.shake,U(),u.shake;u.shake*=.9}}catch(e){console.error("Game Loop Update Error:",e)}try{"MENU"===u.screen?ge():"ROSTER"===u.screen?me():"LOBBY"!==u.screen&&("GAME"===u.screen||u.running)&&ue()}catch(e){console.error("Game Loop Draw Error:",e)}requestAnimationFrame(t)}})}();
//# sourceMappingURL=game.bundle.js.map

</script>


</body>
</html>
